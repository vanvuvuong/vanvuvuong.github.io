<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=vi><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Linux User & Group Management - Hướng Dẫn Chuyên Sâu - Kaizen - tốt hơn mỗi ngày</title><meta name=author content="Kaizen Teams"><meta name=description content="Linux User & Group Management - Hướng Dẫn Chuyên Sâu"><meta name=keywords content='ai generated post'><meta itemprop=name content="Linux User & Group Management - Hướng Dẫn Chuyên Sâu"><meta itemprop=description content="Linux User & Group Management - Hướng Dẫn Chuyên Sâu"><meta itemprop=datePublished content="2025-12-11T05:00:23+07:00"><meta itemprop=dateModified content="2025-12-11T16:05:24+07:00"><meta itemprop=wordCount content="9125"><meta itemprop=keywords content="Ai Generated Post"><meta property="og:url" content="https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/"><meta property="og:site_name" content="Kaizen - tốt hơn mỗi ngày"><meta property="og:title" content="Linux User & Group Management - Hướng Dẫn Chuyên Sâu"><meta property="og:description" content="Linux User & Group Management - Hướng Dẫn Chuyên Sâu"><meta property="og:locale" content="vi"><meta property="og:type" content="article"><meta property="article:section" content="bai-viet"><meta property="article:published_time" content="2025-12-11T05:00:23+07:00"><meta property="article:modified_time" content="2025-12-11T16:05:24+07:00"><meta property="article:tag" content="Ai Generated Post"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux User & Group Management - Hướng Dẫn Chuyên Sâu"><meta name=twitter:description content="Linux User & Group Management - Hướng Dẫn Chuyên Sâu"><meta name=application-name content="Kaizen - tốt hơn mỗi ngày"><meta name=apple-mobile-web-app-title content="Kaizen - tốt hơn mỗi ngày"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#2d89ef"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#FF7359><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/ title="Linux User & Group Management - Hướng Dẫn Chuyên Sâu - Kaizen - tốt hơn mỗi ngày"><link rel=prev type=text/html href=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/storage/ title="Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu"><link rel=next type=text/html href=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/package-manager/ title="Linux Package Management - Hướng Dẫn Chuyên Sâu"><link rel=stylesheet href=/css/config.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Linux User \u0026 Group Management - Hướng Dẫn Chuyên Sâu","inLanguage":"vi","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/vanvuvuong.github.io\/bai-viet\/khoa-hoc-may-tinh\/linux-cli\/user-group\/"},"image":[{"@type":"ImageObject","url":"https:\/\/vanvuvuong.github.io\/images\/avatar.jpeg","width":330,"height":330}],"genre":"posts","keywords":"ai generated post","wordcount":9125,"url":"https:\/\/vanvuvuong.github.io\/bai-viet\/khoa-hoc-may-tinh\/linux-cli\/user-group\/","datePublished":"2025-12-11T05:00:23+07:00","dateModified":"2025-12-11T16:05:24+07:00","publisher":{"@type":"Organization","name":"Kaizen","logo":{"@type":"ImageObject","url":"https:\/\/vanvuvuong.github.io\/images\/avatar.jpeg","width":330,"height":330}},"author":{"@type":"Person","name":"Kaizen Teams"},"description":"Linux User \u0026 Group Management - Hướng Dẫn Chuyên Sâu"}</script><script src=/js/head/color-scheme.min.js></script></head><body data-instant-intensity=viewport data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Kaizen - tốt hơn mỗi ngày"><img class=logo src=/images/kaizen-logo.png alt="Kaizen - tốt hơn mỗi ngày" height=32 width=32><span class=header-title-text>Kaizen</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/gioi-thieu><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> Giới thiệu</a></li><li class="menu-item has-children"><a class=menu-link href=/bai-viet><i class="fa-solid fa-newspaper fa-fw fa-sm" aria-hidden=true></i> Bài viết</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/bai-viet/khoa-hoc-may-tinh><i class="fa-solid fa-laptop fa-fw fa-sm" aria-hidden=true></i> Khoa học máy tính</a></li><li class=menu-item><a class=menu-link href=/bai-viet/cuoc-song><i class="fa-solid fa-life-ring fa-fw fa-sm" aria-hidden=true></i> Cuộc sống</a></li><li class=menu-item><a class=menu-link href=/bai-viet/hoc-vien-luat-tu-nhien><i class="fa-solid fa-dragon fa-fw fa-sm" aria-hidden=true></i> Học viện luật tự nhiên</a></li><li class=menu-item><a class=menu-link href=/collections><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> Bộ sưu tập</a></li><li class=menu-item><a class=menu-link href=/tags><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li></ul></li><li class=menu-item><a class=menu-link href=/sach-hay><i class="fa-solid fa-book fa-fw fa-sm" aria-hidden=true></i> Sách hay</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Tìm tiêu đề hoặc nội dung..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title="Tìm kiếm"><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Xoá><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Kaizen - tốt hơn mỗi ngày"><img class=logo src=/images/kaizen-logo.png alt="Kaizen - tốt hơn mỗi ngày" height=26 width=26><span class=header-title-text>Kaizen</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Tìm tiêu đề hoặc nội dung..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title="Tìm kiếm"><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Xoá><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Huỷ</a></li><li class=menu-item><a class=menu-link href=/gioi-thieu><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> Giới thiệu</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/bai-viet><i class="fa-solid fa-newspaper fa-fw fa-sm" aria-hidden=true></i> Bài viết</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/bai-viet/khoa-hoc-may-tinh><i class="fa-solid fa-laptop fa-fw fa-sm" aria-hidden=true></i> Khoa học máy tính</a></li><li class=menu-item><a class=menu-link href=/bai-viet/cuoc-song><i class="fa-solid fa-life-ring fa-fw fa-sm" aria-hidden=true></i> Cuộc sống</a></li><li class=menu-item><a class=menu-link href=/bai-viet/hoc-vien-luat-tu-nhien><i class="fa-solid fa-dragon fa-fw fa-sm" aria-hidden=true></i> Học viện luật tự nhiên</a></li><li class=menu-item><a class=menu-link href=/collections><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> Bộ sưu tập</a></li><li class=menu-item><a class=menu-link href=/tags><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li></ul></li><li class=menu-item><a class=menu-link href=/sach-hay><i class="fa-solid fa-book fa-fw fa-sm" aria-hidden=true></i> Sách hay</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=fi-container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Bộ sưu tập"><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title="Bộ sưu tập">Linux Cli</span>
<span class=collection-count>11</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/shell-co-ban/ title="Những Điều Cơ Bản Về Bash & Fish Shell Trong Linux">Những Điều Cơ Bản Về Bash & Fish Shell Trong Linux</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/grep-diff-sort/ title="Grep, Sort, Diff - Hướng Dẫn Chuyên Sâu">Grep, Sort, Diff - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/network/ title="Linux Network Commands - Hướng Dẫn Chuyên Sâu">Linux Network Commands - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/process-service-log/ title="Process Management, Systemd & Logging - Hướng Dẫn Chuyên Sâu">Process Management, Systemd & Logging - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/regex-awk-sed/ title="Awk, Sed & Regex - Hướng Dẫn Chuyên Sâu Cho System Engineer">Awk, Sed & Regex - Hướng Dẫn Chuyên Sâu Cho System Engineer</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/storage/ title="Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu">Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><span class=active title="Linux User & Group Management - Hướng Dẫn Chuyên Sâu">Linux User & Group Management - Hướng Dẫn Chuyên Sâu</span></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/encryption-and-security/ title="Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu">Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/package-manager/ title="Linux Package Management - Hướng Dẫn Chuyên Sâu">Linux Package Management - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/selinux/ title="Selinux & Apparmor - Kiểm Soát Truy Cập Bắt Buộc">Selinux & Apparmor - Kiểm Soát Truy Cập Bắt Buộc</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/file-and-folder/ title="Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu">Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu</a></li></ul><div class=collection-nav-simple><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/storage/ class=collection-nav-item rel=prev title="Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>7/11</span><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/encryption-and-security/ class=collection-nav-item rel=next title="Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu"><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></nav></div></div><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>Nội dung liên quan</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/storage/ title="Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu">Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu</a></li><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/regex-awk-sed/ title="Awk, Sed & Regex - Hướng Dẫn Chuyên Sâu Cho System Engineer">Awk, Sed & Regex - Hướng Dẫn Chuyên Sâu Cho System Engineer</a></li><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/process-service-log/ title="Process Management, Systemd & Logging - Hướng Dẫn Chuyên Sâu">Process Management, Systemd & Logging - Hướng Dẫn Chuyên Sâu</a></li><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/network/ title="Linux Network Commands - Hướng Dẫn Chuyên Sâu">Linux Network Commands - Hướng Dẫn Chuyên Sâu</a></li><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/grep-diff-sort/ title="Grep, Sort, Diff - Hướng Dẫn Chuyên Sâu">Grep, Sort, Diff - Hướng Dẫn Chuyên Sâu</a></li></ul></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Linux User & Group Management - Hướng Dẫn Chuyên Sâu</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://vanvuvuong.github.io title="Tác giả" target=_blank rel="external nofollow noopener noreferrer author" class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Kaizen Teams</a></span><span class=post-included-in>&nbsp;trong <a href=/collections/linux-cli/ class=post-collection title="Bộ sưu tập - Linux Cli"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Linux Cli</a></span></div><div class=post-meta-line><span title="đăng ngày 2025-12-11 05:00:23"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025-12-11>2025-12-11</time></span>&nbsp;<span title="Cập nhật ngày 2025-12-11 16:05:24"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025-12-11>2025-12-11</time></span>&nbsp;<span title="9125 từ"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>Khoảng 9200 từ</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>43 phút</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Nội dung</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#phần-1-nền-tảng-usergroup>PHẦN 1: NỀN TẢNG USER/GROUP</a><ul><li><a href=#11-mô-hình-định-danh-linux>1.1 Mô Hình Định Danh Linux</a></li><li><a href=#12-uid-và-gid>1.2 UID và GID</a></li><li><a href=#13-primary-vs-supplementary-groups>1.3 Primary vs Supplementary Groups</a></li></ul></li><li><a href=#phần-2-cấu-trúc-file-hệ-thống>PHẦN 2: CẤU TRÚC FILE HỆ THỐNG</a><ul><li><a href=#21-etcpasswd---cơ-sở-dữ-liệu-user>2.1 /etc/passwd - Cơ Sở Dữ Liệu User</a></li><li><a href=#22-etcshadow---cơ-sở-dữ-liệu-password>2.2 /etc/shadow - Cơ Sở Dữ Liệu Password</a></li><li><a href=#23-băm-password>2.3 Băm Password</a></li><li><a href=#24-etcgroup---cơ-sở-dữ-liệu-group>2.4 /etc/group - Cơ Sở Dữ Liệu Group</a></li><li><a href=#25-etcgshadow---shadow-group>2.5 /etc/gshadow - Shadow Group</a></li><li><a href=#26-nsswitchconf---name-service-switch>2.6 nsswitch.conf - Name Service Switch</a></li></ul></li><li><a href=#phần-3-quản-lý-user>PHẦN 3: QUẢN LÝ USER</a><ul><li><a href=#31-useradd---tạo-user>3.1 useradd - Tạo User</a></li><li><a href=#32-quy-trình-useradd>3.2 Quy Trình useradd</a></li><li><a href=#33-usermod---sửa-đổi-user>3.3 usermod - Sửa Đổi User</a></li><li><a href=#34-userdel---xóa-user>3.4 userdel - Xóa User</a></li><li><a href=#35-các-lệnh-thông-tin-user>3.5 Các Lệnh Thông Tin User</a></li></ul></li><li><a href=#phần-4-quản-lý-group>PHẦN 4: QUẢN LÝ GROUP</a><ul><li><a href=#41-groupadd---tạo-group>4.1 groupadd - Tạo Group</a></li><li><a href=#42-groupmod---sửa-đổi-group>4.2 groupmod - Sửa Đổi Group</a></li><li><a href=#43-groupdel---xóa-group>4.3 groupdel - Xóa Group</a></li><li><a href=#44-các-lệnh-thành-viên-group>4.4 Các Lệnh Thành Viên Group</a></li></ul></li><li><a href=#phần-5-quản-lý-password>PHẦN 5: QUẢN LÝ PASSWORD</a><ul><li><a href=#51-passwd---đổi-password>5.1 passwd - Đổi Password</a></li><li><a href=#52-chage---thời-hạn-password>5.2 chage - Thời Hạn Password</a></li><li><a href=#53-chính-sách-password>5.3 Chính Sách Password</a></li></ul></li><li><a href=#phần-6-su--sudo>PHẦN 6: SU & SUDO</a><ul><li><a href=#61-su---chuyển-user>6.1 su - Chuyển User</a></li><li><a href=#62-sudo---superuser-do>6.2 sudo - Superuser Do</a></li><li><a href=#63-etcsudoers--visudo>6.3 /etc/sudoers & visudo</a></li><li><a href=#64-best-practices>6.4 Best Practices</a></li><li><a href=#65-so-sánh-su-vs-sudo>6.5 So Sánh su vs sudo</a></li></ul></li><li><a href=#phần-7-pam---pluggable-authentication-modules>PHẦN 7: PAM - PLUGGABLE AUTHENTICATION MODULES</a><ul><li><a href=#71-kiến-trúc-pam>7.1 Kiến Trúc PAM</a></li><li><a href=#72-cấu-hình-pam>7.2 Cấu Hình PAM</a></li><li><a href=#73-định-dạng-config-pam>7.3 Định Dạng Config PAM</a></li><li><a href=#74-ví-dụ-pam-hữu-ích>7.4 Ví Dụ PAM Hữu Ích</a></li></ul></li><li><a href=#phần-8-mặc-định-hệ-thống>PHẦN 8: MẶC ĐỊNH HỆ THỐNG</a><ul><li><a href=#81-etclogindefs>8.1 /etc/login.defs</a></li><li><a href=#82-etcskel---thư-mục-skeleton>8.2 /etc/skel - Thư Mục Skeleton</a></li><li><a href=#83-etcdefaultuseradd>8.3 /etc/default/useradd</a></li></ul></li><li><a href=#phần-9-chủ-đề-nâng-cao>PHẦN 9: CHỦ ĐỀ NÂNG CAO</a><ul><li><a href=#91-access-control-lists-acl>9.1 Access Control Lists (ACL)</a></li><li><a href=#92-linux-capabilities>9.2 Linux Capabilities</a></li><li><a href=#93-user-namespaces>9.3 User Namespaces</a></li><li><a href=#94-tổng-quan-tích-hợp-ldapad>9.4 Tổng Quan Tích Hợp LDAP/AD</a></li></ul></li><li><a href=#tóm-tắt-nhanh>TÓM TẮT NHANH</a><ul><li><a href=#quản-lý-user>Quản Lý User</a></li><li><a href=#quản-lý-group>Quản Lý Group</a></li><li><a href=#quản-lý-password>Quản Lý Password</a></li><li><a href=#susudo>su/sudo</a></li><li><a href=#cheatsheet-quyền-file>Cheatsheet Quyền File</a></li><li><a href=#files-quan-trọng>Files Quan Trọng</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h2 class=heading-element id=phần-1-nền-tảng-usergroup><span>PHẦN 1: NỀN TẢNG USER/GROUP</span>
<a href=#ph%e1%ba%a7n-1-n%e1%bb%81n-t%e1%ba%a3ng-usergroup class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=11-mô-hình-định-danh-linux><span>1.1 Mô Hình Định Danh Linux</span>
<a href=#11-m%c3%b4-h%c3%acnh-%c4%91%e1%bb%8bnh-danh-linux class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│          MÔ HÌNH ĐỊNH DANH &amp; QUYỀN TRUY CẬP LINUX           │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Mọi process và file đều có owner:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                     PROCESS                              │
</span></span><span class=line><span class=cl>│  ┌────────────────────────────────────────────────────┐  │
</span></span><span class=line><span class=cl>│  │ Real UID/GID      - Ai thực sự chạy process        │  │
</span></span><span class=line><span class=cl>│  │ Effective UID/GID - Quyền hiện tại của process     │  │
</span></span><span class=line><span class=cl>│  │ Saved UID/GID     - Backup của effective (setuid)  │  │
</span></span><span class=line><span class=cl>│  │ Supplementary GIDs - Các groups phụ                │  │
</span></span><span class=line><span class=cl>│  └────────────────────────────────────────────────────┘  │
</span></span><span class=line><span class=cl>└──────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                      FILE                                │
</span></span><span class=line><span class=cl>│  ┌────────────────────────────────────────────────────┐  │
</span></span><span class=line><span class=cl>│  │ Owner UID  - User sở hữu file                      │  │
</span></span><span class=line><span class=cl>│  │ Owner GID  - Group sở hữu file                     │  │
</span></span><span class=line><span class=cl>│  │ Mode bits  - rwxrwxrwx (owner/group/others)        │  │
</span></span><span class=line><span class=cl>│  └────────────────────────────────────────────────────┘  │
</span></span><span class=line><span class=cl>└──────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Quyết định truy cập (đơn giản hóa):
</span></span><span class=line><span class=cl>┌─────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│ if (process.euid == 0):           # root                │
</span></span><span class=line><span class=cl>│     return CHO_PHÉP                                     │
</span></span><span class=line><span class=cl>│ if (process.euid == file.uid):    # khớp owner          │
</span></span><span class=line><span class=cl>│     kiểm tra owner bits (rwx------)                     │
</span></span><span class=line><span class=cl>│ elif (process.egid == file.gid or                       │
</span></span><span class=line><span class=cl>│       file.gid in process.supplementary_gids):          │
</span></span><span class=line><span class=cl>│     kiểm tra group bits (---rwx---)                     │
</span></span><span class=line><span class=cl>│ else:                              # others             │
</span></span><span class=line><span class=cl>│     kiểm tra others bits (------rwx)                    │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Độ phức tạp tra cứu: O(1) cho so sánh UID/GID
</span></span><span class=line><span class=cl>                    O(n) cho supplementary groups với n = số groups
</span></span><span class=line><span class=cl>                    Kernel cache groups nên thực tế rất nhanh</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=12-uid-và-gid><span>1.2 UID và GID</span>
<a href=#12-uid-v%c3%a0-gid class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                   PHẠM VI UID/GID                           │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>UID (User ID) và GID (Group ID) là số nguyên 32-bit:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─────────────────┬─────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│ Phạm vi         │ Mục đích                                │
</span></span><span class=line><span class=cl>├─────────────────┼─────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ 0               │ root (superuser)                        │
</span></span><span class=line><span class=cl>│ 1-999           │ System accounts (services, daemons)     │
</span></span><span class=line><span class=cl>│ 1000-60000      │ Regular users (phạm vi mặc định)        │
</span></span><span class=line><span class=cl>│ 65534           │ nobody (user đặc biệt không đặc quyền)  │
</span></span><span class=line><span class=cl>│ 65535           │ (reserved, thường invalid)              │
</span></span><span class=line><span class=cl>└─────────────────┴─────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Xem phạm vi UID/GID trên hệ thống
</span></span><span class=line><span class=cl>cat /etc/login.defs | grep -E &#34;^UID|^GID&#34;
</span></span><span class=line><span class=cl># UID_MIN         1000    # UID tối thiểu cho user thường
</span></span><span class=line><span class=cl># UID_MAX        60000    # UID tối đa cho user thường
</span></span><span class=line><span class=cl># GID_MIN         1000    # GID tối thiểu cho group thường
</span></span><span class=line><span class=cl># GID_MAX        60000    # GID tối đa cho group thường
</span></span><span class=line><span class=cl># SYS_UID_MIN      201    # UID tối thiểu cho system user
</span></span><span class=line><span class=cl># SYS_UID_MAX      999    # UID tối đa cho system user
</span></span><span class=line><span class=cl># SYS_GID_MIN      201    # GID tối thiểu cho system group
</span></span><span class=line><span class=cl># SYS_GID_MAX      999    # GID tối đa cho system group
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Tại sao cần phân chia phạm vi?
</span></span><span class=line><span class=cl>- System accounts (daemons): Không cần home, không login
</span></span><span class=line><span class=cl>- Regular users: Có home directory, có thể login
</span></span><span class=line><span class=cl>- Phân tách giúp audit và security policies dễ dàng hơn</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=13-primary-vs-supplementary-groups><span>1.3 Primary vs Supplementary Groups</span>
<a href=#13-primary-vs-supplementary-groups class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│              PRIMARY vs SUPPLEMENTARY GROUPS                │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User &#34;alice&#34;:
</span></span><span class=line><span class=cl>┌────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│ Primary Group: alice (GID 1001)                            │
</span></span><span class=line><span class=cl>│   - Định nghĩa trong /etc/passwd                           │
</span></span><span class=line><span class=cl>│   - Files mới tạo sẽ có group này (trừ khi có setgid)      │
</span></span><span class=line><span class=cl>│   - Mỗi user CHỈ CÓ MỘT primary group                      │
</span></span><span class=line><span class=cl>│                                                            │
</span></span><span class=line><span class=cl>│ Supplementary Groups: developers, docker, sudo             │
</span></span><span class=line><span class=cl>│   - Định nghĩa trong /etc/group                            │
</span></span><span class=line><span class=cl>│   - User có quyền của TẤT CẢ supplementary groups          │
</span></span><span class=line><span class=cl>│   - Có thể thuộc nhiều supplementary groups                │
</span></span><span class=line><span class=cl>└────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Xem groups của user
</span></span><span class=line><span class=cl>id alice
</span></span><span class=line><span class=cl># uid=1001(alice) gid=1001(alice) groups=1001(alice),27(sudo),999(docker),1002(developers)
</span></span><span class=line><span class=cl>#                 ↑ primary        ↑ supplementary groups
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Xem groups của user hiện tại
</span></span><span class=line><span class=cl>groups
</span></span><span class=line><span class=cl>id -Gn</span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=phần-2-cấu-trúc-file-hệ-thống><span>PHẦN 2: CẤU TRÚC FILE HỆ THỐNG</span>
<a href=#ph%e1%ba%a7n-2-c%e1%ba%a5u-tr%c3%bac-file-h%e1%bb%87-th%e1%bb%91ng class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=21-etcpasswd---cơ-sở-dữ-liệu-user><span>2.1 /etc/passwd - Cơ Sở Dữ Liệu User</span>
<a href=#21-etcpasswd---c%c6%a1-s%e1%bb%9f-d%e1%bb%af-li%e1%bb%87u-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                  ĐỊNH DẠNG /etc/passwd                      │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Định dạng file: Phân tách bằng dấu hai chấm, 7 trường mỗi dòng
</span></span><span class=line><span class=cl>Quyền: -rw-r--r-- (ai cũng đọc được - không chứa password)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>username:password:UID:GID:GECOS:home:shell
</span></span><span class=line><span class=cl>   │        │      │   │    │     │    │
</span></span><span class=line><span class=cl>   │        │      │   │    │     │    └─ Shell đăng nhập
</span></span><span class=line><span class=cl>   │        │      │   │    │     └────── Thư mục home
</span></span><span class=line><span class=cl>   │        │      │   │    └──────────── Ghi chú (tên đầy đủ, etc)
</span></span><span class=line><span class=cl>   │        │      │   └───────────────── GID chính
</span></span><span class=line><span class=cl>   │        │      └───────────────────── ID người dùng
</span></span><span class=line><span class=cl>   │        └──────────────────────────── &#34;x&#34; = password trong shadow
</span></span><span class=line><span class=cl>   └───────────────────────────────────── Tên đăng nhập
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ví dụ:
</span></span><span class=line><span class=cl>root:x:0:0:root:/root:/bin/bash
</span></span><span class=line><span class=cl>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span class=line><span class=cl>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>alice:x:1001:1001:Alice Smith,Phòng 101,555-1234:/home/alice:/bin/bash
</span></span><span class=line><span class=cl>                  └────────────────────────────┘
</span></span><span class=line><span class=cl>                  GECOS: Tên,Vị trí,Điện thoại (phân tách bằng dấu phẩy)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Parse /etc/passwd
</span></span><span class=line><span class=cl>getent passwd alice
</span></span><span class=line><span class=cl>getent passwd 1001            # Theo UID
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Thuật toán tra cứu: Tìm kiếm tuyến tính O(n) trong file
</span></span><span class=line><span class=cl># Thực tế: nsswitch.conf có thể dùng cache (nscd) hoặc LDAP</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=22-etcshadow---cơ-sở-dữ-liệu-password><span>2.2 /etc/shadow - Cơ Sở Dữ Liệu Password</span>
<a href=#22-etcshadow---c%c6%a1-s%e1%bb%9f-d%e1%bb%af-li%e1%bb%87u-password class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                  ĐỊNH DẠNG /etc/shadow                      │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Định dạng file: Phân tách bằng dấu hai chấm, 9 trường mỗi dòng
</span></span><span class=line><span class=cl>Quyền: -rw-r----- root:shadow (chỉ root đọc được)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>username:password:lastchg:min:max:warn:inactive:expire:reserved
</span></span><span class=line><span class=cl>   │        │        │     │   │   │      │       │       │
</span></span><span class=line><span class=cl>   │        │        │     │   │   │      │       │       └─ Dự trữ
</span></span><span class=line><span class=cl>   │        │        │     │   │   │      │       └───────── Ngày hết hạn account (ngày từ epoch)
</span></span><span class=line><span class=cl>   │        │        │     │   │   │      └───────────────── Ngày inactive trước khi disable
</span></span><span class=line><span class=cl>   │        │        │     │   │   └──────────────────────── Ngày cảnh báo trước khi hết hạn
</span></span><span class=line><span class=cl>   │        │        │     │   └──────────────────────────── Ngày tối đa giữa các lần đổi
</span></span><span class=line><span class=cl>   │        │        │     └──────────────────────────────── Ngày tối thiểu giữa các lần đổi
</span></span><span class=line><span class=cl>   │        │        └────────────────────────────────────── Lần đổi cuối (ngày từ 1/1/1970)
</span></span><span class=line><span class=cl>   │        └─────────────────────────────────────────────── Password đã mã hóa
</span></span><span class=line><span class=cl>   └──────────────────────────────────────────────────────── Tên đăng nhập
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Giá trị trường password:
</span></span><span class=line><span class=cl>- $6$salt$hash    - SHA-512 hash (mặc định hiện đại)
</span></span><span class=line><span class=cl>- $5$salt$hash    - SHA-256 hash
</span></span><span class=line><span class=cl>- $y$salt$hash    - yescrypt (mới nhất, mạnh)
</span></span><span class=line><span class=cl>- $1$salt$hash    - MD5 (deprecated, yếu)
</span></span><span class=line><span class=cl>- !               - Account bị khóa
</span></span><span class=line><span class=cl>- !!              - Password chưa bao giờ được đặt
</span></span><span class=line><span class=cl>- *               - Không thể login bằng password
</span></span><span class=line><span class=cl>- (trống)         - Không cần password (NGUY HIỂM!)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ví dụ:
</span></span><span class=line><span class=cl>alice:$6$xyz123$longhashhere:19500:0:99999:7:::
</span></span><span class=line><span class=cl>       │        │             │    │  │    │
</span></span><span class=line><span class=cl>       │        │             │    │  │    └─ Cảnh báo 7 ngày trước khi hết hạn
</span></span><span class=line><span class=cl>       │        │             │    │  └────── Tối đa 99999 ngày (không hết hạn)
</span></span><span class=line><span class=cl>       │        │             │    └───────── Tối thiểu 0 ngày (đổi bất cứ lúc nào)
</span></span><span class=line><span class=cl>       │        │             └────────────── Đổi lần cuối: ngày 19500 từ epoch
</span></span><span class=line><span class=cl>       │        └──────────────────────────── SHA-512 hash
</span></span><span class=line><span class=cl>       └───────────────────────────────────── Thuật toán $6$ = SHA-512
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Xem shadow entry (cần root)
</span></span><span class=line><span class=cl>sudo getent shadow alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Tính toán ngày từ epoch:
</span></span><span class=line><span class=cl>echo $(($(date +%s) / 86400))    # Số ngày hiện tại</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=23-băm-password><span>2.3 Băm Password</span>
<a href=#23-b%c4%83m-password class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│               THUẬT TOÁN BĂM PASSWORD                       │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Password KHÔNG lưu plaintext, chỉ lưu hash:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                                                             │
</span></span><span class=line><span class=cl>│   Password: &#34;mypassword123&#34;                                 │
</span></span><span class=line><span class=cl>│        │                                                    │
</span></span><span class=line><span class=cl>│        ▼                                                    │
</span></span><span class=line><span class=cl>│   ┌─────────────────────────────────────────────────────┐   │
</span></span><span class=line><span class=cl>│   │  Hàm băm (SHA-512 + salt + iterations)              │   │
</span></span><span class=line><span class=cl>│   │  - Salt: Byte ngẫu nhiên để chống rainbow table     │   │
</span></span><span class=line><span class=cl>│   │  - Iterations: Làm chậm brute force                 │   │
</span></span><span class=line><span class=cl>│   └─────────────────────────────────────────────────────┘   │
</span></span><span class=line><span class=cl>│        │                                                    │
</span></span><span class=line><span class=cl>│        ▼                                                    │
</span></span><span class=line><span class=cl>│   $6$rounds=5000$randomsalt$verylonghashoutput...           │
</span></span><span class=line><span class=cl>│    │  │          │          │                               │
</span></span><span class=line><span class=cl>│    │  │          │          └─ Output hash                  │
</span></span><span class=line><span class=cl>│    │  │          └──────────── Salt                         │
</span></span><span class=line><span class=cl>│    │  └─────────────────────── Số vòng (iterations)         │
</span></span><span class=line><span class=cl>│    └────────────────────────── ID thuật toán                │
</span></span><span class=line><span class=cl>│                                                             │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ID thuật toán:
</span></span><span class=line><span class=cl>┌──────┬────────────┬─────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│ ID   │ Thuật toán │ Ghi chú                                 │
</span></span><span class=line><span class=cl>├──────┼────────────┼─────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ $1$  │ MD5        │ DEPRECATED - dễ tấn công                │
</span></span><span class=line><span class=cl>│ $5$  │ SHA-256    │ OK nhưng SHA-512 được ưu tiên           │
</span></span><span class=line><span class=cl>│ $6$  │ SHA-512    │ Mặc định hiện tại trên hầu hết distros  │
</span></span><span class=line><span class=cl>│ $y$  │ yescrypt   │ Mới nhất, memory-hard, bảo mật tốt nhất │
</span></span><span class=line><span class=cl>│ $2b$ │ bcrypt     │ Tốt, dùng bởi một số hệ thống           │
</span></span><span class=line><span class=cl>└──────┴────────────┴─────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Tại sao cần salt?
</span></span><span class=line><span class=cl>- Không có salt: Cùng password → cùng hash
</span></span><span class=line><span class=cl>  → Rainbow table attack: Tính trước hash của password phổ biến
</span></span><span class=line><span class=cl>- Có salt: Cùng password + khác salt → khác hash
</span></span><span class=line><span class=cl>  → Phải brute force từng account riêng
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Tại sao cần iterations?
</span></span><span class=line><span class=cl>- Hash nhanh = brute force nhanh
</span></span><span class=line><span class=cl>- 5000 vòng SHA-512 ≈ 0.1ms mỗi lần thử
</span></span><span class=line><span class=cl>- Attacker: 10 lần thử/giây vs 10,000,000 lần thử/giây</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=24-etcgroup---cơ-sở-dữ-liệu-group><span>2.4 /etc/group - Cơ Sở Dữ Liệu Group</span>
<a href=#24-etcgroup---c%c6%a1-s%e1%bb%9f-d%e1%bb%af-li%e1%bb%87u-group class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                  ĐỊNH DẠNG /etc/group                       │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Định dạng file: Phân tách bằng dấu hai chấm, 4 trường mỗi dòng
</span></span><span class=line><span class=cl>Quyền: -rw-r--r-- (ai cũng đọc được)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>groupname:password:GID:members
</span></span><span class=line><span class=cl>    │        │      │     │
</span></span><span class=line><span class=cl>    │        │      │     └─ Danh sách username phân tách bằng dấu phẩy
</span></span><span class=line><span class=cl>    │        │      └─────── Group ID
</span></span><span class=line><span class=cl>    │        └────────────── Password group (hiếm dùng, thường &#34;x&#34;)
</span></span><span class=line><span class=cl>    └─────────────────────── Tên group
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ví dụ:
</span></span><span class=line><span class=cl>root:x:0:
</span></span><span class=line><span class=cl>sudo:x:27:alice,bob
</span></span><span class=line><span class=cl>docker:x:999:alice,charlie
</span></span><span class=line><span class=cl>developers:x:1002:alice,bob,charlie
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Lưu ý: User có thể thuộc group mà KHÔNG được liệt kê trong members
</span></span><span class=line><span class=cl>#        nếu đó là PRIMARY group của user (định nghĩa trong /etc/passwd)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Xem thông tin group
</span></span><span class=line><span class=cl>getent group sudo
</span></span><span class=line><span class=cl>getent group 27              # Theo GID
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Xem tất cả groups của user
</span></span><span class=line><span class=cl>groups alice
</span></span><span class=line><span class=cl>id -Gn alice</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=25-etcgshadow---shadow-group><span>2.5 /etc/gshadow - Shadow Group</span>
<a href=#25-etcgshadow---shadow-group class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                 ĐỊNH DẠNG /etc/gshadow                      │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Định dạng file: Phân tách bằng dấu hai chấm, 4 trường
</span></span><span class=line><span class=cl>Quyền: -rw-r----- root:shadow
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>groupname:password:admins:members
</span></span><span class=line><span class=cl>    │        │       │      │
</span></span><span class=line><span class=cl>    │        │       │      └─ Thành viên thường
</span></span><span class=line><span class=cl>    │        │       └──────── Quản trị viên group (có thể thêm/xóa members)
</span></span><span class=line><span class=cl>    │        └────────────────  Password đã mã hóa (cho newgrp)
</span></span><span class=line><span class=cl>    └─────────────────────────  Tên group
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ví dụ:
</span></span><span class=line><span class=cl>sudo:*::alice,bob
</span></span><span class=line><span class=cl>developers:!::alice,bob,charlie
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Trường password:
</span></span><span class=line><span class=cl>- !  = Không có password group, chỉ members mới dùng được newgrp
</span></span><span class=line><span class=cl>- *  = Không có password group
</span></span><span class=line><span class=cl>- !! = Password chưa được đặt
</span></span><span class=line><span class=cl>- $6$... = Password đã băm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Password group cho phép non-members tạm thời tham gia group
</span></span><span class=line><span class=cl># Hiếm khi được sử dụng trong thực tế</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=26-nsswitchconf---name-service-switch><span>2.6 nsswitch.conf - Name Service Switch</span>
<a href=#26-nsswitchconf---name-service-switch class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                    NAME SERVICE SWITCH                      │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/etc/nsswitch.conf định nghĩa TÌM Ở ĐÂU users/groups/hosts:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># /etc/nsswitch.conf
</span></span><span class=line><span class=cl>passwd:     files systemd
</span></span><span class=line><span class=cl>group:      files systemd
</span></span><span class=line><span class=cl>shadow:     files
</span></span><span class=line><span class=cl>hosts:      files dns
</span></span><span class=line><span class=cl>networks:   files
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># &#34;files&#34; = /etc/passwd, /etc/group, v.v.
</span></span><span class=line><span class=cl># &#34;systemd&#34; = systemd-userdbd (dynamic users)
</span></span><span class=line><span class=cl># &#34;ldap&#34; = LDAP directory
</span></span><span class=line><span class=cl># &#34;sss&#34; = SSSD (Active Directory, LDAP)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Thứ tự tra cứu:
</span></span><span class=line><span class=cl>1. Kiểm tra nguồn đầu tiên
</span></span><span class=line><span class=cl>2. Nếu không tìm thấy, kiểm tra nguồn tiếp theo
</span></span><span class=line><span class=cl>3. Tiếp tục đến khi tìm thấy hoặc hết tất cả nguồn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Ví dụ với LDAP:
</span></span><span class=line><span class=cl>passwd:     files ldap
</span></span><span class=line><span class=cl># → Kiểm tra /etc/passwd trước
</span></span><span class=line><span class=cl># → Nếu không tìm thấy, truy vấn máy chủ LDAP
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># getent sử dụng nsswitch.conf
</span></span><span class=line><span class=cl>getent passwd alice    # Tìm qua tất cả nguồn đã cấu hình
</span></span><span class=line><span class=cl>getent -s files passwd alice   # Chỉ tìm trong files</span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=phần-3-quản-lý-user><span>PHẦN 3: QUẢN LÝ USER</span>
<a href=#ph%e1%ba%a7n-3-qu%e1%ba%a3n-l%c3%bd-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=31-useradd---tạo-user><span>3.1 useradd - Tạo User</span>
<a href=#31-useradd---t%e1%ba%a1o-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>useradd <span class=o>[</span>TÙY_CHỌN<span class=o>]</span> TÊN_USER
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tùy chọn chính:</span>
</span></span><span class=line><span class=cl>-m, --create-home     <span class=c1># Tạo thư mục home</span>
</span></span><span class=line><span class=cl>-M, --no-create-home  <span class=c1># Không tạo thư mục home</span>
</span></span><span class=line><span class=cl>-d, --home-dir THƯ_MỤC    <span class=c1># Chỉ định đường dẫn home</span>
</span></span><span class=line><span class=cl>-s, --shell SHELL     <span class=c1># Shell đăng nhập</span>
</span></span><span class=line><span class=cl>-g, --gid GROUP       <span class=c1># Primary group (tên hoặc GID)</span>
</span></span><span class=line><span class=cl>-G, --groups GROUPS   <span class=c1># Supplementary groups (phân tách bằng dấu phẩy)</span>
</span></span><span class=line><span class=cl>-u, --uid UID         <span class=c1># UID cụ thể</span>
</span></span><span class=line><span class=cl>-c, --comment CHÚ_THÍCH <span class=c1># Trường GECOS (tên đầy đủ, v.v.)</span>
</span></span><span class=line><span class=cl>-e, --expiredate NGÀY <span class=c1># Ngày hết hạn account (YYYY-MM-DD)</span>
</span></span><span class=line><span class=cl>-f, --inactive NGÀY   <span class=c1># Ngày sau khi password hết hạn đến khi account bị disable</span>
</span></span><span class=line><span class=cl>-r, --system          <span class=c1># Tạo system account (UID &lt; 1000)</span>
</span></span><span class=line><span class=cl>-k, --skel THƯ_MỤC    <span class=c1># Thư mục skeleton (mặc định /etc/skel)</span>
</span></span><span class=line><span class=cl>-p, --password PASS   <span class=c1># Password đã mã hóa (KHÔNG PHẢI plaintext!)</span>
</span></span><span class=line><span class=cl>-D, --defaults        <span class=c1># Hiển thị hoặc thay đổi giá trị mặc định</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Ví dụ cơ bản</span>
</span></span><span class=line><span class=cl>useradd alice                    <span class=c1># Tối thiểu: không home, shell mặc định</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo user đầy đủ</span>
</span></span><span class=line><span class=cl>useradd -m -s /bin/bash -c <span class=s2>&#34;Alice Smith&#34;</span> alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo user với UID và groups cụ thể</span>
</span></span><span class=line><span class=cl>useradd -m -u <span class=m>1500</span> -g developers -G docker,sudo alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo system account (cho service)</span>
</span></span><span class=line><span class=cl>useradd -r -s /usr/sbin/nologin -d /var/lib/myapp myapp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo user với thư mục home khác</span>
</span></span><span class=line><span class=cl>useradd -m -d /data/users/alice alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo user với ngày hết hạn account</span>
</span></span><span class=line><span class=cl>useradd -m -e 2025-12-31 contractor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem defaults</span>
</span></span><span class=line><span class=cl>useradd -D
</span></span><span class=line><span class=cl><span class=c1># GROUP=100           # Group mặc định</span>
</span></span><span class=line><span class=cl><span class=c1># HOME=/home          # Thư mục base cho home</span>
</span></span><span class=line><span class=cl><span class=c1># INACTIVE=-1         # Ngày inactive (-1 = không bao giờ)</span>
</span></span><span class=line><span class=cl><span class=c1># EXPIRE=             # Ngày hết hạn (trống = không bao giờ)</span>
</span></span><span class=line><span class=cl><span class=c1># SHELL=/bin/sh       # Shell mặc định</span>
</span></span><span class=line><span class=cl><span class=c1># SKEL=/etc/skel      # Thư mục skeleton</span>
</span></span><span class=line><span class=cl><span class=c1># CREATE_MAIL_SPOOL=yes  # Tạo mail spool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thay đổi defaults</span>
</span></span><span class=line><span class=cl>useradd -D -s /bin/bash          <span class=c1># Shell mặc định</span>
</span></span><span class=line><span class=cl>useradd -D -b /data/users        <span class=c1># Thư mục home base mặc định</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=32-quy-trình-useradd><span>3.2 Quy Trình useradd</span>
<a href=#32-quy-tr%c3%acnh-useradd class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>┌─────────────────────────────────────────────────────────────┐</span>
</span></span><span class=line><span class=cl><span class=err>│</span>              <span class=n>QUY</span> <span class=n>TRÌNH</span> <span class=n>NỘI</span> <span class=n>BỘ</span> <span class=n>USERADD</span>                       <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>└─────────────────────────────────────────────────────────────┘</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>useradd</span> <span class=o>-</span><span class=n>m</span> <span class=o>-</span><span class=n>s</span> <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span> <span class=o>-</span><span class=n>G</span> <span class=n>sudo</span><span class=p>,</span><span class=n>docker</span> <span class=n>alice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Bước</span> <span class=mi>1</span><span class=p>:</span> <span class=n>Xác</span> <span class=n>thực</span> <span class=err>đầ</span><span class=n>u</span> <span class=n>vào</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>Kiểm</span> <span class=n>tra</span> <span class=err>đị</span><span class=n>nh</span> <span class=n>dạng</span> <span class=n>username</span> <span class=p>(</span><span class=n>không</span> <span class=n>có</span> <span class=n>khoảng</span> <span class=n>trắng</span><span class=p>,</span> <span class=n>ký</span> <span class=n>tự</span> <span class=n>hợp</span> <span class=n>lệ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>Kiểm</span> <span class=n>tra</span> <span class=n>username</span> <span class=n>chưa</span> <span class=n>tồn</span> <span class=n>tại</span>
</span></span><span class=line><span class=cl>        <span class=err>└─</span> <span class=n>Kiểm</span> <span class=n>tra</span> <span class=n>UID</span> <span class=n>khả</span> <span class=n>dụng</span> <span class=p>(</span><span class=n>nếu</span> <span class=n>chỉ</span> <span class=err>đị</span><span class=n>nh</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Bước</span> <span class=mi>2</span><span class=p>:</span> <span class=n>Cấp</span> <span class=n>phát</span> <span class=n>UID</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=err>Đọ</span><span class=n>c</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>login</span><span class=o>.</span><span class=n>defs</span> <span class=err>để</span> <span class=n>lấy</span> <span class=n>UID_MIN</span><span class=p>,</span> <span class=n>UID_MAX</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>Tìm</span> <span class=n>UID</span> <span class=n>khả</span> <span class=n>dụng</span> <span class=n>tiếp</span> <span class=n>theo</span>
</span></span><span class=line><span class=cl>        <span class=err>└─</span> <span class=n>Thuật</span> <span class=n>toán</span><span class=p>:</span> <span class=n>Quét</span> <span class=n>tuyến</span> <span class=n>tính</span> <span class=n>từ</span> <span class=n>UID_MIN</span><span class=p>,</span> <span class=n>O</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Bước</span> <span class=mi>3</span><span class=p>:</span> <span class=n>Tạo</span> <span class=n>primary</span> <span class=n>group</span> <span class=p>(</span><span class=n>nếu</span> <span class=n>chưa</span> <span class=n>tồn</span> <span class=n>tại</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>Tên</span> <span class=n>group</span> <span class=o>=</span> <span class=n>username</span> <span class=p>(</span><span class=n>mặc</span> <span class=err>đị</span><span class=n>nh</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>Cấp</span> <span class=n>phát</span> <span class=n>GID</span> <span class=p>(</span><span class=n>quy</span> <span class=n>trình</span> <span class=n>giống</span> <span class=n>UID</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=err>└─</span> <span class=n>Thêm</span> <span class=n>entry</span> <span class=n>vào</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>group</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Bước</span> <span class=mi>4</span><span class=p>:</span> <span class=n>Cập</span> <span class=n>nhật</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>passwd</span>
</span></span><span class=line><span class=cl>        <span class=err>└─</span> <span class=n>Thêm</span><span class=p>:</span> <span class=n>alice</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1001</span><span class=p>:</span><span class=mi>1001</span><span class=p>::</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>alice</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Bước</span> <span class=mi>5</span><span class=p>:</span> <span class=n>Cập</span> <span class=n>nhật</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>shadow</span>
</span></span><span class=line><span class=cl>        <span class=err>└─</span> <span class=n>Thêm</span><span class=p>:</span> <span class=n>alice</span><span class=p>:</span><span class=o>!!</span><span class=p>:</span><span class=mi>19500</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=mi>99999</span><span class=p>:</span><span class=mi>7</span><span class=p>:::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Bước</span> <span class=mi>6</span><span class=p>:</span> <span class=n>Cập</span> <span class=n>nhật</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>group</span> <span class=p>(</span><span class=n>supplementary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>Thêm</span> <span class=n>alice</span> <span class=n>vào</span> <span class=n>group</span> <span class=n>sudo</span>
</span></span><span class=line><span class=cl>        <span class=err>└─</span> <span class=n>Thêm</span> <span class=n>alice</span> <span class=n>vào</span> <span class=n>group</span> <span class=n>docker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Bước</span> <span class=mi>7</span><span class=p>:</span> <span class=n>Tạo</span> <span class=n>thư</span> <span class=n>mục</span> <span class=n>home</span> <span class=p>(</span><span class=n>cờ</span> <span class=o>-</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>mkdir</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>alice</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>Sao</span> <span class=n>chép</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>skel</span><span class=o>/*</span> <span class=n>sang</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>alice</span>
</span></span><span class=line><span class=cl>        <span class=err>├─</span> <span class=n>chown</span> <span class=o>-</span><span class=n>R</span> <span class=n>alice</span><span class=p>:</span><span class=n>alice</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>alice</span>
</span></span><span class=line><span class=cl>        <span class=err>└─</span> <span class=n>chmod</span> <span class=mi>700</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>alice</span> <span class=p>(</span><span class=n>hoặc</span> <span class=n>theo</span> <span class=n>UMASK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Bước</span> <span class=mi>8</span><span class=p>:</span> <span class=n>Tạo</span> <span class=n>mail</span> <span class=n>spool</span> <span class=p>(</span><span class=n>nếu</span> <span class=err>đượ</span><span class=n>c</span> <span class=n>cấu</span> <span class=n>hình</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=err>└─</span> <span class=n>touch</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>mail</span><span class=o>/</span><span class=n>alice</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=33-usermod---sửa-đổi-user><span>3.3 usermod - Sửa Đổi User</span>
<a href=#33-usermod---s%e1%bb%ada-%c4%91%e1%bb%95i-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>usermod <span class=o>[</span>TÙY_CHỌN<span class=o>]</span> TÊN_USER
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tùy chọn chính:</span>
</span></span><span class=line><span class=cl>-l, --login TÊN_MỚI  <span class=c1># Đổi username</span>
</span></span><span class=line><span class=cl>-d, --home THƯ_MỤC   <span class=c1># Đổi thư mục home</span>
</span></span><span class=line><span class=cl>-m, --move-home      <span class=c1># Di chuyển nội dung home (dùng với -d)</span>
</span></span><span class=line><span class=cl>-s, --shell SHELL    <span class=c1># Đổi shell</span>
</span></span><span class=line><span class=cl>-g, --gid GROUP      <span class=c1># Đổi primary group</span>
</span></span><span class=line><span class=cl>-G, --groups GROUPS  <span class=c1># ĐẶT supplementary groups (THAY THẾ!)</span>
</span></span><span class=line><span class=cl>-aG, --append        <span class=c1># THÊM VÀO supplementary groups</span>
</span></span><span class=line><span class=cl>-u, --uid UID        <span class=c1># Đổi UID</span>
</span></span><span class=line><span class=cl>-c, --comment CHÚ_THÍCH <span class=c1># Đổi GECOS</span>
</span></span><span class=line><span class=cl>-e, --expiredate NGÀY <span class=c1># Đổi ngày hết hạn</span>
</span></span><span class=line><span class=cl>-f, --inactive NGÀY  <span class=c1># Đổi thời gian inactive</span>
</span></span><span class=line><span class=cl>-L, --lock           <span class=c1># Khóa account</span>
</span></span><span class=line><span class=cl>-U, --unlock         <span class=c1># Mở khóa account</span>
</span></span><span class=line><span class=cl>-p, --password PASS  <span class=c1># Đổi password đã mã hóa</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Đổi shell</span>
</span></span><span class=line><span class=cl>usermod -s /bin/zsh alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đổi thư mục home VÀ di chuyển nội dung</span>
</span></span><span class=line><span class=cl>usermod -d /data/alice -m alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># THÊM user vào group (QUAN TRỌNG: dùng -aG, không phải -G)</span>
</span></span><span class=line><span class=cl>usermod -aG docker alice         <span class=c1># Thêm vào groups</span>
</span></span><span class=line><span class=cl>usermod -aG sudo,docker alice    <span class=c1># Thêm nhiều group</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CẢNH BÁO: -G không có -a sẽ THAY THẾ tất cả groups!</span>
</span></span><span class=line><span class=cl>usermod -G docker alice          <span class=c1># SAI: Xóa hết groups khác!</span>
</span></span><span class=line><span class=cl>usermod -aG docker alice         <span class=c1># ĐÚNG: Thêm vào</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Khóa account (disable login)</span>
</span></span><span class=line><span class=cl>usermod -L alice
</span></span><span class=line><span class=cl><span class=c1># → /etc/shadow: trường password có &#34;!&#34; prefix</span>
</span></span><span class=line><span class=cl><span class=c1># alice:!$6$hash...:...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mở khóa account</span>
</span></span><span class=line><span class=cl>usermod -U alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đổi username</span>
</span></span><span class=line><span class=cl>usermod -l alice_new alice
</span></span><span class=line><span class=cl><span class=c1># Lưu ý: Thư mục home không tự đổi tên!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đổi UID (cẩn thận với quyền sở hữu file)</span>
</span></span><span class=line><span class=cl>usermod -u <span class=m>2000</span> alice
</span></span><span class=line><span class=cl><span class=c1># Files cũ vẫn có UID cũ → cần chạy:</span>
</span></span><span class=line><span class=cl>find / -user <span class=m>1001</span> -exec chown alice <span class=o>{}</span> <span class=se>\;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt ngày hết hạn account</span>
</span></span><span class=line><span class=cl>usermod -e 2025-06-30 alice
</span></span><span class=line><span class=cl>usermod -e <span class=s2>&#34;&#34;</span> alice              <span class=c1># Xóa ngày hết hạn</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=34-userdel---xóa-user><span>3.4 userdel - Xóa User</span>
<a href=#34-userdel---x%c3%b3a-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>userdel <span class=o>[</span>TÙY_CHỌN<span class=o>]</span> TÊN_USER
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tùy chọn:</span>
</span></span><span class=line><span class=cl>-r, --remove          <span class=c1># Xóa thư mục home và mail spool</span>
</span></span><span class=line><span class=cl>-f, --force           <span class=c1># Buộc xóa ngay cả khi user đang đăng nhập</span>
</span></span><span class=line><span class=cl>-Z, --selinux-user    <span class=c1># Xóa SELinux user mapping</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Xóa user, giữ thư mục home</span>
</span></span><span class=line><span class=cl>userdel alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xóa user VÀ thư mục home</span>
</span></span><span class=line><span class=cl>userdel -r alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Buộc xóa (ngay cả khi đang đăng nhập)</span>
</span></span><span class=line><span class=cl>userdel -rf alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Best practice: Disable trước, xóa sau</span>
</span></span><span class=line><span class=cl>usermod -L alice                 <span class=c1># Khóa account</span>
</span></span><span class=line><span class=cl>usermod -e <span class=m>1</span> alice               <span class=c1># Hết hạn account</span>
</span></span><span class=line><span class=cl><span class=c1># Đợi, xác minh không có process đang chạy</span>
</span></span><span class=line><span class=cl>userdel -r alice                 <span class=c1># Xóa</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=35-các-lệnh-thông-tin-user><span>3.5 Các Lệnh Thông Tin User</span>
<a href=#35-c%c3%a1c-l%e1%bb%87nh-th%c3%b4ng-tin-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Xem thông tin user</span>
</span></span><span class=line><span class=cl>id alice
</span></span><span class=line><span class=cl><span class=c1># uid=1001(alice) gid=1001(alice) groups=1001(alice),27(sudo),999(docker)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>id -u alice          <span class=c1># Chỉ UID</span>
</span></span><span class=line><span class=cl>id -g alice          <span class=c1># Chỉ GID chính</span>
</span></span><span class=line><span class=cl>id -G alice          <span class=c1># Tất cả GIDs</span>
</span></span><span class=line><span class=cl>id -Gn alice         <span class=c1># Tất cả tên group</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem groups</span>
</span></span><span class=line><span class=cl>groups alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem thông tin finger</span>
</span></span><span class=line><span class=cl>finger alice         <span class=c1># Cần cài đặt gói finger</span>
</span></span><span class=line><span class=cl>chfn alice           <span class=c1># Đổi thông tin finger</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem users đang đăng nhập</span>
</span></span><span class=line><span class=cl>who
</span></span><span class=line><span class=cl>w
</span></span><span class=line><span class=cl>users
</span></span><span class=line><span class=cl>last alice           <span class=c1># Lịch sử đăng nhập</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem từ /etc/passwd</span>
</span></span><span class=line><span class=cl>getent passwd alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem tất cả users</span>
</span></span><span class=line><span class=cl>getent passwd
</span></span><span class=line><span class=cl>cat /etc/passwd
</span></span><span class=line><span class=cl>awk -F: <span class=s1>&#39;{print $1}&#39;</span> /etc/passwd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đếm users</span>
</span></span><span class=line><span class=cl>getent passwd <span class=p>|</span> wc -l</span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=phần-4-quản-lý-group><span>PHẦN 4: QUẢN LÝ GROUP</span>
<a href=#ph%e1%ba%a7n-4-qu%e1%ba%a3n-l%c3%bd-group class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=41-groupadd---tạo-group><span>4.1 groupadd - Tạo Group</span>
<a href=#41-groupadd---t%e1%ba%a1o-group class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>groupadd <span class=o>[</span>TÙY_CHỌN<span class=o>]</span> TÊN_GROUP
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tùy chọn:</span>
</span></span><span class=line><span class=cl>-g, --gid GID         <span class=c1># GID cụ thể</span>
</span></span><span class=line><span class=cl>-r, --system          <span class=c1># System group (GID &lt; 1000)</span>
</span></span><span class=line><span class=cl>-f, --force           <span class=c1># Thoát thành công nếu group đã tồn tại</span>
</span></span><span class=line><span class=cl>-K, --key <span class=nv>KEY</span><span class=o>=</span>VALUE   <span class=c1># Ghi đè giá trị /etc/login.defs</span>
</span></span><span class=line><span class=cl>-p, --password PASS   <span class=c1># Password đã mã hóa</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Tạo group cơ bản</span>
</span></span><span class=line><span class=cl>groupadd developers
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo group với GID cụ thể</span>
</span></span><span class=line><span class=cl>groupadd -g <span class=m>2000</span> webteam
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo system group</span>
</span></span><span class=line><span class=cl>groupadd -r nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo group, bỏ qua nếu đã tồn tại</span>
</span></span><span class=line><span class=cl>groupadd -f developers</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=42-groupmod---sửa-đổi-group><span>4.2 groupmod - Sửa Đổi Group</span>
<a href=#42-groupmod---s%e1%bb%ada-%c4%91%e1%bb%95i-group class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>groupmod <span class=o>[</span>TÙY_CHỌN<span class=o>]</span> TÊN_GROUP
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tùy chọn:</span>
</span></span><span class=line><span class=cl>-g, --gid GID         <span class=c1># Đổi GID</span>
</span></span><span class=line><span class=cl>-n, --new-name TÊN    <span class=c1># Đổi tên group</span>
</span></span><span class=line><span class=cl>-p, --password PASS   <span class=c1># Đổi password</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Đổi tên group</span>
</span></span><span class=line><span class=cl>groupmod -n tenmoi tencu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đổi GID</span>
</span></span><span class=line><span class=cl>groupmod -g <span class=m>3000</span> developers
</span></span><span class=line><span class=cl><span class=c1># CẢNH BÁO: Files với GID cũ không tự cập nhật!</span>
</span></span><span class=line><span class=cl>find / -group <span class=m>2000</span> -exec chgrp developers <span class=o>{}</span> <span class=se>\;</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=43-groupdel---xóa-group><span>4.3 groupdel - Xóa Group</span>
<a href=#43-groupdel---x%c3%b3a-group class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>groupdel TÊN_GROUP</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Xóa group</span>
</span></span><span class=line><span class=cl>groupdel developers
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Không thể xóa nếu:</span>
</span></span><span class=line><span class=cl><span class=c1># - Là primary group của user nào đó</span>
</span></span><span class=line><span class=cl><span class=c1># - Giải pháp: Đổi primary group của users đó trước</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Ví dụ:</span>
</span></span><span class=line><span class=cl>usermod -g users alice           <span class=c1># Đổi primary group của alice</span>
</span></span><span class=line><span class=cl>groupdel alice_group             <span class=c1># Giờ có thể xóa</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=44-các-lệnh-thành-viên-group><span>4.4 Các Lệnh Thành Viên Group</span>
<a href=#44-c%c3%a1c-l%e1%bb%87nh-th%c3%a0nh-vi%c3%aan-group class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Thêm user vào group (CÁCH ĐÚNG)</span>
</span></span><span class=line><span class=cl>usermod -aG groupname username
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem members của group</span>
</span></span><span class=line><span class=cl>getent group developers
</span></span><span class=line><span class=cl>grep developers /etc/group
</span></span><span class=line><span class=cl>lid -g developers                <span class=c1># Cần cài libuser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem groups của user</span>
</span></span><span class=line><span class=cl>groups username
</span></span><span class=line><span class=cl>id -Gn username
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># gpasswd - Quản lý thành viên group</span>
</span></span><span class=line><span class=cl>gpasswd -a alice developers      <span class=c1># Thêm user vào group</span>
</span></span><span class=line><span class=cl>gpasswd -d alice developers      <span class=c1># Xóa user khỏi group</span>
</span></span><span class=line><span class=cl>gpasswd -A alice developers      <span class=c1># Đặt alice làm admin của group</span>
</span></span><span class=line><span class=cl>gpasswd -M alice,bob developers  <span class=c1># Đặt danh sách members (THAY THẾ!)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># newgrp - Tạm thời đổi primary group</span>
</span></span><span class=line><span class=cl>newgrp developers                <span class=c1># Bắt đầu shell mới với primary group = developers</span>
</span></span><span class=line><span class=cl><span class=c1># Hữu ích khi muốn files mới tạo thuộc group cụ thể</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sg - Chạy lệnh với group khác</span>
</span></span><span class=line><span class=cl>sg developers -c <span class=s2>&#34;touch /shared/file&#34;</span></span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=phần-5-quản-lý-password><span>PHẦN 5: QUẢN LÝ PASSWORD</span>
<a href=#ph%e1%ba%a7n-5-qu%e1%ba%a3n-l%c3%bd-password class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=51-passwd---đổi-password><span>5.1 passwd - Đổi Password</span>
<a href=#51-passwd---%c4%91%e1%bb%95i-password class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>passwd <span class=o>[</span>TÙY_CHỌN<span class=o>]</span> <span class=o>[</span>TÊN_USER<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tùy chọn:</span>
</span></span><span class=line><span class=cl>-l, --lock            <span class=c1># Khóa password</span>
</span></span><span class=line><span class=cl>-u, --unlock          <span class=c1># Mở khóa password</span>
</span></span><span class=line><span class=cl>-d, --delete          <span class=c1># Xóa password (để trống)</span>
</span></span><span class=line><span class=cl>-e, --expire          <span class=c1># Buộc đổi password khi đăng nhập lần sau</span>
</span></span><span class=line><span class=cl>-n, --mindays NGÀY    <span class=c1># Số ngày tối thiểu giữa các lần đổi</span>
</span></span><span class=line><span class=cl>-x, --maxdays NGÀY    <span class=c1># Số ngày tối đa trước khi phải đổi</span>
</span></span><span class=line><span class=cl>-w, --warndays NGÀY   <span class=c1># Số ngày cảnh báo trước khi hết hạn</span>
</span></span><span class=line><span class=cl>-i, --inactive NGÀY   <span class=c1># Số ngày sau khi hết hạn đến khi disable</span>
</span></span><span class=line><span class=cl>-S, --status          <span class=c1># Hiển thị trạng thái password</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># User đổi password của mình</span>
</span></span><span class=line><span class=cl>passwd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># root đổi password của user khác</span>
</span></span><span class=line><span class=cl>passwd alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem trạng thái password</span>
</span></span><span class=line><span class=cl>passwd -S alice
</span></span><span class=line><span class=cl><span class=c1># alice P 05/01/2024 0 99999 7 -1</span>
</span></span><span class=line><span class=cl><span class=c1>#   │   │     │      │   │   │  │</span>
</span></span><span class=line><span class=cl><span class=c1>#   │   │     │      │   │   │  └─ Inactive (-1 = không bao giờ)</span>
</span></span><span class=line><span class=cl><span class=c1>#   │   │     │      │   │   └──── Ngày cảnh báo</span>
</span></span><span class=line><span class=cl><span class=c1>#   │   │     │      │   └──────── Ngày tối đa</span>
</span></span><span class=line><span class=cl><span class=c1>#   │   │     │      └──────────── Ngày tối thiểu</span>
</span></span><span class=line><span class=cl><span class=c1>#   │   │     └─────────────────── Ngày đổi cuối cùng</span>
</span></span><span class=line><span class=cl><span class=c1>#   │   └───────────────────────── Trạng thái: P=dùng được, L=bị khóa, NP=không có password</span>
</span></span><span class=line><span class=cl><span class=c1>#   └───────────────────────────── Tên đăng nhập</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Khóa account</span>
</span></span><span class=line><span class=cl>passwd -l alice
</span></span><span class=line><span class=cl><span class=c1># Mở khóa bằng: passwd -u alice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Buộc đổi password khi đăng nhập lần sau</span>
</span></span><span class=line><span class=cl>passwd -e alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xóa password (NGUY HIỂM!)</span>
</span></span><span class=line><span class=cl>passwd -d alice
</span></span><span class=line><span class=cl><span class=c1># → User có thể login không cần password!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt password non-interactive (scripting)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;alice:newpassword&#34;</span> <span class=p>|</span> chpasswd
</span></span><span class=line><span class=cl><span class=c1># Hoặc với hash:</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;alice:</span><span class=k>$(</span>openssl passwd -6 <span class=s1>&#39;newpassword&#39;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=p>|</span> chpasswd -e</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=52-chage---thời-hạn-password><span>5.2 chage - Thời Hạn Password</span>
<a href=#52-chage---th%e1%bb%9di-h%e1%ba%a1n-password class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chage <span class=o>[</span>TÙY_CHỌN<span class=o>]</span> TÊN_USER
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tùy chọn:</span>
</span></span><span class=line><span class=cl>-l, --list            <span class=c1># Liệt kê thông tin thời hạn</span>
</span></span><span class=line><span class=cl>-d, --lastday NGÀY    <span class=c1># Đặt ngày đổi password cuối cùng</span>
</span></span><span class=line><span class=cl>-E, --expiredate NGÀY <span class=c1># Đặt ngày hết hạn account</span>
</span></span><span class=line><span class=cl>-I, --inactive NGÀY   <span class=c1># Đặt thời gian inactive</span>
</span></span><span class=line><span class=cl>-m, --mindays NGÀY    <span class=c1># Số ngày tối thiểu giữa các lần đổi</span>
</span></span><span class=line><span class=cl>-M, --maxdays NGÀY    <span class=c1># Số ngày tối đa trước khi phải đổi</span>
</span></span><span class=line><span class=cl>-W, --warndays NGÀY   <span class=c1># Số ngày cảnh báo trước khi hết hạn</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Xem thông tin thời hạn password</span>
</span></span><span class=line><span class=cl>chage -l alice
</span></span><span class=line><span class=cl><span class=c1># Last password change                    : May 01, 2024</span>
</span></span><span class=line><span class=cl><span class=c1># Password expires                        : never</span>
</span></span><span class=line><span class=cl><span class=c1># Password inactive                       : never</span>
</span></span><span class=line><span class=cl><span class=c1># Account expires                         : never</span>
</span></span><span class=line><span class=cl><span class=c1># Minimum number of days between changes  : 0</span>
</span></span><span class=line><span class=cl><span class=c1># Maximum number of days between changes  : 99999</span>
</span></span><span class=line><span class=cl><span class=c1># Number of days of warning before expiry : 7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Buộc đổi password khi đăng nhập lần sau</span>
</span></span><span class=line><span class=cl>chage -d <span class=m>0</span> alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt password hết hạn sau 90 ngày</span>
</span></span><span class=line><span class=cl>chage -M <span class=m>90</span> alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt ngày hết hạn account</span>
</span></span><span class=line><span class=cl>chage -E 2025-12-31 alice
</span></span><span class=line><span class=cl>chage -E -1 alice                <span class=c1># Xóa ngày hết hạn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt cảnh báo 14 ngày trước khi hết hạn</span>
</span></span><span class=line><span class=cl>chage -W <span class=m>14</span> alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt số ngày tối thiểu giữa các lần đổi password</span>
</span></span><span class=line><span class=cl>chage -m <span class=m>7</span> alice                 <span class=c1># Phải đợi 7 ngày mới được đổi lại</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Disable hết hạn password</span>
</span></span><span class=line><span class=cl>chage -M -1 alice
</span></span><span class=line><span class=cl><span class=c1># Hoặc</span>
</span></span><span class=line><span class=cl>chage -M <span class=m>99999</span> alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Chế độ tương tác</span>
</span></span><span class=line><span class=cl>chage alice</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=53-chính-sách-password><span>5.3 Chính Sách Password</span>
<a href=#53-ch%c3%adnh-s%c3%a1ch-password class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│               VỊ TRÍ CHÍNH SÁCH PASSWORD                    │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1. /etc/login.defs - Mặc định toàn hệ thống
</span></span><span class=line><span class=cl>2. /etc/pam.d/common-password - Quy tắc password PAM
</span></span><span class=line><span class=cl>3. /etc/security/pwquality.conf - Chất lượng password
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                   /etc/login.defs                           │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Điều khiển thời hạn password
</span></span><span class=line><span class=cl>PASS_MAX_DAYS   99999     # Số ngày tối đa password hợp lệ
</span></span><span class=line><span class=cl>PASS_MIN_DAYS   0         # Số ngày tối thiểu giữa các lần đổi
</span></span><span class=line><span class=cl>PASS_WARN_AGE   7         # Số ngày cảnh báo trước khi hết hạn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Mã hóa password
</span></span><span class=line><span class=cl>ENCRYPT_METHOD  SHA512    # Thuật toán băm
</span></span><span class=line><span class=cl>SHA_CRYPT_MIN_ROUNDS 5000 # Số vòng băm tối thiểu
</span></span><span class=line><span class=cl>SHA_CRYPT_MAX_ROUNDS 5000 # Số vòng băm tối đa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Phạm vi UID/GID
</span></span><span class=line><span class=cl>UID_MIN         1000
</span></span><span class=line><span class=cl>UID_MAX         60000
</span></span><span class=line><span class=cl>GID_MIN         1000
</span></span><span class=line><span class=cl>GID_MAX         60000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Thư mục home
</span></span><span class=line><span class=cl>CREATE_HOME     yes
</span></span><span class=line><span class=cl>UMASK           077       # Quyền mặc định: 700</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># /etc/security/pwquality.conf - Độ phức tạp password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>minlen</span> <span class=o>=</span> <span class=m>12</span>               <span class=c1># Độ dài tối thiểu</span>
</span></span><span class=line><span class=cl><span class=nv>dcredit</span> <span class=o>=</span> -1              <span class=c1># Yêu cầu ít nhất 1 chữ số</span>
</span></span><span class=line><span class=cl><span class=nv>ucredit</span> <span class=o>=</span> -1              <span class=c1># Yêu cầu ít nhất 1 chữ hoa</span>
</span></span><span class=line><span class=cl><span class=nv>lcredit</span> <span class=o>=</span> -1              <span class=c1># Yêu cầu ít nhất 1 chữ thường</span>
</span></span><span class=line><span class=cl><span class=nv>ocredit</span> <span class=o>=</span> -1              <span class=c1># Yêu cầu ít nhất 1 ký tự đặc biệt</span>
</span></span><span class=line><span class=cl><span class=nv>minclass</span> <span class=o>=</span> <span class=m>3</span>              <span class=c1># Yêu cầu ít nhất 3 loại ký tự</span>
</span></span><span class=line><span class=cl><span class=nv>maxrepeat</span> <span class=o>=</span> <span class=m>3</span>             <span class=c1># Tối đa ký tự giống nhau liên tiếp</span>
</span></span><span class=line><span class=cl><span class=nv>maxclassrepeat</span> <span class=o>=</span> <span class=m>4</span>        <span class=c1># Tối đa cùng loại ký tự liên tiếp</span>
</span></span><span class=line><span class=cl><span class=nv>gecoscheck</span> <span class=o>=</span> <span class=m>1</span>            <span class=c1># Từ chối password chứa username</span>
</span></span><span class=line><span class=cl><span class=nv>dictcheck</span> <span class=o>=</span> <span class=m>1</span>             <span class=c1># Kiểm tra với từ điển</span>
</span></span><span class=line><span class=cl><span class=nv>usercheck</span> <span class=o>=</span> <span class=m>1</span>             <span class=c1># Kiểm tra với username</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Credits:</span>
</span></span><span class=line><span class=cl><span class=c1># Âm = Yêu cầu tối thiểu</span>
</span></span><span class=line><span class=cl><span class=c1># Dương = Credit (giảm độ dài yêu cầu)</span>
</span></span><span class=line><span class=cl><span class=c1># Ví dụ: dcredit = -2 nghĩa là cần ít nhất 2 chữ số</span></span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=phần-6-su--sudo><span>PHẦN 6: SU & SUDO</span>
<a href=#ph%e1%ba%a7n-6-su--sudo class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=61-su---chuyển-user><span>6.1 su - Chuyển User</span>
<a href=#61-su---chuy%e1%bb%83n-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                      LỆNH SU                                │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>su = &#34;Switch User&#34; hoặc &#34;Substitute User&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│  su alice         │ Chuyển sang alice, GIỮ env hiện tại  │
</span></span><span class=line><span class=cl>│  su - alice       │ Chuyển sang alice, env ĐẦY ĐỦ        │
</span></span><span class=line><span class=cl>│  su               │ Chuyển sang root, GIỮ env hiện tại   │
</span></span><span class=line><span class=cl>│  su -             │ Chuyển sang root, env ĐẦY ĐỦ         │
</span></span><span class=line><span class=cl>│  su -l alice      │ Giống &#34;su - alice&#34;                   │
</span></span><span class=line><span class=cl>│  su -c &#34;cmd&#34; alice│ Chạy một lệnh với tư cách alice      │
</span></span><span class=line><span class=cl>└──────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Khác biệt: su vs su -
</span></span><span class=line><span class=cl>┌──────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│ su alice:                                                │
</span></span><span class=line><span class=cl>│   - Thư mục làm việc: Không đổi                          │
</span></span><span class=line><span class=cl>│   - PATH: Không đổi                                      │
</span></span><span class=line><span class=cl>│   - Environment: Hầu như không đổi                       │
</span></span><span class=line><span class=cl>│   - Shell: Non-login shell                               │
</span></span><span class=line><span class=cl>│                                                          │
</span></span><span class=line><span class=cl>│ su - alice:                                              │
</span></span><span class=line><span class=cl>│   - Thư mục làm việc: ~alice                             │
</span></span><span class=line><span class=cl>│   - PATH: PATH của alice                                 │
</span></span><span class=line><span class=cl>│   - Environment: Mới, như thể alice đăng nhập            │
</span></span><span class=line><span class=cl>│   - Shell: Login shell (đọc .profile, .bash_profile)     │
</span></span><span class=line><span class=cl>└──────────────────────────────────────────────────────────┘</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Chuyển sang root</span>
</span></span><span class=line><span class=cl>su                       <span class=c1># Giữ environment, cần password root</span>
</span></span><span class=line><span class=cl>su -                     <span class=c1># Full login, cần password root</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Chuyển sang user</span>
</span></span><span class=line><span class=cl>su alice                 <span class=c1># Cần password của alice</span>
</span></span><span class=line><span class=cl>su - alice               <span class=c1># Full login với tư cách alice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Chạy một lệnh</span>
</span></span><span class=line><span class=cl>su -c <span class=s2>&#34;ls /root&#34;</span> root    <span class=c1># Chạy lệnh với tư cách root</span>
</span></span><span class=line><span class=cl>su -c <span class=s2>&#34;whoami&#34;</span> alice     <span class=c1># Chạy lệnh với tư cách alice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Giữ environment</span>
</span></span><span class=line><span class=cl>su -p alice              <span class=c1># Giữ toàn bộ environment</span>
</span></span><span class=line><span class=cl>su -m alice              <span class=c1># Giống -p</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Chỉ định shell</span>
</span></span><span class=line><span class=cl>su -s /bin/zsh alice     <span class=c1># Dùng shell cụ thể</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bảo mật: su yêu cầu password của user ĐÍCH</span>
</span></span><span class=line><span class=cl><span class=c1># (hoặc root có thể su sang bất kỳ ai không cần password)</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=62-sudo---superuser-do><span>6.2 sudo - Superuser Do</span>
<a href=#62-sudo---superuser-do class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>┌─────────────────────────────────────────────────────────────┐</span>
</span></span><span class=line><span class=cl><span class=err>│</span>                   <span class=n>KIẾN</span> <span class=n>TRÚC</span> <span class=n>SUDO</span>                            <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>└─────────────────────────────────────────────────────────────┘</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sudo</span> <span class=o>=</span> <span class=n>Chạy</span> <span class=n>lệnh</span> <span class=n>với</span> <span class=n>tư</span> <span class=n>cách</span> <span class=n>user</span> <span class=n>khác</span> <span class=p>(</span><span class=n>thường</span> <span class=n>là</span> <span class=n>root</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Khác</span> <span class=n>với</span> <span class=n>su</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>Dùng</span> <span class=n>password</span> <span class=n>của</span> <span class=n>user</span> <span class=n>HIỆN</span> <span class=n>TẠI</span> <span class=p>(</span><span class=n>không</span> <span class=n>phải</span> <span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>Kiểm</span> <span class=n>soát</span> <span class=n>chi</span> <span class=n>tiết</span><span class=p>:</span> <span class=n>Cho</span> <span class=n>phép</span> <span class=n>lệnh</span> <span class=n>cụ</span> <span class=n>thể</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>Logging</span><span class=p>:</span> <span class=n>Tất</span> <span class=n>cả</span> <span class=n>lệnh</span> <span class=n>sudo</span> <span class=err>đượ</span><span class=n>c</span> <span class=n>ghi</span> <span class=nb>log</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>Timeout</span><span class=p>:</span> <span class=n>Không</span> <span class=n>cần</span> <span class=n>nhập</span> <span class=n>lại</span> <span class=n>password</span> <span class=n>trong</span> <span class=mi>15</span> <span class=n>phút</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>┌─────────────────────────────────────────────────────────────┐</span>
</span></span><span class=line><span class=cl><span class=err>│</span>                    <span class=n>LUỒNG</span> <span class=n>SUDO</span>                               <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>├─────────────────────────────────────────────────────────────┤</span>
</span></span><span class=line><span class=cl><span class=err>│</span>                                                             <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=n>User</span> <span class=n>chạy</span><span class=p>:</span> <span class=n>sudo</span> <span class=n>apt</span> <span class=n>update</span>                                 <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>│</span>                                                     <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>▼</span>                                                     <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>┌─────────────────────────────────────────────────────┐</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>│</span> <span class=mf>1.</span> <span class=n>Kiểm</span> <span class=n>tra</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>sudoers</span><span class=p>:</span> <span class=n>User</span> <span class=n>có</span> <span class=err>đượ</span><span class=n>c</span> <span class=n>phép</span> <span class=n>không</span><span class=err>?</span>  <span class=err>│</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>└─────────────────────────────────────────────────────┘</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>│</span> <span class=n>Có</span>                                                  <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>▼</span>                                                     <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>┌─────────────────────────────────────────────────────┐</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>│</span> <span class=mf>2.</span> <span class=n>Kiểm</span> <span class=n>tra</span> <span class=n>timestamp</span><span class=p>:</span> <span class=n>Password</span> <span class=err>đã</span> <span class=n>nhập</span> <span class=n>gần</span> <span class=err>đâ</span><span class=n>y</span><span class=err>?</span>    <span class=err>│</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>└─────────────────────────────────────────────────────┘</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>│</span> <span class=n>Chưa</span> <span class=p>(</span><span class=n>hoặc</span> <span class=n>lần</span> <span class=err>đầ</span><span class=n>u</span><span class=p>)</span>                                 <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>▼</span>                                                     <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>┌─────────────────────────────────────────────────────┐</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>│</span> <span class=mf>3.</span> <span class=n>Yêu</span> <span class=n>cầu</span> <span class=n>password</span> <span class=n>của</span> <span class=n>USER</span> <span class=p>(</span><span class=n>không</span> <span class=n>phải</span> <span class=n>root</span><span class=p>)</span>      <span class=err>│</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>└─────────────────────────────────────────────────────┘</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>│</span> <span class=err>Đú</span><span class=n>ng</span>                                                <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>▼</span>                                                     <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>┌─────────────────────────────────────────────────────┐</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>│</span> <span class=mf>4.</span> <span class=n>Thực</span> <span class=n>thi</span> <span class=n>lệnh</span> <span class=n>với</span> <span class=n>tư</span> <span class=n>cách</span> <span class=n>target</span> <span class=p>(</span><span class=n>mặc</span> <span class=err>đị</span><span class=n>nh</span> <span class=n>root</span><span class=p>)</span> <span class=err>│</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>└─────────────────────────────────────────────────────┘</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>│</span>                                                     <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>       <span class=err>▼</span>                                                     <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>┌─────────────────────────────────────────────────────┐</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>│</span> <span class=mf>5.</span> <span class=n>Ghi</span> <span class=nb>log</span> <span class=n>vào</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>auth</span><span class=o>.</span><span class=n>log</span> <span class=p>(</span><span class=n>hoặc</span> <span class=n>secure</span><span class=p>)</span>      <span class=err>│</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>  <span class=err>└─────────────────────────────────────────────────────┘</span>    <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span>                                                             <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>└─────────────────────────────────────────────────────────────┘</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Sử dụng cơ bản</span>
</span></span><span class=line><span class=cl>sudo <span class=nb>command</span>                    <span class=c1># Chạy với tư cách root</span>
</span></span><span class=line><span class=cl>sudo -u alice <span class=nb>command</span>           <span class=c1># Chạy với tư cách alice</span>
</span></span><span class=line><span class=cl>sudo -g developers <span class=nb>command</span>      <span class=c1># Chạy với group developers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Shell tương tác</span>
</span></span><span class=line><span class=cl>sudo -i                         <span class=c1># Root login shell</span>
</span></span><span class=line><span class=cl>sudo -s                         <span class=c1># Root shell (giữ env)</span>
</span></span><span class=line><span class=cl>sudo -i -u alice                <span class=c1># Alice login shell</span>
</span></span><span class=line><span class=cl>sudo su -                       <span class=c1># Cách khác để có root shell</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Giữ environment</span>
</span></span><span class=line><span class=cl>sudo -E <span class=nb>command</span>                 <span class=c1># Giữ environment hiện tại</span>
</span></span><span class=line><span class=cl>sudo <span class=nv>HOME</span><span class=o>=</span>/root <span class=nb>command</span>         <span class=c1># Ghi đè biến cụ thể</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Liệt kê lệnh được phép</span>
</span></span><span class=line><span class=cl>sudo -l                         <span class=c1># Tôi có thể chạy gì?</span>
</span></span><span class=line><span class=cl>sudo -l -U alice                <span class=c1># Alice có thể chạy gì?</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xác thực credentials</span>
</span></span><span class=line><span class=cl>sudo -v                         <span class=c1># Gia hạn timeout mà không chạy lệnh</span>
</span></span><span class=line><span class=cl>sudo -k                         <span class=c1># Hủy timestamp (sudo tiếp theo cần password)</span>
</span></span><span class=line><span class=cl>sudo -K                         <span class=c1># Xóa timestamp hoàn toàn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sửa file an toàn</span>
</span></span><span class=line><span class=cl>sudo -e /etc/config             <span class=c1># Sửa với tư cách root, dùng $EDITOR</span>
</span></span><span class=line><span class=cl>sudoedit /etc/config            <span class=c1># Giống như trên</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Chạy ở background</span>
</span></span><span class=line><span class=cl>sudo -b <span class=nb>command</span>                 <span class=c1># Chạy ở background</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Non-interactive (cho scripts)</span>
</span></span><span class=line><span class=cl>sudo -n <span class=nb>command</span>                 <span class=c1># Thất bại nếu cần password</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;password&#34;</span> <span class=p>|</span> sudo -S <span class=nb>command</span>  <span class=c1># Đọc password từ stdin</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt thư mục home</span>
</span></span><span class=line><span class=cl>sudo -H <span class=nb>command</span>                 <span class=c1># Đặt HOME thành home của target user</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=63-etcsudoers--visudo><span>6.3 /etc/sudoers & visudo</span>
<a href=#63-etcsudoers--visudo class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                 ĐỊNH DẠNG FILE SUDOERS                      │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>LUÔN sửa bằng visudo (kiểm tra cú pháp trước khi lưu)!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Định dạng:
</span></span><span class=line><span class=cl>AI    Ở_ĐÂU=(VỚI_TƯ_CÁCH:VỚI_GROUP)    GÌ
</span></span><span class=line><span class=cl>user   host=(runas_user:runas_group)   commands
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ví dụ:
</span></span><span class=line><span class=cl>root    ALL=(ALL:ALL) ALL
</span></span><span class=line><span class=cl># root có thể chạy mọi lệnh, trên mọi host, với tư cách any user/group
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%sudo   ALL=(ALL:ALL) ALL
</span></span><span class=line><span class=cl># Thành viên của group sudo có full sudo access
</span></span><span class=line><span class=cl># % prefix = group
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>alice   ALL=(ALL) /usr/bin/apt, /usr/bin/systemctl
</span></span><span class=line><span class=cl># alice chỉ có thể sudo apt và systemctl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>bob     ALL=(ALL) NOPASSWD: /usr/bin/docker
</span></span><span class=line><span class=cl># bob có thể sudo docker không cần password</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># visudo - Sửa sudoers an toàn</span>
</span></span><span class=line><span class=cl>sudo visudo                     <span class=c1># Sửa main sudoers</span>
</span></span><span class=line><span class=cl>sudo visudo -f /etc/sudoers.d/myconfig  <span class=c1># Sửa file include</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Cú pháp sudoers:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặc tả user</span>
</span></span><span class=line><span class=cl>alice   <span class=nv>ALL</span><span class=o>=(</span>ALL:ALL<span class=o>)</span> ALL                  <span class=c1># Full access</span>
</span></span><span class=line><span class=cl>alice   <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> /usr/bin/systemctl       <span class=c1># Lệnh cụ thể</span>
</span></span><span class=line><span class=cl>alice   <span class=nv>ALL</span><span class=o>=(</span>root<span class=o>)</span> /usr/bin/apt update     <span class=c1># Lệnh cụ thể + args</span>
</span></span><span class=line><span class=cl>alice   <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> /usr/bin/apt, !/usr/bin/apt remove  <span class=c1># Cho phép apt, cấm apt remove</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặc tả group (prefix với %)</span>
</span></span><span class=line><span class=cl>%admins <span class=nv>ALL</span><span class=o>=(</span>ALL:ALL<span class=o>)</span> ALL
</span></span><span class=line><span class=cl>%developers <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> /usr/bin/docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># NOPASSWD - Không cần password</span>
</span></span><span class=line><span class=cl>alice   <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> NOPASSWD: /usr/bin/systemctl restart nginx
</span></span><span class=line><span class=cl>%wheel  <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> NOPASSWD: ALL
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># NOEXEC - Ngăn shell escapes</span>
</span></span><span class=line><span class=cl>alice   <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> NOEXEC: /usr/bin/vim
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Host aliases</span>
</span></span><span class=line><span class=cl>Host_Alias <span class=nv>WEBSERVERS</span> <span class=o>=</span> web1, web2, web3
</span></span><span class=line><span class=cl>alice   <span class=nv>WEBSERVERS</span><span class=o>=(</span>ALL<span class=o>)</span> /usr/bin/systemctl restart nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># User aliases</span>
</span></span><span class=line><span class=cl>User_Alias <span class=nv>ADMINS</span> <span class=o>=</span> alice, bob, charlie
</span></span><span class=line><span class=cl>ADMINS  <span class=nv>ALL</span><span class=o>=(</span>ALL:ALL<span class=o>)</span> ALL
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Command aliases</span>
</span></span><span class=line><span class=cl>Cmnd_Alias <span class=nv>SERVICES</span> <span class=o>=</span> /usr/bin/systemctl start *, /usr/bin/systemctl stop *, /usr/bin/systemctl restart *
</span></span><span class=line><span class=cl>Cmnd_Alias <span class=nv>DANGEROUS</span> <span class=o>=</span> /bin/rm, /bin/dd, /sbin/fdisk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>alice   <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> SERVICES
</span></span><span class=line><span class=cl>bob     <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> ALL, !DANGEROUS
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Defaults</span>
</span></span><span class=line><span class=cl>Defaults    env_reset           <span class=c1># Reset environment</span>
</span></span><span class=line><span class=cl>Defaults    mail_badpass        <span class=c1># Gửi email khi password sai</span>
</span></span><span class=line><span class=cl>Defaults    <span class=nv>secure_path</span><span class=o>=</span><span class=s2>&#34;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;</span>
</span></span><span class=line><span class=cl>Defaults    <span class=nv>timestamp_timeout</span><span class=o>=</span><span class=m>15</span>  <span class=c1># Phút timeout password</span>
</span></span><span class=line><span class=cl>Defaults    <span class=nv>passwd_tries</span><span class=o>=</span><span class=m>3</span>      <span class=c1># Số lần thử password</span>
</span></span><span class=line><span class=cl>Defaults    <span class=nv>logfile</span><span class=o>=</span>/var/log/sudo.log  <span class=c1># File log tùy chỉnh</span>
</span></span><span class=line><span class=cl>Defaults:alice !requiretty      <span class=c1># Không yêu cầu TTY cho alice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Include files (khuyến nghị để tổ chức)</span>
</span></span><span class=line><span class=cl><span class=c1># Đặt files trong /etc/sudoers.d/</span>
</span></span><span class=line><span class=cl>@includedir /etc/sudoers.d</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=64-best-practices><span>6.4 Best Practices</span>
<a href=#64-best-practices class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>┌─────────────────────────────────────────────────────────────┐</span>
</span></span><span class=line><span class=cl><span class=err>│</span>                <span class=n>SUDO</span> <span class=n>BEST</span> <span class=n>PRACTICES</span>                          <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>└─────────────────────────────────────────────────────────────┘</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>1.</span> <span class=n>KHÔNG</span> <span class=n>BAO</span> <span class=n>GIỜ</span> <span class=n>sửa</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>sudoers</span> <span class=n>trực</span> <span class=n>tiếp</span> <span class=o>-</span> <span class=n>luôn</span> <span class=n>dùng</span> <span class=n>visudo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>2.</span> <span class=n>Dùng</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>sudoers</span><span class=o>.</span><span class=n>d</span><span class=o>/</span> <span class=n>cho</span> <span class=n>configs</span> <span class=n>module</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>sudoers</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>admins</span>
</span></span><span class=line><span class=cl>   <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>sudoers</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>developers</span>
</span></span><span class=line><span class=cl>   <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>sudoers</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>monitoring</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>3.</span> <span class=n>Nguyên</span> <span class=n>tắc</span> <span class=n>quyền</span> <span class=n>tối</span> <span class=n>thiểu</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=n>Cấp</span> <span class=n>quyền</span> <span class=n>tối</span> <span class=n>thiểu</span> <span class=n>cần</span> <span class=n>thiết</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=n>Dùng</span> <span class=n>lệnh</span> <span class=n>cụ</span> <span class=n>thể</span><span class=p>,</span> <span class=n>không</span> <span class=n>phải</span> <span class=n>ALL</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=n>Tránh</span> <span class=n>NOPASSWD</span> <span class=n>khi</span> <span class=n>có</span> <span class=n>thể</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>4.</span> <span class=n>Dùng</span> <span class=n>groups</span> <span class=n>thay</span> <span class=n>vì</span> <span class=n>individual</span> <span class=n>users</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=o>%</span><span class=n>admins</span> <span class=n>ALL</span><span class=o>=</span><span class=p>(</span><span class=n>ALL</span><span class=p>:</span><span class=n>ALL</span><span class=p>)</span> <span class=n>ALL</span>
</span></span><span class=line><span class=cl>   <span class=c1># Dễ quản lý hơn liệt kê từng user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>5.</span> <span class=n>Log</span> <span class=n>và</span> <span class=n>audit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=n>Bật</span> <span class=n>logging</span><span class=p>:</span> <span class=n>Defaults</span> <span class=n>logfile</span><span class=o>=/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>sudo</span><span class=o>.</span><span class=n>log</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=n>Review</span> <span class=n>logs</span> <span class=n>thường</span> <span class=n>xuyên</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=err>Đặ</span><span class=n>t</span> <span class=n>alerts</span> <span class=n>cho</span> <span class=n>hoạt</span> <span class=err>độ</span><span class=n>ng</span> <span class=err>đá</span><span class=n>ng</span> <span class=n>ngờ</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>6.</span> <span class=n>Tránh</span> <span class=n>lệnh</span> <span class=n>nguy</span> <span class=n>hiểm</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=n>Cmnd_Alias</span> <span class=n>SHELLS</span> <span class=o>=</span> <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span><span class=p>,</span> <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sh</span><span class=p>,</span> <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>zsh</span>
</span></span><span class=line><span class=cl>   <span class=n>Cmnd_Alias</span> <span class=n>DANGEROUS</span> <span class=o>=</span> <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>rm</span> <span class=o>-</span><span class=n>rf</span> <span class=o>/</span><span class=p>,</span> <span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>shutdown</span>
</span></span><span class=line><span class=cl>   <span class=n>alice</span> <span class=n>ALL</span><span class=o>=</span><span class=p>(</span><span class=n>ALL</span><span class=p>)</span> <span class=n>ALL</span><span class=p>,</span> <span class=o>!</span><span class=n>SHELLS</span><span class=p>,</span> <span class=o>!</span><span class=n>DANGEROUS</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>7.</span> <span class=n>Cẩn</span> <span class=n>thận</span> <span class=n>với</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=n>sudo</span> <span class=n>vim</span> <span class=p>(</span><span class=n>có</span> <span class=n>thể</span> <span class=n>escape</span> <span class=n>sang</span> <span class=n>shell</span> <span class=n>với</span> <span class=p>:</span><span class=o>!/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=n>sudo</span> <span class=n>less</span> <span class=p>(</span><span class=n>có</span> <span class=n>thể</span> <span class=n>escape</span> <span class=n>với</span> <span class=o>!</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span> <span class=n>Bất</span> <span class=n>kỳ</span> <span class=n>editor</span> <span class=n>hoặc</span> <span class=n>pager</span> <span class=n>nào</span>
</span></span><span class=line><span class=cl>   <span class=err>→</span> <span class=n>Dùng</span> <span class=n>NOEXEC</span><span class=p>:</span> <span class=n>alice</span> <span class=n>ALL</span><span class=o>=</span><span class=p>(</span><span class=n>ALL</span><span class=p>)</span> <span class=n>NOEXEC</span><span class=p>:</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>vim</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=65-so-sánh-su-vs-sudo><span>6.5 So Sánh su vs sudo</span>
<a href=#65-so-s%c3%a1nh-su-vs-sudo class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌───────────────────┬─────────────────────┬─────────────────────┐
</span></span><span class=line><span class=cl>│ Tính năng         │ su                  │ sudo                │
</span></span><span class=line><span class=cl>├───────────────────┼─────────────────────┼─────────────────────┤
</span></span><span class=line><span class=cl>│ Password          │ Của user đích       │ Của user hiện tại   │
</span></span><span class=line><span class=cl>│ Chi tiết          │ Tất cả hoặc không   │ Theo từng lệnh      │
</span></span><span class=line><span class=cl>│ Logging           │ Cơ bản (PAM)        │ Chi tiết            │
</span></span><span class=line><span class=cl>│ Session           │ Full shell          │ Lệnh đơn lẻ         │
</span></span><span class=line><span class=cl>│ Password root     │ Cần thiết           │ Không cần           │
</span></span><span class=line><span class=cl>│ Cấu hình          │ Không có            │ /etc/sudoers        │
</span></span><span class=line><span class=cl>│ Use case          │ Trở thành user khác │ Chạy lệnh đơn lẻ    │
</span></span><span class=line><span class=cl>└───────────────────┴─────────────────────┴─────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Khuyến nghị: Ưu tiên sudo hơn su
</span></span><span class=line><span class=cl>- Disable root login
</span></span><span class=line><span class=cl>- Dùng sudo cho tất cả tác vụ quản trị
</span></span><span class=line><span class=cl>- Log và audit việc sử dụng sudo</span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=phần-7-pam---pluggable-authentication-modules><span>PHẦN 7: PAM - PLUGGABLE AUTHENTICATION MODULES</span>
<a href=#ph%e1%ba%a7n-7-pam---pluggable-authentication-modules class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=71-kiến-trúc-pam><span>7.1 Kiến Trúc PAM</span>
<a href=#71-ki%e1%ba%bfn-tr%c3%bac-pam class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                    KIẾN TRÚC PAM                            │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PAM = Framework cho authentication, pluggable và configurable
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                    Ứng dụng                                 │
</span></span><span class=line><span class=cl>│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐             │
</span></span><span class=line><span class=cl>│  │ login  │  │  sshd  │  │  sudo  │  │  su    │             │
</span></span><span class=line><span class=cl>│  └───┬────┘  └───┬────┘  └───┬────┘  └───┬────┘             │
</span></span><span class=line><span class=cl>│      │           │           │           │                  │
</span></span><span class=line><span class=cl>│      └───────────┴───────────┴───────────┘                  │
</span></span><span class=line><span class=cl>│                         │                                   │
</span></span><span class=line><span class=cl>│                    ┌────▼────┐                              │
</span></span><span class=line><span class=cl>│                    │ libpam  │                              │
</span></span><span class=line><span class=cl>│                    └────┬────┘                              │
</span></span><span class=line><span class=cl>│                         │                                   │
</span></span><span class=line><span class=cl>│      ┌─────────────────┬┴┬─────────────────┐                │
</span></span><span class=line><span class=cl>│      │                 │ │                 │                │
</span></span><span class=line><span class=cl>│  ┌───▼───┐        ┌────▼─▼──┐         ┌────▼───┐            │
</span></span><span class=line><span class=cl>│  │pam_unix│       │pam_ldap │         │pam_sss │            │
</span></span><span class=line><span class=cl>│  │(/etc/  │       │(LDAP)   │         │(SSSD)  │            │
</span></span><span class=line><span class=cl>│  │shadow) │       │         │         │        │            │
</span></span><span class=line><span class=cl>│  └────────┘       └─────────┘         └────────┘            │
</span></span><span class=line><span class=cl>│                                                             │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Vị trí PAM Modules: /lib/x86_64-linux-gnu/security/
</span></span><span class=line><span class=cl>                hoặc /lib/security/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Modules phổ biến:
</span></span><span class=line><span class=cl>- pam_unix.so      - Truyền thống /etc/passwd, /etc/shadow
</span></span><span class=line><span class=cl>- pam_ldap.so      - Xác thực LDAP
</span></span><span class=line><span class=cl>- pam_sss.so       - SSSD (AD, LDAP)
</span></span><span class=line><span class=cl>- pam_deny.so      - Luôn từ chối
</span></span><span class=line><span class=cl>- pam_permit.so    - Luôn cho phép
</span></span><span class=line><span class=cl>- pam_pwquality.so - Kiểm tra chất lượng password
</span></span><span class=line><span class=cl>- pam_limits.so    - Giới hạn tài nguyên
</span></span><span class=line><span class=cl>- pam_tally2.so    - Đếm lần đăng nhập thất bại
</span></span><span class=line><span class=cl>- pam_google_authenticator.so - 2FA</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=72-cấu-hình-pam><span>7.2 Cấu Hình PAM</span>
<a href=#72-c%e1%ba%a5u-h%c3%acnh-pam class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│               FILES CẤU HÌNH PAM                            │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Vị trí: /etc/pam.d/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Configs theo service:
</span></span><span class=line><span class=cl>/etc/pam.d/login        # Console login
</span></span><span class=line><span class=cl>/etc/pam.d/sshd         # SSH login
</span></span><span class=line><span class=cl>/etc/pam.d/sudo         # Lệnh sudo
</span></span><span class=line><span class=cl>/etc/pam.d/su           # Lệnh su
</span></span><span class=line><span class=cl>/etc/pam.d/passwd       # Lệnh passwd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Configs chung (được include bởi các file khác):
</span></span><span class=line><span class=cl>/etc/pam.d/common-auth      # Xác thực
</span></span><span class=line><span class=cl>/etc/pam.d/common-account   # Quản lý account
</span></span><span class=line><span class=cl>/etc/pam.d/common-password  # Đổi password
</span></span><span class=line><span class=cl>/etc/pam.d/common-session   # Thiết lập/dọn dẹp session</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=73-định-dạng-config-pam><span>7.3 Định Dạng Config PAM</span>
<a href=#73-%c4%91%e1%bb%8bnh-d%e1%ba%a1ng-config-pam class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                ĐỊNH DẠNG DÒNG CONFIG PAM                    │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>type    control    module-path    [module-arguments]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TYPE (interface module):
</span></span><span class=line><span class=cl>┌──────────┬───────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│ auth     │ Xác minh danh tính user (password, token, v.v.)   │
</span></span><span class=line><span class=cl>│ account  │ Kiểm tra trạng thái account (hết hạn? bị khóa?)   │
</span></span><span class=line><span class=cl>│ password │ Đổi password                                      │
</span></span><span class=line><span class=cl>│ session  │ Thiết lập/dọn dẹp session (env, logging, limits)  │
</span></span><span class=line><span class=cl>└──────────┴───────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CONTROL (xử lý kết quả):
</span></span><span class=line><span class=cl>┌──────────┬───────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│ required │ Phải pass, tiếp tục kiểm tra các modules khác     │
</span></span><span class=line><span class=cl>│ requisite│ Phải pass, thất bại ngay lập tức nếu không        │
</span></span><span class=line><span class=cl>│ sufficient│ Nếu pass, trả về thành công (bỏ qua còn lại)     │
</span></span><span class=line><span class=cl>│ optional │ Chỉ quan trọng nếu không có module nào khác       │
</span></span><span class=line><span class=cl>│ include  │ Include file config khác                          │
</span></span><span class=line><span class=cl>└──────────┴───────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ví dụ /etc/pam.d/sudo:
</span></span><span class=line><span class=cl>#%PAM-1.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>auth       required   pam_env.so
</span></span><span class=line><span class=cl>auth       required   pam_faildelay.so delay=2000000
</span></span><span class=line><span class=cl>auth       requisite  pam_unix.so nullok
</span></span><span class=line><span class=cl>auth       sufficient pam_sss.so use_first_pass
</span></span><span class=line><span class=cl>auth       required   pam_deny.so
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>account    required   pam_unix.so
</span></span><span class=line><span class=cl>account    sufficient pam_localuser.so
</span></span><span class=line><span class=cl>account    [default=bad success=ok] pam_sss.so
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>session    required   pam_limits.so
</span></span><span class=line><span class=cl>session    required   pam_unix.so
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Luồng:
</span></span><span class=line><span class=cl># 1. auth: pam_env.so (đặt env) - required, phải pass
</span></span><span class=line><span class=cl># 2. auth: pam_faildelay.so (thêm delay khi thất bại) - required
</span></span><span class=line><span class=cl># 3. auth: pam_unix.so (kiểm tra /etc/shadow) - requisite, thất bại = dừng
</span></span><span class=line><span class=cl># 4. auth: pam_sss.so (kiểm tra SSSD) - sufficient, pass = xong
</span></span><span class=line><span class=cl># 5. auth: pam_deny.so - fallback từ chối</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=74-ví-dụ-pam-hữu-ích><span>7.4 Ví Dụ PAM Hữu Ích</span>
<a href=#74-v%c3%ad-d%e1%bb%a5-pam-h%e1%bb%afu-%c3%adch class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Giới hạn đăng nhập đồng thời (pam_limits.so)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/security/limits.conf</span>
</span></span><span class=line><span class=cl>alice    hard    maxlogins    <span class=m>3</span>
</span></span><span class=line><span class=cl>*        hard    maxlogins    <span class=m>10</span>
</span></span><span class=line><span class=cl>@developers hard maxlogins    <span class=m>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Hạn chế giờ đăng nhập (pam_time.so)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/security/time.conf</span>
</span></span><span class=line><span class=cl>login<span class=p>;</span>*<span class=p>;</span>alice<span class=p>;</span>!Al0000-2400    <span class=c1># alice không thể đăng nhập cuối tuần</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xác thực hai yếu tố (pam_google_authenticator.so)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/pam.d/sshd</span>
</span></span><span class=line><span class=cl>auth required pam_google_authenticator.so
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Khóa sau đăng nhập thất bại (pam_faillock.so - thay thế pam_tally2)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/pam.d/common-auth</span>
</span></span><span class=line><span class=cl>auth required pam_faillock.so preauth silent <span class=nv>deny</span><span class=o>=</span><span class=m>5</span> <span class=nv>unlock_time</span><span class=o>=</span><span class=m>900</span>
</span></span><span class=line><span class=cl>auth <span class=o>[</span><span class=nv>default</span><span class=o>=</span>die<span class=o>]</span> pam_faillock.so authfail <span class=nv>deny</span><span class=o>=</span><span class=m>5</span> <span class=nv>unlock_time</span><span class=o>=</span><span class=m>900</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Chất lượng password (pam_pwquality.so)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/pam.d/common-password</span>
</span></span><span class=line><span class=cl>password requisite pam_pwquality.so <span class=nv>retry</span><span class=o>=</span><span class=m>3</span> <span class=nv>minlen</span><span class=o>=</span><span class=m>12</span> <span class=nv>difok</span><span class=o>=</span><span class=m>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Disable đăng nhập root trực tiếp</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/pam.d/login</span>
</span></span><span class=line><span class=cl>auth required pam_securetty.so
</span></span><span class=line><span class=cl><span class=c1># Và đảm bảo /etc/securetty trống hoặc không tồn tại</span></span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=phần-8-mặc-định-hệ-thống><span>PHẦN 8: MẶC ĐỊNH HỆ THỐNG</span>
<a href=#ph%e1%ba%a7n-8-m%e1%ba%b7c-%c4%91%e1%bb%8bnh-h%e1%bb%87-th%e1%bb%91ng class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=81-etclogindefs><span>8.1 /etc/login.defs</span>
<a href=#81-etclogindefs class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># /etc/login.defs - Mặc định toàn hệ thống cho quản lý user/password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thời hạn password</span>
</span></span><span class=line><span class=cl>PASS_MAX_DAYS   <span class=m>90</span>        <span class=c1># Password hết hạn sau 90 ngày</span>
</span></span><span class=line><span class=cl>PASS_MIN_DAYS   <span class=m>7</span>         <span class=c1># Không thể đổi password trong 7 ngày</span>
</span></span><span class=line><span class=cl>PASS_WARN_AGE   <span class=m>14</span>        <span class=c1># Cảnh báo 14 ngày trước khi hết hạn</span>
</span></span><span class=line><span class=cl>PASS_MIN_LEN    <span class=m>8</span>         <span class=c1># Độ dài password tối thiểu (pam_pwquality ghi đè)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Cấp phát UID/GID</span>
</span></span><span class=line><span class=cl>UID_MIN         <span class=m>1000</span>      <span class=c1># UID tối thiểu cho users thường</span>
</span></span><span class=line><span class=cl>UID_MAX         <span class=m>60000</span>     <span class=c1># UID tối đa cho users thường</span>
</span></span><span class=line><span class=cl>SYS_UID_MIN     <span class=m>201</span>       <span class=c1># UID tối thiểu cho system users</span>
</span></span><span class=line><span class=cl>SYS_UID_MAX     <span class=m>999</span>       <span class=c1># UID tối đa cho system users</span>
</span></span><span class=line><span class=cl>GID_MIN         <span class=m>1000</span>
</span></span><span class=line><span class=cl>GID_MAX         <span class=m>60000</span>
</span></span><span class=line><span class=cl>SYS_GID_MIN     <span class=m>201</span>
</span></span><span class=line><span class=cl>SYS_GID_MAX     <span class=m>999</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Băm password</span>
</span></span><span class=line><span class=cl>ENCRYPT_METHOD  SHA512    <span class=c1># SHA512 (khuyến nghị)</span>
</span></span><span class=line><span class=cl>SHA_CRYPT_MIN_ROUNDS <span class=m>5000</span> <span class=c1># Số vòng tối thiểu</span>
</span></span><span class=line><span class=cl>SHA_CRYPT_MAX_ROUNDS <span class=m>5000</span> <span class=c1># Số vòng tối đa</span>
</span></span><span class=line><span class=cl><span class=c1># Nhiều vòng hơn = khó crack hơn, nhưng cũng chậm đăng nhập hơn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thư mục home</span>
</span></span><span class=line><span class=cl>CREATE_HOME     yes       <span class=c1># useradd tạo home mặc định</span>
</span></span><span class=line><span class=cl>UMASK           <span class=m>077</span>       <span class=c1># Quyền mặc định: 700</span>
</span></span><span class=line><span class=cl>HOME_MODE       <span class=m>0700</span>      <span class=c1># Thay thế cho UMASK</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Cài đặt đăng nhập</span>
</span></span><span class=line><span class=cl>FAIL_DELAY      <span class=m>3</span>         <span class=c1># Giây delay sau đăng nhập thất bại</span>
</span></span><span class=line><span class=cl>LOGIN_RETRIES   <span class=m>3</span>         <span class=c1># Số lần đăng nhập thất bại trước khi ngắt kết nối</span>
</span></span><span class=line><span class=cl>LOGIN_TIMEOUT   <span class=m>60</span>        <span class=c1># Giây đợi đăng nhập</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Khác</span>
</span></span><span class=line><span class=cl>USERGROUPS_ENAB yes       <span class=c1># Tạo group cùng tên với user</span>
</span></span><span class=line><span class=cl>DEFAULT_HOME    yes       <span class=c1># Đăng nhập ngay cả khi không có thư mục home</span>
</span></span><span class=line><span class=cl>ENV_PATH        <span class=nv>PATH</span><span class=o>=</span>/usr/local/bin:/usr/bin:/bin
</span></span><span class=line><span class=cl>ENV_SUPATH      <span class=nv>PATH</span><span class=o>=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=82-etcskel---thư-mục-skeleton><span>8.2 /etc/skel - Thư Mục Skeleton</span>
<a href=#82-etcskel---th%c6%b0-m%e1%bb%a5c-skeleton class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># /etc/skel chứa files được copy sang thư mục home của user mới</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ls -la /etc/skel/
</span></span><span class=line><span class=cl><span class=c1># .bash_logout</span>
</span></span><span class=line><span class=cl><span class=c1># .bashrc</span>
</span></span><span class=line><span class=cl><span class=c1># .profile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tùy chỉnh cho tất cả users mới:</span>
</span></span><span class=line><span class=cl>cp /etc/skel/.bashrc /etc/skel/.bashrc.bak
</span></span><span class=line><span class=cl>cat &gt;&gt; /etc/skel/.bashrc <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s># Cài đặt tùy chỉnh cho tất cả users
</span></span></span><span class=line><span class=cl><span class=s>export EDITOR=vim
</span></span></span><span class=line><span class=cl><span class=s>alias ll=&#39;ls -la&#39;
</span></span></span><span class=line><span class=cl><span class=s>alias la=&#39;ls -A&#39;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thêm thư mục mặc định</span>
</span></span><span class=line><span class=cl>mkdir -p /etc/skel/<span class=o>{</span>Documents,Downloads,Projects<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thêm thư mục SSH với quyền đúng</span>
</span></span><span class=line><span class=cl>mkdir -p /etc/skel/.ssh
</span></span><span class=line><span class=cl>chmod <span class=m>700</span> /etc/skel/.ssh
</span></span><span class=line><span class=cl>touch /etc/skel/.ssh/authorized_keys
</span></span><span class=line><span class=cl>chmod <span class=m>600</span> /etc/skel/.ssh/authorized_keys
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Users mới sẽ có cấu trúc này:</span>
</span></span><span class=line><span class=cl><span class=c1># /home/newuser/</span>
</span></span><span class=line><span class=cl><span class=c1># ├── .bash_logout</span>
</span></span><span class=line><span class=cl><span class=c1># ├── .bashrc</span>
</span></span><span class=line><span class=cl><span class=c1># ├── .profile</span>
</span></span><span class=line><span class=cl><span class=c1># ├── .ssh/</span>
</span></span><span class=line><span class=cl><span class=c1># │   └── authorized_keys</span>
</span></span><span class=line><span class=cl><span class=c1># ├── Documents/</span>
</span></span><span class=line><span class=cl><span class=c1># ├── Downloads/</span>
</span></span><span class=line><span class=cl><span class=c1># └── Projects/</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=83-etcdefaultuseradd><span>8.3 /etc/default/useradd</span>
<a href=#83-etcdefaultuseradd class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># /etc/default/useradd - Mặc định lệnh useradd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem defaults hiện tại</span>
</span></span><span class=line><span class=cl>useradd -D
</span></span><span class=line><span class=cl><span class=c1># GROUP=100               # Group mặc định</span>
</span></span><span class=line><span class=cl><span class=c1># HOME=/home              # Thư mục base cho home</span>
</span></span><span class=line><span class=cl><span class=c1># INACTIVE=-1             # Ngày inactive (-1 = không bao giờ)</span>
</span></span><span class=line><span class=cl><span class=c1># EXPIRE=                 # Ngày hết hạn (trống = không bao giờ)</span>
</span></span><span class=line><span class=cl><span class=c1># SHELL=/bin/sh           # Shell mặc định</span>
</span></span><span class=line><span class=cl><span class=c1># SKEL=/etc/skel          # Thư mục skeleton</span>
</span></span><span class=line><span class=cl><span class=c1># CREATE_MAIL_SPOOL=yes   # Tạo mail spool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Nội dung file:</span>
</span></span><span class=line><span class=cl>cat /etc/default/useradd
</span></span><span class=line><span class=cl><span class=c1># GROUP=100               # Group mặc định nếu -g không chỉ định</span>
</span></span><span class=line><span class=cl><span class=c1># HOME=/home              # Thư mục base cho home</span>
</span></span><span class=line><span class=cl><span class=c1># INACTIVE=-1             # Ngày sau khi password hết hạn đến khi disable (-1 = không bao giờ)</span>
</span></span><span class=line><span class=cl><span class=c1># EXPIRE=                 # Ngày hết hạn account (trống = không bao giờ)</span>
</span></span><span class=line><span class=cl><span class=c1># SHELL=/bin/sh           # Shell mặc định</span>
</span></span><span class=line><span class=cl><span class=c1># SKEL=/etc/skel          # Thư mục skeleton</span>
</span></span><span class=line><span class=cl><span class=c1># CREATE_MAIL_SPOOL=yes   # Tạo file mail spool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thay đổi defaults</span>
</span></span><span class=line><span class=cl>useradd -D -s /bin/bash              <span class=c1># Shell mặc định</span>
</span></span><span class=line><span class=cl>useradd -D -b /data/users            <span class=c1># Thư mục home base</span>
</span></span><span class=line><span class=cl>useradd -D -e 2025-12-31             <span class=c1># Ngày hết hạn mặc định</span>
</span></span><span class=line><span class=cl>useradd -D -f <span class=m>30</span>                     <span class=c1># Inactive sau 30 ngày</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Hoặc sửa file trực tiếp</span>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s|SHELL=/bin/sh|SHELL=/bin/bash|&#39;</span> /etc/default/useradd</span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=phần-9-chủ-đề-nâng-cao><span>PHẦN 9: CHỦ ĐỀ NÂNG CAO</span>
<a href=#ph%e1%ba%a7n-9-ch%e1%bb%a7-%c4%91%e1%bb%81-n%c3%a2ng-cao class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=91-access-control-lists-acl><span>9.1 Access Control Lists (ACL)</span>
<a href=#91-access-control-lists-acl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                     POSIX ACLs                              │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Quyền truyền thống: 3 bộ (owner, group, others)
</span></span><span class=line><span class=cl>ACL: Quyền chi tiết cho users/groups cụ thể
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│ Truyền thống: -rw-r--r-- alice:developers file.txt       │
</span></span><span class=line><span class=cl>│                                                          │
</span></span><span class=line><span class=cl>│ Với ACL:                                                 │
</span></span><span class=line><span class=cl>│   owner: alice       → rwx                               │
</span></span><span class=line><span class=cl>│   group: developers  → r-x                               │
</span></span><span class=line><span class=cl>│   user:bob           → rw-    ← ACL entry                │
</span></span><span class=line><span class=cl>│   user:charlie       → r--    ← ACL entry                │
</span></span><span class=line><span class=cl>│   group:testers      → r-x    ← ACL entry                │
</span></span><span class=line><span class=cl>│   others             → ---                               │
</span></span><span class=line><span class=cl>│   mask               → rwx    ← Quyền effective tối đa   │
</span></span><span class=line><span class=cl>└──────────────────────────────────────────────────────────┘</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Bật ACL (thường đã bật mặc định trên hệ thống hiện đại)</span>
</span></span><span class=line><span class=cl>mount -o remount,acl /home
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem ACL</span>
</span></span><span class=line><span class=cl>getfacl file.txt
</span></span><span class=line><span class=cl><span class=c1># # file: file.txt</span>
</span></span><span class=line><span class=cl><span class=c1># # owner: alice</span>
</span></span><span class=line><span class=cl><span class=c1># # group: developers</span>
</span></span><span class=line><span class=cl><span class=c1># user::rw-</span>
</span></span><span class=line><span class=cl><span class=c1># user:bob:rw-</span>
</span></span><span class=line><span class=cl><span class=c1># group::r--</span>
</span></span><span class=line><span class=cl><span class=c1># mask::rw-</span>
</span></span><span class=line><span class=cl><span class=c1># other::r--</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt ACL cho user</span>
</span></span><span class=line><span class=cl>setfacl -m u:bob:rw file.txt          <span class=c1># Thêm/sửa ACL user</span>
</span></span><span class=line><span class=cl>setfacl -m u:charlie:r file.txt       <span class=c1># Thêm user khác</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt ACL cho group</span>
</span></span><span class=line><span class=cl>setfacl -m g:testers:rx file.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xóa ACL</span>
</span></span><span class=line><span class=cl>setfacl -x u:bob file.txt             <span class=c1># Xóa entry cụ thể</span>
</span></span><span class=line><span class=cl>setfacl -b file.txt                   <span class=c1># Xóa tất cả ACLs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ACL mặc định (cho thư mục - được kế thừa bởi files mới)</span>
</span></span><span class=line><span class=cl>setfacl -d -m u:bob:rw /shared        <span class=c1># ACL mặc định cho files mới</span>
</span></span><span class=line><span class=cl>setfacl -d -m g:developers:rx /shared
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đệ quy</span>
</span></span><span class=line><span class=cl>setfacl -R -m u:bob:rx /project       <span class=c1># Áp dụng cho tất cả files hiện có</span>
</span></span><span class=line><span class=cl>setfacl -R -d -m u:bob:rx /project    <span class=c1># Đặt mặc định cho files mới</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Copy ACL từ file này sang file khác</span>
</span></span><span class=line><span class=cl>getfacl file1.txt <span class=p>|</span> setfacl --set-file<span class=o>=</span>- file2.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Backup và restore ACLs</span>
</span></span><span class=line><span class=cl>getfacl -R /data &gt; acl_backup.txt
</span></span><span class=line><span class=cl>setfacl --restore<span class=o>=</span>acl_backup.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ACL mask (giới hạn quyền effective)</span>
</span></span><span class=line><span class=cl>setfacl -m m::rx file.txt             <span class=c1># Effective tối đa: r-x</span>
</span></span><span class=line><span class=cl><span class=c1># Nếu user:bob có rw-, effective sẽ là r-- (bị mask)</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=92-linux-capabilities><span>9.2 Linux Capabilities</span>
<a href=#92-linux-capabilities class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>┌─────────────────────────────────────────────────────────────┐</span>
</span></span><span class=line><span class=cl><span class=err>│</span>                  <span class=n>LINUX</span> <span class=n>CAPABILITIES</span>                         <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>└─────────────────────────────────────────────────────────────┘</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Truyền</span> <span class=n>thống</span><span class=p>:</span> <span class=n>root</span> <span class=p>(</span><span class=n>UID</span> <span class=mi>0</span><span class=p>)</span> <span class=n>có</span> <span class=n>TẤT</span> <span class=n>CẢ</span> <span class=err>đặ</span><span class=n>c</span> <span class=n>quyền</span>
</span></span><span class=line><span class=cl><span class=n>Capabilities</span><span class=p>:</span> <span class=n>Chia</span> <span class=n>nhỏ</span> <span class=err>đặ</span><span class=n>c</span> <span class=n>quyền</span> <span class=n>root</span> <span class=n>thành</span> <span class=n>các</span> <span class=err>đơ</span><span class=n>n</span> <span class=n>vị</span> <span class=n>riêng</span> <span class=n>biệt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Thay</span> <span class=n>vì</span><span class=p>:</span> <span class=n>chown</span> <span class=n>root</span><span class=p>:</span><span class=n>root</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>ping</span> <span class=o>&amp;&amp;</span> <span class=n>chmod</span> <span class=n>u</span><span class=o>+</span><span class=n>s</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>ping</span>
</span></span><span class=line><span class=cl><span class=n>Dùng</span><span class=p>:</span>    <span class=n>setcap</span> <span class=n>cap_net_raw</span><span class=o>+</span><span class=n>ep</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>ping</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Capabilities</span> <span class=n>phổ</span> <span class=n>biến</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=err>┌──────────────────────┬──────────────────────────────────────┐</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_NET_BIND_SERVICE</span> <span class=err>│</span> <span class=n>Bind</span> <span class=n>vào</span> <span class=n>ports</span> <span class=o>&lt;</span> <span class=mi>1024</span>                <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_NET_RAW</span>          <span class=err>│</span> <span class=n>Dùng</span> <span class=n>raw</span> <span class=n>sockets</span> <span class=p>(</span><span class=n>ping</span><span class=p>)</span>              <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_SYS_ADMIN</span>        <span class=err>│</span> <span class=n>Nhiều</span> <span class=n>thao</span> <span class=n>tác</span> <span class=n>admin</span> <span class=n>khác</span> <span class=n>nhau</span>       <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_SETUID</span>           <span class=err>│</span> <span class=err>Đổ</span><span class=n>i</span> <span class=n>UID</span>                              <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_SETGID</span>           <span class=err>│</span> <span class=err>Đổ</span><span class=n>i</span> <span class=n>GID</span>                              <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_CHOWN</span>            <span class=err>│</span> <span class=err>Đổ</span><span class=n>i</span> <span class=n>quyền</span> <span class=n>sở</span> <span class=n>hữu</span> <span class=n>file</span>                <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_DAC_OVERRIDE</span>     <span class=err>│</span> <span class=n>Bỏ</span> <span class=n>qua</span> <span class=n>quyền</span> <span class=err>đọ</span><span class=n>c</span><span class=o>/</span><span class=n>ghi</span><span class=o>/</span><span class=n>thực</span> <span class=n>thi</span> <span class=n>file</span>   <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_KILL</span>             <span class=err>│</span> <span class=n>Gửi</span> <span class=n>signals</span> <span class=err>đế</span><span class=n>n</span> <span class=n>bất</span> <span class=n>kỳ</span> <span class=n>process</span> <span class=n>nào</span>   <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>│</span> <span class=n>CAP_SYS_PTRACE</span>       <span class=err>│</span> <span class=n>Trace</span> <span class=n>bất</span> <span class=n>kỳ</span> <span class=n>process</span> <span class=n>nào</span>             <span class=err>│</span>
</span></span><span class=line><span class=cl><span class=err>└──────────────────────┴──────────────────────────────────────┘</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Xem capabilities của file</span>
</span></span><span class=line><span class=cl>getcap /usr/bin/ping
</span></span><span class=line><span class=cl><span class=c1># /usr/bin/ping = cap_net_raw+ep</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Đặt capabilities</span>
</span></span><span class=line><span class=cl>setcap cap_net_bind_service+ep /usr/bin/myapp
</span></span><span class=line><span class=cl><span class=c1># +ep = effective + permitted</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xóa capabilities</span>
</span></span><span class=line><span class=cl>setcap -r /usr/bin/myapp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem capabilities của process</span>
</span></span><span class=line><span class=cl>cat /proc/<span class=nv>$$</span>/status <span class=p>|</span> grep Cap
</span></span><span class=line><span class=cl>getpcaps <span class=nv>$$</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Capability sets:</span>
</span></span><span class=line><span class=cl><span class=c1># Permitted (p)  - Caps mà process CÓ THỂ dùng</span>
</span></span><span class=line><span class=cl><span class=c1># Effective (e)  - Caps mà process ĐANG dùng</span>
</span></span><span class=line><span class=cl><span class=c1># Inheritable (i)- Caps được giữ qua exec</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Giải mã capability hex</span>
</span></span><span class=line><span class=cl>capsh --decode<span class=o>=</span>00000000a80425fb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Chạy với capabilities cụ thể</span>
</span></span><span class=line><span class=cl>capsh --caps<span class=o>=</span><span class=s2>&#34;cap_net_bind_service+eip&#34;</span> -- -c <span class=s2>&#34;/usr/bin/myapp&#34;</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=93-user-namespaces><span>9.3 User Namespaces</span>
<a href=#93-user-namespaces class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                   USER NAMESPACES                           │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User namespace = Mapping UID/GID cô lập
</span></span><span class=line><span class=cl>- Bên trong namespace: User có thể là root (UID 0)
</span></span><span class=line><span class=cl>- Bên ngoài namespace: Cùng user không có đặc quyền
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Use cases:
</span></span><span class=line><span class=cl>- Rootless containers (Docker, Podman)
</span></span><span class=line><span class=cl>- Sandboxing
</span></span><span class=line><span class=cl>- Chạy với tư cách &#34;fake root&#34; mà không có quyền thật</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Kiểm tra user namespaces đã bật chưa</span>
</span></span><span class=line><span class=cl>sysctl kernel.unprivileged_userns_clone
</span></span><span class=line><span class=cl>cat /proc/sys/kernel/unprivileged_userns_clone
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bật user namespaces (nếu bị tắt)</span>
</span></span><span class=line><span class=cl>sysctl -w kernel.unprivileged_userns_clone<span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;kernel.unprivileged_userns_clone=1&#39;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tạo user namespace mới với unshare</span>
</span></span><span class=line><span class=cl>unshare --user --map-root-user bash
</span></span><span class=line><span class=cl><span class=c1># Bây giờ trong namespace mới với tư cách root</span>
</span></span><span class=line><span class=cl>id    <span class=c1># uid=0(root) gid=0(root)</span>
</span></span><span class=line><span class=cl><span class=c1># Nhưng thực tế không có đặc quyền từ góc nhìn host</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem thông tin namespace</span>
</span></span><span class=line><span class=cl>ls -la /proc/<span class=nv>$$</span>/ns/user
</span></span><span class=line><span class=cl>readlink /proc/<span class=nv>$$</span>/ns/user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># UID mapping</span>
</span></span><span class=line><span class=cl>cat /proc/<span class=nv>$$</span>/uid_map
</span></span><span class=line><span class=cl><span class=c1># Định dạng: inside-uid  outside-uid  count</span>
</span></span><span class=line><span class=cl><span class=c1># 0          1000         1</span>
</span></span><span class=line><span class=cl><span class=c1># → UID 0 bên trong = UID 1000 bên ngoài</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Phạm vi subuid/subgid (cho rootless containers)</span>
</span></span><span class=line><span class=cl>cat /etc/subuid
</span></span><span class=line><span class=cl><span class=c1># alice:100000:65536</span>
</span></span><span class=line><span class=cl><span class=c1># → alice có thể dùng UIDs 100000-165535 cho mapping</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat /etc/subgid
</span></span><span class=line><span class=cl><span class=c1># alice:100000:65536</span>
</span></span><span class=line><span class=cl><span class=c1># → alice có thể dùng GIDs 100000-165535 cho mapping</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Cấu hình subuid/subgid</span>
</span></span><span class=line><span class=cl>usermod --add-subuids 100000-165535 alice
</span></span><span class=line><span class=cl>usermod --add-subgids 100000-165535 alice</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=94-tổng-quan-tích-hợp-ldapad><span>9.4 Tổng Quan Tích Hợp LDAP/AD</span>
<a href=#94-t%e1%bb%95ng-quan-t%c3%adch-h%e1%bb%a3p-ldapad class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│              XÁC THỰC TẬP TRUNG                             │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Thay vì /etc/passwd cục bộ:
</span></span><span class=line><span class=cl>- LDAP (Lightweight Directory Access Protocol)
</span></span><span class=line><span class=cl>- Active Directory (Microsoft)
</span></span><span class=line><span class=cl>- FreeIPA (Red Hat identity management)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                                                          │
</span></span><span class=line><span class=cl>│  Linux Client                   Directory Server         │
</span></span><span class=line><span class=cl>│  ┌──────────────┐              ┌────────────────┐        │
</span></span><span class=line><span class=cl>│  │ Ứng dụng     │              │                │        │
</span></span><span class=line><span class=cl>│  │   (sshd)     │              │  LDAP/AD       │        │
</span></span><span class=line><span class=cl>│  └──────┬───────┘              │  Server        │        │
</span></span><span class=line><span class=cl>│         │                      │                │        │
</span></span><span class=line><span class=cl>│  ┌──────▼───────┐              │  Users:        │        │
</span></span><span class=line><span class=cl>│  │    PAM       │              │  - alice       │        │
</span></span><span class=line><span class=cl>│  │  pam_sss     │ ◄──────────► │  - bob         │        │
</span></span><span class=line><span class=cl>│  └──────┬───────┘    LDAP/     │  - charlie     │        │
</span></span><span class=line><span class=cl>│         │           Kerberos   │                │        │
</span></span><span class=line><span class=cl>│  ┌──────▼───────┐              │  Groups:       │        │
</span></span><span class=line><span class=cl>│  │    SSSD      │              │  - developers  │        │
</span></span><span class=line><span class=cl>│  │  (daemon)    │              │  - admins      │        │
</span></span><span class=line><span class=cl>│  └──────────────┘              └────────────────┘        │
</span></span><span class=line><span class=cl>│                                                          │
</span></span><span class=line><span class=cl>└──────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Công cụ phổ biến:
</span></span><span class=line><span class=cl># - SSSD (System Security Services Daemon)
</span></span><span class=line><span class=cl># - realmd (dễ dàng join AD)
</span></span><span class=line><span class=cl># - authconfig/authselect</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Join Active Directory (RHEL/CentOS)</span>
</span></span><span class=line><span class=cl>realm discover example.com
</span></span><span class=line><span class=cl>realm join example.com
</span></span><span class=line><span class=cl>realm list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Cấu hình SSSD</span>
</span></span><span class=line><span class=cl>cat /etc/sssd/sssd.conf
</span></span><span class=line><span class=cl><span class=c1># [sssd]</span>
</span></span><span class=line><span class=cl><span class=c1># domains = example.com</span>
</span></span><span class=line><span class=cl><span class=c1># services = nss, pam</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># [domain/example.com]</span>
</span></span><span class=line><span class=cl><span class=c1># id_provider = ad</span>
</span></span><span class=line><span class=cl><span class=c1># auth_provider = ad</span>
</span></span><span class=line><span class=cl><span class=c1># access_provider = ad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># NSS switch với SSSD</span>
</span></span><span class=line><span class=cl>cat /etc/nsswitch.conf
</span></span><span class=line><span class=cl><span class=c1># passwd: files sss</span>
</span></span><span class=line><span class=cl><span class=c1># group:  files sss</span>
</span></span><span class=line><span class=cl><span class=c1># shadow: files sss</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Test user LDAP</span>
</span></span><span class=line><span class=cl>getent passwd alice@example.com
</span></span><span class=line><span class=cl>id alice@example.com</span></span></code></pre></td></tr></table></div></div><hr><h2 class=heading-element id=tóm-tắt-nhanh><span>TÓM TẮT NHANH</span>
<a href=#t%c3%b3m-t%e1%ba%aft-nhanh class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=quản-lý-user><span>Quản Lý User</span>
<a href=#qu%e1%ba%a3n-l%c3%bd-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Tạo user</span>
</span></span><span class=line><span class=cl>useradd -m -s /bin/bash -c <span class=s2>&#34;Tên Đầy Đủ&#34;</span> username
</span></span><span class=line><span class=cl>useradd -m -G sudo,docker username
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sửa user</span>
</span></span><span class=line><span class=cl>usermod -aG groupname username    <span class=c1># Thêm vào group (QUAN TRỌNG: -aG không phải -G)</span>
</span></span><span class=line><span class=cl>usermod -s /bin/zsh username      <span class=c1># Đổi shell</span>
</span></span><span class=line><span class=cl>usermod -L username               <span class=c1># Khóa account</span>
</span></span><span class=line><span class=cl>usermod -U username               <span class=c1># Mở khóa account</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xóa user</span>
</span></span><span class=line><span class=cl>userdel -r username               <span class=c1># Xóa cùng thư mục home</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thông tin user</span>
</span></span><span class=line><span class=cl>id username
</span></span><span class=line><span class=cl>groups username
</span></span><span class=line><span class=cl>getent passwd username</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=quản-lý-group><span>Quản Lý Group</span>
<a href=#qu%e1%ba%a3n-l%c3%bd-group class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Tạo group</span>
</span></span><span class=line><span class=cl>groupadd groupname
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sửa group</span>
</span></span><span class=line><span class=cl>groupmod -n tenmoi tencu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xóa group</span>
</span></span><span class=line><span class=cl>groupdel groupname
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thêm user vào group</span>
</span></span><span class=line><span class=cl>usermod -aG groupname username
</span></span><span class=line><span class=cl>gpasswd -a username groupname
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thông tin group</span>
</span></span><span class=line><span class=cl>getent group groupname</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=quản-lý-password><span>Quản Lý Password</span>
<a href=#qu%e1%ba%a3n-l%c3%bd-password class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Đổi password</span>
</span></span><span class=line><span class=cl>passwd username
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Thời hạn password</span>
</span></span><span class=line><span class=cl>chage -l username                 <span class=c1># Xem thông tin thời hạn</span>
</span></span><span class=line><span class=cl>chage -M <span class=m>90</span> username              <span class=c1># Tối đa 90 ngày</span>
</span></span><span class=line><span class=cl>chage -d <span class=m>0</span> username               <span class=c1># Buộc đổi khi đăng nhập lần sau</span>
</span></span><span class=line><span class=cl>chage -E 2025-12-31 username      <span class=c1># Ngày hết hạn account</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Khóa/mở khóa</span>
</span></span><span class=line><span class=cl>passwd -l username                <span class=c1># Khóa</span>
</span></span><span class=line><span class=cl>passwd -u username                <span class=c1># Mở khóa</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=susudo><span>su/sudo</span>
<a href=#susudo class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Chuyển user</span>
</span></span><span class=line><span class=cl>su - username                     <span class=c1># Full login shell</span>
</span></span><span class=line><span class=cl>su -c <span class=s2>&#34;command&#34;</span> username          <span class=c1># Chạy lệnh đơn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sudo</span>
</span></span><span class=line><span class=cl>sudo <span class=nb>command</span>                      <span class=c1># Chạy với tư cách root</span>
</span></span><span class=line><span class=cl>sudo -u username <span class=nb>command</span>          <span class=c1># Chạy với tư cách user</span>
</span></span><span class=line><span class=cl>sudo -i                           <span class=c1># Root login shell</span>
</span></span><span class=line><span class=cl>sudo -l                           <span class=c1># Liệt kê lệnh được phép</span>
</span></span><span class=line><span class=cl>visudo                            <span class=c1># Sửa sudoers an toàn</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=cheatsheet-quyền-file><span>Cheatsheet Quyền File</span>
<a href=#cheatsheet-quy%e1%bb%81n-file class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Truyền thống</span>
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> file                    <span class=c1># rwxr-xr-x</span>
</span></span><span class=line><span class=cl>chown user:group file
</span></span><span class=line><span class=cl>chgrp group file
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ACL</span>
</span></span><span class=line><span class=cl>getfacl file
</span></span><span class=line><span class=cl>setfacl -m u:user:rwx file        <span class=c1># Thêm ACL user</span>
</span></span><span class=line><span class=cl>setfacl -m g:group:rx file        <span class=c1># Thêm ACL group</span>
</span></span><span class=line><span class=cl>setfacl -x u:user file            <span class=c1># Xóa ACL user</span>
</span></span><span class=line><span class=cl>setfacl -b file                   <span class=c1># Xóa tất cả ACLs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Capabilities</span>
</span></span><span class=line><span class=cl>getcap /path/to/binary
</span></span><span class=line><span class=cl>setcap cap_net_bind_service+ep /path/to/binary</span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=files-quan-trọng><span>Files Quan Trọng</span>
<a href=#files-quan-tr%e1%bb%8dng class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/etc/passwd                       <span class=c1># Cơ sở dữ liệu user (public)</span>
</span></span><span class=line><span class=cl>/etc/shadow                       <span class=c1># Hash password (chỉ root)</span>
</span></span><span class=line><span class=cl>/etc/group                        <span class=c1># Cơ sở dữ liệu group</span>
</span></span><span class=line><span class=cl>/etc/gshadow                      <span class=c1># Password group</span>
</span></span><span class=line><span class=cl>/etc/login.defs                   <span class=c1># Mặc định hệ thống</span>
</span></span><span class=line><span class=cl>/etc/default/useradd              <span class=c1># Mặc định useradd</span>
</span></span><span class=line><span class=cl>/etc/skel/                        <span class=c1># Template user mới</span>
</span></span><span class=line><span class=cl>/etc/sudoers                      <span class=c1># Cấu hình sudo</span>
</span></span><span class=line><span class=cl>/etc/pam.d/                       <span class=c1># Cấu hình PAM</span></span></span></code></pre></td></tr></table></div></div></div><hr class=awesome-hr><h2 id=see-also>Nội dung liên quan</h2><ul><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/storage/ title="Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu">Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu</a></li><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/regex-awk-sed/ title="Awk, Sed & Regex - Hướng Dẫn Chuyên Sâu Cho System Engineer">Awk, Sed & Regex - Hướng Dẫn Chuyên Sâu Cho System Engineer</a></li><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/process-service-log/ title="Process Management, Systemd & Logging - Hướng Dẫn Chuyên Sâu">Process Management, Systemd & Logging - Hướng Dẫn Chuyên Sâu</a></li><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/network/ title="Linux Network Commands - Hướng Dẫn Chuyên Sâu">Linux Network Commands - Hướng Dẫn Chuyên Sâu</a></li><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/grep-diff-sort/ title="Grep, Sort, Diff - Hướng Dẫn Chuyên Sâu">Grep, Sort, Diff - Hướng Dẫn Chuyên Sâu</a></li></ul><div class=collection-card><div class="collection-title text-secondary">Trong <a href=/collections/linux-cli/><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> <span>Bộ sưu tập・Linux Cli</span></span></a> 11</div><div class=collection-nav><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/storage/ class=collection-nav-item rel=prev title="Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i><span>Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu</span>
</a><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/encryption-and-security/ class=collection-nav-item rel=next title="Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu"><span>Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu</span><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Cập nhật ngày 2025-12-11 16:05:24">Cập nhật ngày 2025-12-11&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Chia sẻ trên X" data-sharer=twitter data-url=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/ data-title="Linux User & Group Management - Hướng Dẫn Chuyên Sâu" data-hashtags="ai generated post"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Chia sẻ trên Facebook" data-sharer=facebook data-url=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/ data-hashtag="ai generated post"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Chia sẻ trên 微博" data-sharer=weibo data-url=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/ data-title="Linux User & Group Management - Hướng Dẫn Chuyên Sâu"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ai-generated-post/ class=post-tag title="Nhãn - Ai Generated Post">Ai Generated Post</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Quay lại</a></span>&nbsp;|&nbsp;<span><a href=/>Trang chủ</a></span></section></div><div class=post-nav><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/storage/ class=post-nav-item rel=prev title="Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu</a><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/package-manager/ class=post-nav-item rel=next title="Linux Package Management - Hướng Dẫn Chuyên Sâu">Linux Package Management - Hướng Dẫn Chuyên Sâu<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article><aside class=toc id=toc-auto aria-label="Nội dung"><h2 class=toc-title>Nội dung&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><dialog id=toc-dialog aria-labelledby=toc-dialog-title role=dialog><div class=toc><h2 class=toc-title>Nội dung</h2><div class=toc-content id=toc-content-drawer><nav><ul><li><ul><li><a href=#phần-1-nền-tảng-usergroup>PHẦN 1: NỀN TẢNG USER/GROUP</a><ul><li><a href=#11-mô-hình-định-danh-linux>1.1 Mô Hình Định Danh Linux</a></li><li><a href=#12-uid-và-gid>1.2 UID và GID</a></li><li><a href=#13-primary-vs-supplementary-groups>1.3 Primary vs Supplementary Groups</a></li></ul></li><li><a href=#phần-2-cấu-trúc-file-hệ-thống>PHẦN 2: CẤU TRÚC FILE HỆ THỐNG</a><ul><li><a href=#21-etcpasswd---cơ-sở-dữ-liệu-user>2.1 /etc/passwd - Cơ Sở Dữ Liệu User</a></li><li><a href=#22-etcshadow---cơ-sở-dữ-liệu-password>2.2 /etc/shadow - Cơ Sở Dữ Liệu Password</a></li><li><a href=#23-băm-password>2.3 Băm Password</a></li><li><a href=#24-etcgroup---cơ-sở-dữ-liệu-group>2.4 /etc/group - Cơ Sở Dữ Liệu Group</a></li><li><a href=#25-etcgshadow---shadow-group>2.5 /etc/gshadow - Shadow Group</a></li><li><a href=#26-nsswitchconf---name-service-switch>2.6 nsswitch.conf - Name Service Switch</a></li></ul></li><li><a href=#phần-3-quản-lý-user>PHẦN 3: QUẢN LÝ USER</a><ul><li><a href=#31-useradd---tạo-user>3.1 useradd - Tạo User</a></li><li><a href=#32-quy-trình-useradd>3.2 Quy Trình useradd</a></li><li><a href=#33-usermod---sửa-đổi-user>3.3 usermod - Sửa Đổi User</a></li><li><a href=#34-userdel---xóa-user>3.4 userdel - Xóa User</a></li><li><a href=#35-các-lệnh-thông-tin-user>3.5 Các Lệnh Thông Tin User</a></li></ul></li><li><a href=#phần-4-quản-lý-group>PHẦN 4: QUẢN LÝ GROUP</a><ul><li><a href=#41-groupadd---tạo-group>4.1 groupadd - Tạo Group</a></li><li><a href=#42-groupmod---sửa-đổi-group>4.2 groupmod - Sửa Đổi Group</a></li><li><a href=#43-groupdel---xóa-group>4.3 groupdel - Xóa Group</a></li><li><a href=#44-các-lệnh-thành-viên-group>4.4 Các Lệnh Thành Viên Group</a></li></ul></li><li><a href=#phần-5-quản-lý-password>PHẦN 5: QUẢN LÝ PASSWORD</a><ul><li><a href=#51-passwd---đổi-password>5.1 passwd - Đổi Password</a></li><li><a href=#52-chage---thời-hạn-password>5.2 chage - Thời Hạn Password</a></li><li><a href=#53-chính-sách-password>5.3 Chính Sách Password</a></li></ul></li><li><a href=#phần-6-su--sudo>PHẦN 6: SU & SUDO</a><ul><li><a href=#61-su---chuyển-user>6.1 su - Chuyển User</a></li><li><a href=#62-sudo---superuser-do>6.2 sudo - Superuser Do</a></li><li><a href=#63-etcsudoers--visudo>6.3 /etc/sudoers & visudo</a></li><li><a href=#64-best-practices>6.4 Best Practices</a></li><li><a href=#65-so-sánh-su-vs-sudo>6.5 So Sánh su vs sudo</a></li></ul></li><li><a href=#phần-7-pam---pluggable-authentication-modules>PHẦN 7: PAM - PLUGGABLE AUTHENTICATION MODULES</a><ul><li><a href=#71-kiến-trúc-pam>7.1 Kiến Trúc PAM</a></li><li><a href=#72-cấu-hình-pam>7.2 Cấu Hình PAM</a></li><li><a href=#73-định-dạng-config-pam>7.3 Định Dạng Config PAM</a></li><li><a href=#74-ví-dụ-pam-hữu-ích>7.4 Ví Dụ PAM Hữu Ích</a></li></ul></li><li><a href=#phần-8-mặc-định-hệ-thống>PHẦN 8: MẶC ĐỊNH HỆ THỐNG</a><ul><li><a href=#81-etclogindefs>8.1 /etc/login.defs</a></li><li><a href=#82-etcskel---thư-mục-skeleton>8.2 /etc/skel - Thư Mục Skeleton</a></li><li><a href=#83-etcdefaultuseradd>8.3 /etc/default/useradd</a></li></ul></li><li><a href=#phần-9-chủ-đề-nâng-cao>PHẦN 9: CHỦ ĐỀ NÂNG CAO</a><ul><li><a href=#91-access-control-lists-acl>9.1 Access Control Lists (ACL)</a></li><li><a href=#92-linux-capabilities>9.2 Linux Capabilities</a></li><li><a href=#93-user-namespaces>9.3 User Namespaces</a></li><li><a href=#94-tổng-quan-tích-hợp-ldapad>9.4 Tổng Quan Tích Hợp LDAP/AD</a></li></ul></li><li><a href=#tóm-tắt-nhanh>TÓM TẮT NHANH</a><ul><li><a href=#quản-lý-user>Quản Lý User</a></li><li><a href=#quản-lý-group>Quản Lý Group</a></li><li><a href=#quản-lý-password>Quản Lý Password</a></li><li><a href=#susudo>su/sudo</a></li><li><a href=#cheatsheet-quyền-file>Cheatsheet Quyền File</a></li><li><a href=#files-quan-trọng>Files Quan Trọng</a></li></ul></li></ul></li></ul></nav></div></div></dialog></main><footer class=footer><div class=footer-container><div class="footer-line powered">Cung cấp bởi <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.152.0"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> | Chủ đề - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.4.0-alpha.2"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2025</span></div></div></footer></div><div class=widgets><div class=fixed-buttons><div class="fixed-button back-to-top animate__faster" role=button aria-label="Lên trên"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><svg viewBox="0 0 100 100"><circle class="bg" cx="50" cy="50" r="50"/><circle class="progress" cx="50" cy="50" r="50"/></svg></div><div id=toc-drawer-button class="fixed-button toc-drawer-button" role=button aria-label="Nội dung"><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></div></div><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#000;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>Trang web này hoạt động tốt nhất khi JavaScript được kích hoạt.</div></noscript></div><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script src=/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/config/page.js defer></script><script src=/js/theme.min.js defer></script></body></html>