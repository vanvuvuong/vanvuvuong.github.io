<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=vi><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Systemd - Hướng Dẫn Toàn Diện Cho System Engineers - Kaizen - tốt hơn mỗi ngày</title><meta name=author content="Kaizen Teams"><meta name=description content="Quản lý hệ thống Linux với systemd"><meta name=keywords content='ai generated post'><meta itemprop=name content="Systemd - Hướng dẫn toàn diện cho System Engineers"><meta itemprop=description content="Quản lý hệ thống Linux với systemd"><meta itemprop=datePublished content="2025-12-13T14:16:57+07:00"><meta itemprop=dateModified content="2025-12-19T20:48:32+07:00"><meta itemprop=wordCount content="5919"><meta itemprop=keywords content="Ai Generated Post"><meta property="og:url" content="https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/systemd/"><meta property="og:site_name" content="Kaizen - tốt hơn mỗi ngày"><meta property="og:title" content="Systemd - Hướng dẫn toàn diện cho System Engineers"><meta property="og:description" content="Quản lý hệ thống Linux với systemd"><meta property="og:locale" content="vi"><meta property="og:type" content="article"><meta property="article:section" content="bai-viet"><meta property="article:published_time" content="2025-12-13T14:16:57+07:00"><meta property="article:modified_time" content="2025-12-19T20:48:32+07:00"><meta property="article:tag" content="Ai Generated Post"><meta name=twitter:card content="summary"><meta name=twitter:title content="Systemd - Hướng dẫn toàn diện cho System Engineers"><meta name=twitter:description content="Quản lý hệ thống Linux với systemd"><meta name=application-name content="Kaizen - tốt hơn mỗi ngày"><meta name=apple-mobile-web-app-title content="Kaizen - tốt hơn mỗi ngày"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#2d89ef"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#FF7359><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/systemd/ title="Systemd - Hướng dẫn toàn diện cho System Engineers - Kaizen - tốt hơn mỗi ngày"><link rel=prev type=text/html href=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/file-and-folder/ title="Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu"><link rel=stylesheet href=/css/config.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Systemd - Hướng dẫn toàn diện cho System Engineers","inLanguage":"vi","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/vanvuvuong.github.io\/bai-viet\/khoa-hoc-may-tinh\/linux-cli\/systemd\/"},"image":[{"@type":"ImageObject","url":"https:\/\/vanvuvuong.github.io\/images\/avatar.jpeg","width":330,"height":330}],"genre":"posts","keywords":"ai generated post","wordcount":5919,"url":"https:\/\/vanvuvuong.github.io\/bai-viet\/khoa-hoc-may-tinh\/linux-cli\/systemd\/","datePublished":"2025-12-13T14:16:57+07:00","dateModified":"2025-12-19T20:48:32+07:00","publisher":{"@type":"Organization","name":"Kaizen","logo":{"@type":"ImageObject","url":"https:\/\/vanvuvuong.github.io\/images\/avatar.jpeg","width":330,"height":330}},"author":{"@type":"Person","name":"Kaizen Teams"},"description":"Quản lý hệ thống Linux với systemd"}</script><script src=/js/head/color-scheme.min.js></script></head><body data-instant-intensity=viewport data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Kaizen - tốt hơn mỗi ngày"><img class=logo src=/images/kaizen-logo.png alt="Kaizen - tốt hơn mỗi ngày" height=32 width=32><span class=header-title-text>Kaizen</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/gioi-thieu><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> Giới thiệu</a></li><li class="menu-item has-children"><a class=menu-link href=/bai-viet><i class="fa-solid fa-newspaper fa-fw fa-sm" aria-hidden=true></i> Bài viết</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/bai-viet/khoa-hoc-may-tinh><i class="fa-solid fa-laptop fa-fw fa-sm" aria-hidden=true></i> Khoa học máy tính</a></li><li class=menu-item><a class=menu-link href=/bai-viet/cuoc-song><i class="fa-solid fa-life-ring fa-fw fa-sm" aria-hidden=true></i> Cuộc sống</a></li><li class=menu-item><a class=menu-link href=/bai-viet/hoc-vien-luat-tu-nhien><i class="fa-solid fa-dragon fa-fw fa-sm" aria-hidden=true></i> Học viện luật tự nhiên</a></li><li class=menu-item><a class=menu-link href=/collections><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> Bộ sưu tập</a></li><li class=menu-item><a class=menu-link href=/tags><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li></ul></li><li class=menu-item><a class=menu-link href=/sach-hay><i class="fa-solid fa-book fa-fw fa-sm" aria-hidden=true></i> Sách hay</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Tìm tiêu đề hoặc nội dung..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title="Tìm kiếm"><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Xoá><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Kaizen - tốt hơn mỗi ngày"><img class=logo src=/images/kaizen-logo.png alt="Kaizen - tốt hơn mỗi ngày" height=26 width=26><span class=header-title-text>Kaizen</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Tìm tiêu đề hoặc nội dung..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title="Tìm kiếm"><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Xoá><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Huỷ</a></li><li class=menu-item><a class=menu-link href=/gioi-thieu><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> Giới thiệu</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/bai-viet><i class="fa-solid fa-newspaper fa-fw fa-sm" aria-hidden=true></i> Bài viết</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/bai-viet/khoa-hoc-may-tinh><i class="fa-solid fa-laptop fa-fw fa-sm" aria-hidden=true></i> Khoa học máy tính</a></li><li class=menu-item><a class=menu-link href=/bai-viet/cuoc-song><i class="fa-solid fa-life-ring fa-fw fa-sm" aria-hidden=true></i> Cuộc sống</a></li><li class=menu-item><a class=menu-link href=/bai-viet/hoc-vien-luat-tu-nhien><i class="fa-solid fa-dragon fa-fw fa-sm" aria-hidden=true></i> Học viện luật tự nhiên</a></li><li class=menu-item><a class=menu-link href=/collections><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> Bộ sưu tập</a></li><li class=menu-item><a class=menu-link href=/tags><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li></ul></li><li class=menu-item><a class=menu-link href=/sach-hay><i class="fa-solid fa-book fa-fw fa-sm" aria-hidden=true></i> Sách hay</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=fi-container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Bộ sưu tập"><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title="Bộ sưu tập">Linux Cli</span>
<span class=collection-count>12</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/shell-co-ban/ title="Những Điều Cơ Bản Về Bash & Fish Shell Trong Linux">Những Điều Cơ Bản Về Bash & Fish Shell Trong Linux</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/grep-diff-sort/ title="Grep, Sort, Diff - Hướng Dẫn Chuyên Sâu">Grep, Sort, Diff - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/network/ title="Linux Network Commands - Hướng Dẫn Chuyên Sâu">Linux Network Commands - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/process-service-log/ title="Process Management, Systemd & Logging - Hướng Dẫn Chuyên Sâu">Process Management, Systemd & Logging - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/regex-awk-sed/ title="Awk, Sed & Regex - Hướng Dẫn Chuyên Sâu Cho System Engineer">Awk, Sed & Regex - Hướng Dẫn Chuyên Sâu Cho System Engineer</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/storage/ title="Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu">Disk, Storage & Filesystem - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/ title="Linux User & Group Management - Hướng Dẫn Chuyên Sâu">Linux User & Group Management - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/encryption-and-security/ title="Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu">Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/package-manager/ title="Linux Package Management - Hướng Dẫn Chuyên Sâu">Linux Package Management - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/selinux/ title="Selinux & Apparmor - Kiểm Soát Truy Cập Bắt Buộc">Selinux & Apparmor - Kiểm Soát Truy Cập Bắt Buộc</a></li><li class=collection-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/file-and-folder/ title="Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu">Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu</a></li><li class=collection-item><span class=active title="Systemd - Hướng Dẫn Toàn Diện Cho System Engineers">Systemd - Hướng Dẫn Toàn Diện Cho System Engineers</span></li></ul><div class=collection-nav-simple><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/file-and-folder/ class=collection-nav-item rel=prev title="Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>12/12</span><i class="fa-solid fa-angle-right fa-fw collection-nav-item text-secondary" aria-hidden=true></i></div></nav></div></div><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>Nội dung liên quan</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/file-and-folder/ title="Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu">Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu</a></li><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/selinux/ title="Selinux & Apparmor - Kiểm Soát Truy Cập Bắt Buộc">Selinux & Apparmor - Kiểm Soát Truy Cập Bắt Buộc</a></li><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/encryption-and-security/ title="Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu">Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu</a></li><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/package-manager/ title="Linux Package Management - Hướng Dẫn Chuyên Sâu">Linux Package Management - Hướng Dẫn Chuyên Sâu</a></li><li class=related-item><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/ title="Linux User & Group Management - Hướng Dẫn Chuyên Sâu">Linux User & Group Management - Hướng Dẫn Chuyên Sâu</a></li></ul></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Systemd - Hướng Dẫn Toàn Diện Cho System Engineers</span></h1><p class="single-subtitle animate__animated animate__fadeIn">Units, Services, Timers, Targets, Journald & Best Practices</p></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://vanvuvuong.github.io title="Tác giả" target=_blank rel="external nofollow noopener noreferrer author" class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Kaizen Teams</a></span><span class=post-included-in>&nbsp;trong <a href=/collections/linux-cli/ class=post-collection title="Bộ sưu tập - Linux Cli"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Linux Cli</a></span></div><div class=post-meta-line><span title="đăng ngày 2025-12-13 14:16:57"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025-12-13>2025-12-13</time></span>&nbsp;<span title="Cập nhật ngày 2025-12-19 20:48:32"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025-12-19>2025-12-19</time></span>&nbsp;<span title="5919 từ"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>Khoảng 6000 từ</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>28 phút</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Nội dung</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#1-kiến-trúc-systemd>1. KIẾN TRÚC SYSTEMD</a><ul><li><a href=#11-tổng-quan>1.1 Tổng quan</a></li><li><a href=#12-thành-phần-chính>1.2 Thành phần chính</a></li><li><a href=#13-unit-types>1.3 Unit Types</a></li><li><a href=#14-unit-file-locations>1.4 Unit File Locations</a></li></ul></li><li><a href=#2-unit-files---cấu-trúc-cơ-bản>2. UNIT FILES - CẤU TRÚC CƠ BẢN</a><ul><li><a href=#21-cấu-trúc-unit-file>2.1 Cấu trúc Unit File</a></li><li><a href=#22-dependency-directives>2.2 Dependency Directives</a></li><li><a href=#23-điều-kiện-và-assertions>2.3 Điều kiện và Assertions</a></li><li><a href=#24-specifiers-variables>2.4 Specifiers (Variables)</a></li></ul></li><li><a href=#3-service-units>3. SERVICE UNITS</a><ul><li><a href=#31-service-types>3.1 Service Types</a></li><li><a href=#32-service-directives>3.2 Service Directives</a></li><li><a href=#33-restart-behavior-matrix>3.3 Restart Behavior Matrix</a></li><li><a href=#34-execstart-prefixes>3.4 ExecStart Prefixes</a></li><li><a href=#35-ví-dụ-service-units>3.5 Ví dụ Service Units</a></li><li><a href=#36-template-units>3.6 Template Units</a></li></ul></li><li><a href=#4-timer-units---thay-thế-cron>4. TIMER UNITS - THAY THẾ CRON</a><ul><li><a href=#41-timer-vs-cron>4.1 Timer vs Cron</a></li><li><a href=#42-timer-directives>4.2 Timer Directives</a></li><li><a href=#43-oncalendar-format>4.3 OnCalendar Format</a></li><li><a href=#44-timer-examples>4.4 Timer Examples</a></li><li><a href=#45-cron-to-timer-cheatsheet>4.5 Cron to Timer Cheatsheet</a></li></ul></li><li><a href=#5-target-units>5. TARGET UNITS</a><ul><li><a href=#51-targets-vs-runlevels>5.1 Targets vs Runlevels</a></li><li><a href=#52-target-hierarchy>5.2 Target Hierarchy</a></li><li><a href=#53-thao-tác-với-targets>5.3 Thao tác với Targets</a></li><li><a href=#54-custom-target>5.4 Custom Target</a></li></ul></li><li><a href=#6-socket-units>6. SOCKET UNITS</a><ul><li><a href=#61-socket-activation>6.1 Socket Activation</a></li><li><a href=#62-socket-directives>6.2 Socket Directives</a></li><li><a href=#63-socket-examples>6.3 Socket Examples</a></li></ul></li><li><a href=#7-path-units>7. PATH UNITS</a><ul><li><a href=#71-path-unit-overview>7.1 Path Unit Overview</a></li><li><a href=#72-path-example>7.2 Path Example</a></li></ul></li><li><a href=#8-mount--automount-units>8. MOUNT & AUTOMOUNT UNITS</a><ul><li><a href=#81-mount-units>8.1 Mount Units</a></li><li><a href=#82-automount-units>8.2 Automount Units</a></li><li><a href=#83-mount-unit-từ-fstab>8.3 Mount Unit từ fstab</a></li></ul></li><li><a href=#9-systemctl---quản-lý-services>9. SYSTEMCTL - QUẢN LÝ SERVICES</a><ul><li><a href=#91-basic-commands>9.1 Basic Commands</a></li><li><a href=#92-listing-units>9.2 Listing Units</a></li><li><a href=#93-unit-file-management>9.3 Unit File Management</a></li><li><a href=#94-system-control>9.4 System Control</a></li><li><a href=#95-user-services>9.5 User Services</a></li></ul></li><li><a href=#10-journald---logging>10. JOURNALD - LOGGING</a><ul><li><a href=#101-journalctl-basics>10.1 journalctl Basics</a></li><li><a href=#102-advanced-queries>10.2 Advanced Queries</a></li><li><a href=#103-journald-configuration>10.3 journald Configuration</a></li><li><a href=#104-structured-logging>10.4 Structured Logging</a></li></ul></li><li><a href=#11-systemd-analyze---performance>11. SYSTEMD-ANALYZE - PERFORMANCE</a><ul><li><a href=#111-boot-analysis>11.1 Boot Analysis</a></li><li><a href=#112-unit-analysis>11.2 Unit Analysis</a></li><li><a href=#113-system-analysis>11.3 System Analysis</a></li></ul></li><li><a href=#12-resource-control---cgroups>12. RESOURCE CONTROL - CGROUPS</a><ul><li><a href=#121-resource-control-directives>12.1 Resource Control Directives</a></li><li><a href=#122-slices>12.2 Slices</a></li><li><a href=#123-custom-slice>12.3 Custom Slice</a></li><li><a href=#124-systemd-cgtop>12.4 systemd-cgtop</a></li><li><a href=#125-runtime-resource-control>12.5 Runtime Resource Control</a></li></ul></li><li><a href=#13-security-hardening>13. SECURITY HARDENING</a><ul><li><a href=#131-security-directives>13.1 Security Directives</a></li><li><a href=#132-security-profiles>13.2 Security Profiles</a></li><li><a href=#133-check-security-score>13.3 Check Security Score</a></li></ul></li><li><a href=#14-debugging--troubleshooting>14. DEBUGGING & TROUBLESHOOTING</a><ul><li><a href=#141-debug-commands>14.1 Debug Commands</a></li><li><a href=#142-common-issues>14.2 Common Issues</a></li><li><a href=#143-debug-checklist>14.3 Debug Checklist</a></li></ul></li><li><a href=#15-production-templates>15. PRODUCTION TEMPLATES</a><ul><li><a href=#151-web-application>15.1 Web Application</a></li><li><a href=#152-background-worker>15.2 Background Worker</a></li><li><a href=#153-scheduled-task-timer>15.3 Scheduled Task (Timer)</a></li><li><a href=#154-socket-activated-service>15.4 Socket-Activated Service</a></li><li><a href=#155-hardened-container-runtime>15.5 Hardened Container Runtime</a></li></ul></li><li><a href=#tóm-tắt-nhanh>TÓM TẮT NHANH</a><ul><li><a href=#essential-commands>Essential Commands</a></li><li><a href=#unit-file-essentials>Unit File Essentials</a></li><li><a href=#timer-essentials>Timer Essentials</a></li></ul></li><li><a href=#references>REFERENCES</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 class=heading-element id=1-kiến-trúc-systemd><span>1. KIẾN TRÚC SYSTEMD</span>
<a href=#1-ki%e1%ba%bfn-tr%c3%bac-systemd class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=11-tổng-quan><span>1.1 Tổng quan</span>
<a href=#11-t%e1%bb%95ng-quan class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                         SYSTEMD ARCHITECTURE                               │
</span></span><span class=line><span class=cl>├────────────────────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│                                                                            │
</span></span><span class=line><span class=cl>│  ┌─────────────────────────────────────────────────────────────────────┐   │
</span></span><span class=line><span class=cl>│  │                         USER SPACE                                  │   │
</span></span><span class=line><span class=cl>│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
</span></span><span class=line><span class=cl>│  │  │ systemctl   │  │ journalctl  │  │ loginctl    │  │ timedatectl│  │   │
</span></span><span class=line><span class=cl>│  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └─────┬──────┘  │   │
</span></span><span class=line><span class=cl>│  │         │                │                │               │         │   │
</span></span><span class=line><span class=cl>│  │         └────────────────┼────────────────┼───────────────┘         │   │
</span></span><span class=line><span class=cl>│  │                          │                │                         │   │
</span></span><span class=line><span class=cl>│  │                          ▼                ▼                         │   │
</span></span><span class=line><span class=cl>│  │  ┌──────────────────────────────────────────────────────────────┐   │   │
</span></span><span class=line><span class=cl>│  │  │                      D-Bus (IPC)                             │   │   │
</span></span><span class=line><span class=cl>│  │  └──────────────────────────────────────────────────────────────┘   │   │
</span></span><span class=line><span class=cl>│  │                          │                                          │   │
</span></span><span class=line><span class=cl>│  │                          ▼                                          │   │
</span></span><span class=line><span class=cl>│  │  ┌──────────────────────────────────────────────────────────────┐   │   │
</span></span><span class=line><span class=cl>│  │  │                     systemd (PID 1)                          │   │   │
</span></span><span class=line><span class=cl>│  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐ │   │   │
</span></span><span class=line><span class=cl>│  │  │  │ Units    │ │ Targets  │ │ Timers   │ │ Resource Control │ │   │   │
</span></span><span class=line><span class=cl>│  │  │  │ Manager  │ │ Manager  │ │ Manager  │ │ (cgroups)        │ │   │   │
</span></span><span class=line><span class=cl>│  │  │  └──────────┘ └──────────┘ └──────────┘ └──────────────────┘ │   │   │
</span></span><span class=line><span class=cl>│  │  └──────────────────────────────────────────────────────────────┘   │   │
</span></span><span class=line><span class=cl>│  │                          │                                          │   │
</span></span><span class=line><span class=cl>│  │         ┌────────────────┼────────────────┐                         │   │
</span></span><span class=line><span class=cl>│  │         ▼                ▼                ▼                         │   │
</span></span><span class=line><span class=cl>│  │  ┌────────────┐  ┌─────────────┐  ┌─────────────────┐               │   │
</span></span><span class=line><span class=cl>│  │  │ journald   │  │ logind      │  │ systemd-networkd│               │   │
</span></span><span class=line><span class=cl>│  │  │ (logging)  │  │ (sessions)  │  │ systemd-resolved│               │   │
</span></span><span class=line><span class=cl>│  │  └────────────┘  └─────────────┘  └─────────────────┘               │   │
</span></span><span class=line><span class=cl>│  └─────────────────────────────────────────────────────────────────────┘   │
</span></span><span class=line><span class=cl>│                                                                            │
</span></span><span class=line><span class=cl>│  ┌─────────────────────────────────────────────────────────────────────┐   │
</span></span><span class=line><span class=cl>│  │                         KERNEL SPACE                                │   │
</span></span><span class=line><span class=cl>│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐     │   │
</span></span><span class=line><span class=cl>│  │  │ cgroups v2 │  │ namespaces │  │ seccomp    │  │ capabilities│    │   │
</span></span><span class=line><span class=cl>│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘     │   │
</span></span><span class=line><span class=cl>│  └─────────────────────────────────────────────────────────────────────┘   │
</span></span><span class=line><span class=cl>│                                                                            │
</span></span><span class=line><span class=cl>└────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><h3 class=heading-element id=12-thành-phần-chính><span>1.2 Thành phần chính</span>
<a href=#12-th%c3%a0nh-ph%e1%ba%a7n-ch%c3%adnh class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><table><thead><tr><th>Component</th><th>Chức năng</th></tr></thead><tbody><tr><td>systemd</td><td>PID 1, init system, quản lý toàn bộ units</td></tr><tr><td>systemctl</td><td>CLI tool để điều khiển systemd</td></tr><tr><td>journald</td><td>Logging daemon, thu thập logs từ tất cả services</td></tr><tr><td>journalctl</td><td>CLI tool để query journal logs</td></tr><tr><td>logind</td><td>Login/session manager</td></tr><tr><td>networkd</td><td>Network configuration daemon</td></tr><tr><td>resolved</td><td>DNS resolver daemon</td></tr><tr><td>timesyncd</td><td>NTP time synchronization</td></tr><tr><td>udevd</td><td>Device manager</td></tr><tr><td>hostnamed</td><td>Hostname management</td></tr><tr><td>localed</td><td>Locale management</td></tr><tr><td>timedatectl</td><td>Time/date/timezone management</td></tr></tbody></table><h3 class=heading-element id=13-unit-types><span>1.3 Unit Types</span>
<a href=#13-unit-types class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                           UNIT TYPES                                       │
</span></span><span class=line><span class=cl>├──────────────┬─────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ Type         │ Mô tả                                           │ Extension │
</span></span><span class=line><span class=cl>├──────────────┼─────────────────────────────────────────────────┼───────────┤
</span></span><span class=line><span class=cl>│ service      │ Processes được quản lý (daemons, apps)          │ .service  │
</span></span><span class=line><span class=cl>│ socket       │ IPC/network sockets, kích hoạt service on-demand│ .socket   │
</span></span><span class=line><span class=cl>│ target       │ Nhóm units, sync points (như runlevels)         │ .target   │
</span></span><span class=line><span class=cl>│ timer        │ Scheduled tasks (thay thế cron)                 │ .timer    │
</span></span><span class=line><span class=cl>│ mount        │ Filesystem mount points                         │ .mount    │
</span></span><span class=line><span class=cl>│ automount    │ Automount points (mount on-access)              │ .automount│
</span></span><span class=line><span class=cl>│ path         │ File/directory watching                         │ .path     │
</span></span><span class=line><span class=cl>│ slice        │ Resource control groups (cgroups)               │ .slice    │
</span></span><span class=line><span class=cl>│ scope        │ External processes (containers, VMs)            │ .scope    │
</span></span><span class=line><span class=cl>│ device       │ Kernel devices                                  │ .device   │
</span></span><span class=line><span class=cl>│ swap         │ Swap space                                      │ .swap     │
</span></span><span class=line><span class=cl>│ snapshot     │ Saved state (deprecated)                        │ .snapshot │
</span></span><span class=line><span class=cl>└──────────────┴─────────────────────────────────────────────────┴───────────┘</span></span></code></pre></div><h3 class=heading-element id=14-unit-file-locations><span>1.4 Unit File Locations</span>
<a href=#14-unit-file-locations class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><table><thead><tr><th>Location</th><th>Mục đích</th></tr></thead><tbody><tr><td>/etc/systemd/system/</td><td>Admin units (cao nhất)</td></tr><tr><td>/run/systemd/system/</td><td>Runtime units</td></tr><tr><td>/usr/lib/systemd/system/</td><td>Package-installed units (thấp nhất)</td></tr><tr><td>~/.config/systemd/user/</td><td>User units (cao nhất)</td></tr><tr><td>/etc/systemd/user/</td><td>Admin user units</td></tr><tr><td>/usr/lib/systemd/user/</td><td>Package user units (thấp nhất)</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ưu tiên: /etc/ &gt; /run/ &gt; /usr/lib/
</span></span><span class=line><span class=cl>         (Admin)  (Runtime)  (Package)</span></span></code></pre></div><hr><h2 class=heading-element id=2-unit-files---cấu-trúc-cơ-bản><span>2. UNIT FILES - CẤU TRÚC CƠ BẢN</span>
<a href=#2-unit-files---c%e1%ba%a5u-tr%c3%bac-c%c6%a1-b%e1%ba%a3n class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=21-cấu-trúc-unit-file><span>2.1 Cấu trúc Unit File</span>
<a href=#21-c%e1%ba%a5u-tr%c3%bac-unit-file class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Unit file có 3 sections chính</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=c1># Metadata và dependencies</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Mô tả service</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://example.com/docs</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target          # Khởi động SAU network</span>
</span></span><span class=line><span class=cl><span class=na>Before</span><span class=o>=</span><span class=s>nginx.service          # Khởi động TRƯỚC nginx</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>postgresql.service   # Dependency cứng (fail nếu dep fail)</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>redis.service           # Dependency mềm (không fail nếu dep fail)</span>
</span></span><span class=line><span class=cl><span class=na>Conflicts</span><span class=o>=</span><span class=s>other.service       # Không thể chạy cùng</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>[Service]  # hoặc [Socket], [Timer], [Mount], etc.</span>
</span></span><span class=line><span class=cl><span class=c1># Cấu hình cụ thể cho loại unit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=c1># Cài đặt enable/disable</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target    # Enable khi target này active</span>
</span></span><span class=line><span class=cl><span class=na>RequiredBy</span><span class=o>=</span><span class=s>other.service      # Required by other service</span>
</span></span><span class=line><span class=cl><span class=na>Alias</span><span class=o>=</span><span class=s>myapp.service           # Tên alias</span></span></span></code></pre></div><h3 class=heading-element id=22-dependency-directives><span>2.2 Dependency Directives</span>
<a href=#22-dependency-directives class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                        DEPENDENCY DIRECTIVES                                │
</span></span><span class=line><span class=cl>├──────────────────┬──────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ Directive        │ Ý nghĩa                                                  │
</span></span><span class=line><span class=cl>├──────────────────┼──────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ ORDERING (thứ tự khởi động, không tạo dependency)                           │
</span></span><span class=line><span class=cl>├──────────────────┼──────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ After=           │ Khởi động SAU unit được liệt kê                          │
</span></span><span class=line><span class=cl>│ Before=          │ Khởi động TRƯỚC unit được liệt kê                        │
</span></span><span class=line><span class=cl>├──────────────────┼──────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ REQUIREMENT (tạo dependency)                                                │
</span></span><span class=line><span class=cl>├──────────────────┼──────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ Requires=        │ Dependency cứng. Unit fail → service này cũng fail       │
</span></span><span class=line><span class=cl>│ Requisite=       │ Như Requires nhưng check ngay. Nếu chưa start → fail     │
</span></span><span class=line><span class=cl>│ Wants=           │ Dependency mềm. Unit fail → service này vẫn chạy         │
</span></span><span class=line><span class=cl>│ BindsTo=         │ Như Requires nhưng stop khi dependency stop              │
</span></span><span class=line><span class=cl>│ PartOf=          │ Stop/restart khi dependency stop/restart                 │
</span></span><span class=line><span class=cl>├──────────────────┼──────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ CONFLICT                                                                    │
</span></span><span class=line><span class=cl>├──────────────────┼──────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ Conflicts=       │ Không thể chạy đồng thời. Start A → Stop B               │
</span></span><span class=line><span class=cl>└──────────────────┴──────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>QUAN TRỌNG:
</span></span><span class=line><span class=cl>- After/Before chỉ định THỨ TỰ, không tạo dependency
</span></span><span class=line><span class=cl>- Requires/Wants tạo DEPENDENCY nhưng không định thứ tự
</span></span><span class=line><span class=cl>- Thường dùng kết hợp: Requires=db.service + After=db.service</span></span></code></pre></div><h3 class=heading-element id=23-điều-kiện-và-assertions><span>2.3 Điều kiện và Assertions</span>
<a href=#23-%c4%91i%e1%bb%81u-ki%e1%bb%87n-v%c3%a0-assertions class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=c1># Conditions - nếu false, unit skip (không fail)</span>
</span></span><span class=line><span class=cl><span class=na>ConditionPathExists</span><span class=o>=</span><span class=s>/etc/myapp.conf</span>
</span></span><span class=line><span class=cl><span class=na>ConditionPathIsDirectory</span><span class=o>=</span><span class=s>/var/lib/myapp</span>
</span></span><span class=line><span class=cl><span class=na>ConditionFileNotEmpty</span><span class=o>=</span><span class=s>/etc/myapp.conf</span>
</span></span><span class=line><span class=cl><span class=na>ConditionDirectoryNotEmpty</span><span class=o>=</span><span class=s>/var/lib/myapp</span>
</span></span><span class=line><span class=cl><span class=na>ConditionPathIsReadWrite</span><span class=o>=</span><span class=s>/data</span>
</span></span><span class=line><span class=cl><span class=na>ConditionPathIsMountPoint</span><span class=o>=</span><span class=s>/mnt/data</span>
</span></span><span class=line><span class=cl><span class=na>ConditionFileIsExecutable</span><span class=o>=</span><span class=s>/usr/bin/myapp</span>
</span></span><span class=line><span class=cl><span class=na>ConditionHost</span><span class=o>=</span><span class=s>webserver01</span>
</span></span><span class=line><span class=cl><span class=na>ConditionVirtualization</span><span class=o>=</span><span class=s>container</span>
</span></span><span class=line><span class=cl><span class=na>ConditionArchitecture</span><span class=o>=</span><span class=s>x86-64</span>
</span></span><span class=line><span class=cl><span class=na>ConditionMemory</span><span class=o>=</span><span class=s>&gt;=4G</span>
</span></span><span class=line><span class=cl><span class=na>ConditionEnvironment</span><span class=o>=</span><span class=s>PRODUCTION=true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Assertions - nếu false, unit FAIL</span>
</span></span><span class=line><span class=cl><span class=na>AssertPathExists</span><span class=o>=</span><span class=s>/critical/file</span>
</span></span><span class=line><span class=cl><span class=na>AssertPathIsDirectory</span><span class=o>=</span><span class=s>/critical/dir</span></span></span></code></pre></div><h3 class=heading-element id=24-specifiers-variables><span>2.4 Specifiers (Variables)</span>
<a href=#24-specifiers-variables class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><table><thead><tr><th>Specifier</th><th>Giá trị</th></tr></thead><tbody><tr><td>%n</td><td>Full unit name (myapp.service)</td></tr><tr><td>%N</td><td>Unescaped unit name</td></tr><tr><td>%p</td><td>Prefix name (myapp, không có suffix)</td></tr><tr><td>%P</td><td>Unescaped prefix</td></tr><tr><td>%i</td><td>Instance name (cho template units)</td></tr><tr><td>%I</td><td>Unescaped instance name</td></tr><tr><td>%f</td><td>Unescaped filename</td></tr><tr><td>%h</td><td>User home directory</td></tr><tr><td>%H</td><td>Hostname</td></tr><tr><td>%m</td><td>Machine ID</td></tr><tr><td>%b</td><td>Boot ID</td></tr><tr><td>%t</td><td>Runtime directory (/run hoặc $XDG_RUNTIME_DIR)</td></tr><tr><td>%u</td><td>Username</td></tr><tr><td>%U</td><td>User UID</td></tr><tr><td>%s</td><td>User shell</td></tr><tr><td>%S</td><td>State directory (/var/lib cho system, ~/.local/share cho user)</td></tr><tr><td>%C</td><td>Cache directory (/var/cache hoặc ~/.cache)</td></tr><tr><td>%L</td><td>Log directory (/var/log hoặc ~/.local/state/log)</td></tr><tr><td>%%</td><td>Literal %</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ví dụ:
</span></span><span class=line><span class=cl>    Description=MyApp on %H
</span></span><span class=line><span class=cl>    ExecStart=/usr/bin/myapp --config=%S/%p/config.yml
</span></span><span class=line><span class=cl>    WorkingDirectory=%S/%p</span></span></code></pre></div><hr><h2 class=heading-element id=3-service-units><span>3. SERVICE UNITS</span>
<a href=#3-service-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=31-service-types><span>3.1 Service Types</span>
<a href=#31-service-types class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><table><thead><tr><th>Type</th><th>Mô tả</th></tr></thead><tbody><tr><td>simple</td><td>Default. Process chính = ExecStart. Systemd coi là started</td></tr><tr><td></td><td>ngay khi fork. Dùng cho processes không fork.</td></tr><tr><td>exec</td><td>Như simple nhưng chờ binary thực sự execute</td></tr><tr><td></td><td>(không chỉ fork). Bash 5.0+ cần thiết.</td></tr><tr><td>forking</td><td>Cho daemons fork kiểu cũ. Parent exit, child tiếp tục.</td></tr><tr><td></td><td>Cần PIDFile= để track main process.</td></tr><tr><td>oneshot</td><td>Cho scripts chạy một lần rồi exit.</td></tr><tr><td></td><td>Thường kết hợp RemainAfterExit=yes.</td></tr><tr><td>dbus</td><td>Như simple nhưng chờ service lấy D-Bus name.</td></tr><tr><td></td><td>Cần BusName=.</td></tr><tr><td>notify</td><td>Như simple nhưng service gửi notification khi ready.</td></tr><tr><td></td><td>Cần sd_notify() trong code.</td></tr><tr><td>idle</td><td>Như simple nhưng chờ tất cả jobs khác dispatch.</td></tr><tr><td></td><td>Dùng cho console output cuối boot.</td></tr></tbody></table><h3 class=heading-element id=32-service-directives><span>3.2 Service Directives</span>
<a href=#32-service-directives class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=c1>#=== TYPE &amp; BEHAVIOR ===</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple                    # simple|exec|forking|oneshot|dbus|notify|idle</span>
</span></span><span class=line><span class=cl><span class=na>RemainAfterExit</span><span class=o>=</span><span class=s>no             # yes: coi là active sau khi process exit</span>
</span></span><span class=line><span class=cl><span class=na>GuessMainPID</span><span class=o>=</span><span class=s>yes               # Guess main PID nếu không có PIDFile</span>
</span></span><span class=line><span class=cl><span class=na>PIDFile</span><span class=o>=</span><span class=s>/run/myapp.pid         # PID file cho forking type</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== EXECUTION ===</span>
</span></span><span class=line><span class=cl><span class=na>ExecStartPre</span><span class=o>=</span><span class=s>/usr/bin/prepare  # Chạy TRƯỚC ExecStart</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/myapp       # Command chính (BẮT BUỘC)</span>
</span></span><span class=line><span class=cl><span class=na>ExecStartPost</span><span class=o>=</span><span class=s>/usr/bin/notify  # Chạy SAU ExecStart thành công</span>
</span></span><span class=line><span class=cl><span class=na>ExecReload</span><span class=o>=</span><span class=s>/bin/kill -HUP $MAINPID   # Reload command</span>
</span></span><span class=line><span class=cl><span class=na>ExecStop</span><span class=o>=</span><span class=s>/usr/bin/myapp stop   # Stop command (default: SIGTERM)</span>
</span></span><span class=line><span class=cl><span class=na>ExecStopPost</span><span class=o>=</span><span class=s>/usr/bin/cleanup  # Chạy sau khi stop</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== TIMEOUTS ===</span>
</span></span><span class=line><span class=cl><span class=na>TimeoutStartSec</span><span class=o>=</span><span class=s>90             # Timeout cho start (default: 90s)</span>
</span></span><span class=line><span class=cl><span class=na>TimeoutStopSec</span><span class=o>=</span><span class=s>90              # Timeout cho stop</span>
</span></span><span class=line><span class=cl><span class=na>TimeoutSec</span><span class=o>=</span><span class=s>90                  # Set cả start và stop</span>
</span></span><span class=line><span class=cl><span class=na>RuntimeMaxSec</span><span class=o>=</span><span class=s>infinity         # Max runtime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== RESTART BEHAVIOR ===</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure             # no|on-success|on-failure|on-abnormal|
</span></span></span><span class=line><span class=cl><span class=s>                               # on-watchdog|on-abort|always</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>5s                  # Delay giữa các lần restart</span>
</span></span><span class=line><span class=cl><span class=na>RestartPreventExitStatus</span><span class=o>=</span><span class=s>0 1   # Không restart với exit codes này</span>
</span></span><span class=line><span class=cl><span class=na>RestartForceExitStatus</span><span class=o>=</span><span class=s>2       # Force restart với exit code này</span>
</span></span><span class=line><span class=cl><span class=na>StartLimitIntervalSec</span><span class=o>=</span><span class=s>600      # Interval để count start attempts</span>
</span></span><span class=line><span class=cl><span class=na>StartLimitBurst</span><span class=o>=</span><span class=s>5              # Max starts trong interval</span>
</span></span><span class=line><span class=cl><span class=na>StartLimitAction</span><span class=o>=</span><span class=s>none          # none|reboot|reboot-force|reboot-immediate|
</span></span></span><span class=line><span class=cl><span class=s>                               # poweroff|poweroff-force|poweroff-immediate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== ENVIRONMENT ===</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;VAR1=value1&#34; &#34;VAR2=value2&#34;</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/etc/myapp/env</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>-/etc/myapp/optional.env  # - = không fail nếu không có</span>
</span></span><span class=line><span class=cl><span class=na>PassEnvironment</span><span class=o>=</span><span class=s>LANG PATH      # Pass từ systemd environment</span>
</span></span><span class=line><span class=cl><span class=na>UnsetEnvironment</span><span class=o>=</span><span class=s>SECRET        # Unset variables</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== WORKING DIRECTORY &amp; USER ===</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/opt/myapp</span>
</span></span><span class=line><span class=cl><span class=na>RootDirectory</span><span class=o>=</span><span class=s>/srv/chroot      # Chroot</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>myapp</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>myapp</span>
</span></span><span class=line><span class=cl><span class=na>SupplementaryGroups</span><span class=o>=</span><span class=s>docker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== PROCESS LIMITS ===</span>
</span></span><span class=line><span class=cl><span class=na>LimitNOFILE</span><span class=o>=</span><span class=s>65536              # Max open files</span>
</span></span><span class=line><span class=cl><span class=na>LimitNPROC</span><span class=o>=</span><span class=s>4096                # Max processes</span>
</span></span><span class=line><span class=cl><span class=na>LimitCORE</span><span class=o>=</span><span class=s>infinity             # Core dump size</span>
</span></span><span class=line><span class=cl><span class=na>LimitAS</span><span class=o>=</span><span class=s>infinity               # Address space</span>
</span></span><span class=line><span class=cl><span class=na>Nice</span><span class=o>=</span><span class=s>-5                        # Nice value (-20 to 19)</span>
</span></span><span class=line><span class=cl><span class=na>OOMScoreAdjust</span><span class=o>=</span><span class=s>-500            # OOM killer score (-1000 to 1000)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== STANDARD I/O ===</span>
</span></span><span class=line><span class=cl><span class=na>StandardInput</span><span class=o>=</span><span class=s>null             # null|tty|tty-force|tty-fail|socket|fd:name</span>
</span></span><span class=line><span class=cl><span class=na>StandardOutput</span><span class=o>=</span><span class=s>journal         # inherit|null|tty|journal|kmsg|
</span></span></span><span class=line><span class=cl><span class=s>                               # journal+console|kmsg+console|file:path|
</span></span></span><span class=line><span class=cl><span class=s>                               # append:path|socket|fd:name</span>
</span></span><span class=line><span class=cl><span class=na>StandardError</span><span class=o>=</span><span class=s>inherit          # Same options as StandardOutput</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== WATCHDOG ===</span>
</span></span><span class=line><span class=cl><span class=na>WatchdogSec</span><span class=o>=</span><span class=s>30s                # Service phải notify trong interval này</span>
</span></span><span class=line><span class=cl><span class=na>NotifyAccess</span><span class=o>=</span><span class=s>main              # none|main|exec|all</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== MISC ===</span>
</span></span><span class=line><span class=cl><span class=na>SyslogIdentifier</span><span class=o>=</span><span class=s>myapp         # Identifier trong logs</span>
</span></span><span class=line><span class=cl><span class=na>KillMode</span><span class=o>=</span><span class=s>mixed                 # control-group|mixed|process|none</span>
</span></span><span class=line><span class=cl><span class=na>KillSignal</span><span class=o>=</span><span class=s>SIGTERM             # Signal để kill</span>
</span></span><span class=line><span class=cl><span class=na>FinalKillSignal</span><span class=o>=</span><span class=s>SIGKILL        # Final signal sau timeout</span>
</span></span><span class=line><span class=cl><span class=na>SendSIGHUP</span><span class=o>=</span><span class=s>no                  # Gửi SIGHUP trước SIGTERM</span>
</span></span><span class=line><span class=cl><span class=na>SendSIGKILL</span><span class=o>=</span><span class=s>yes                # Gửi SIGKILL sau timeout</span></span></span></code></pre></div><h3 class=heading-element id=33-restart-behavior-matrix><span>3.3 Restart Behavior Matrix</span>
<a href=#33-restart-behavior-matrix class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><table><thead><tr><th>Exit Reason</th><th>no on-success on-failure on-abnormal on-abort always</th></tr></thead><tbody><tr><td>Clean exit (0)</td><td>✓ ✓</td></tr><tr><td>Unclean exit</td><td>✓ ✓</td></tr><tr><td>Signal (unclean)</td><td>✓ ✓ ✓</td></tr><tr><td>Timeout</td><td>✓ ✓ ✓</td></tr><tr><td>Watchdog</td><td>✓ ✓ ✓</td></tr><tr><td>Core dump/Abort</td><td>✓ ✓ ✓ ✓</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Recommended:
</span></span><span class=line><span class=cl>- Daemons: Restart=on-failure hoặc always
</span></span><span class=line><span class=cl>- One-shot tasks: Restart=no
</span></span><span class=line><span class=cl>- Critical services: Restart=always với StartLimitBurst để tránh loop</span></span></code></pre></div><h3 class=heading-element id=34-execstart-prefixes><span>3.4 ExecStart Prefixes</span>
<a href=#34-execstart-prefixes class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Prefixes cho ExecStart, ExecStop, etc.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>@/usr/bin/myapp     # @ = không log exec</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>-/usr/bin/maybe     # - = không fail nếu command fail</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>:/usr/bin/skip      # : = không set environment</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>+/usr/bin/root      # + = chạy với full privileges (bỏ qua User=)</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>!/usr/bin/root      # ! = chạy với elevated privileges</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>!!/usr/bin/root     # !! = như ! nhưng thoát khỏi cgroup ambient caps</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kết hợp prefixes</span>
</span></span><span class=line><span class=cl><span class=na>ExecStartPre</span><span class=o>=</span><span class=s>-/usr/bin/optional-prep  # Không fail nếu lỗi</span>
</span></span><span class=line><span class=cl><span class=na>ExecStopPost</span><span class=o>=</span><span class=s>-+/usr/bin/force-cleanup # Không fail, chạy as root</span></span></span></code></pre></div><h3 class=heading-element id=35-ví-dụ-service-units><span>3.5 Ví dụ Service Units</span>
<a href=#35-v%c3%ad-d%e1%bb%a5-service-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 1: Simple web application</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/webapp.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>My Web Application</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://example.com/docs</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target postgresql.service</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>postgresql.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>webapp</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>webapp</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/opt/webapp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>NODE_ENV=production</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/opt/webapp/.env</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/node /opt/webapp/server.js</span>
</span></span><span class=line><span class=cl><span class=na>ExecReload</span><span class=o>=</span><span class=s>/bin/kill -HUP $MAINPID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Security</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHome</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ReadWritePaths</span><span class=o>=</span><span class=s>/opt/webapp/data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 2: Forking daemon (traditional)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/legacy-daemon.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Legacy Daemon</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>forking</span>
</span></span><span class=line><span class=cl><span class=na>PIDFile</span><span class=o>=</span><span class=s>/var/run/legacy-daemon.pid</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/sbin/legacy-daemon -d</span>
</span></span><span class=line><span class=cl><span class=na>ExecReload</span><span class=o>=</span><span class=s>/bin/kill -HUP $MAINPID</span>
</span></span><span class=line><span class=cl><span class=na>ExecStop</span><span class=o>=</span><span class=s>/bin/kill -TERM $MAINPID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 3: Oneshot (run once)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/initialize-app.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Initialize Application</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>Before</span><span class=o>=</span><span class=s>webapp.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>oneshot</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/opt/webapp/bin/init-db.sh</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/opt/webapp/bin/create-dirs.sh</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/opt/webapp/bin/download-assets.sh</span>
</span></span><span class=line><span class=cl><span class=na>RemainAfterExit</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>webapp</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>webapp</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/opt/webapp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 4: Notify service (với sd_notify)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/notifying-app.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Notifying Application</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>notify</span>
</span></span><span class=line><span class=cl><span class=na>NotifyAccess</span><span class=o>=</span><span class=s>main</span>
</span></span><span class=line><span class=cl><span class=na>WatchdogSec</span><span class=o>=</span><span class=s>30s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/notifying-app</span>
</span></span><span class=line><span class=cl><span class=na>ExecReload</span><span class=o>=</span><span class=s>/bin/kill -HUP $MAINPID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><h3 class=heading-element id=36-template-units><span>3.6 Template Units</span>
<a href=#36-template-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Template unit: service@.service (có @ trong tên)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/worker@.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Worker Instance %i</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/worker --id=%i</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>worker</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>WORKER_ID=%i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sử dụng:</span>
</span></span><span class=line><span class=cl><span class=c1># systemctl start worker@1.service</span>
</span></span><span class=line><span class=cl><span class=c1># systemctl start worker@2.service</span>
</span></span><span class=line><span class=cl><span class=c1># systemctl enable worker@{1..4}.service</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Template cho multiple instances với config file</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/app@.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>App Instance %i</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/app --config=/etc/app/%i.conf</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/etc/app/%i.env</span>
</span></span><span class=line><span class=cl><span class=na>RuntimeDirectory</span><span class=o>=</span><span class=s>app-%i</span>
</span></span><span class=line><span class=cl><span class=na>StateDirectory</span><span class=o>=</span><span class=s>app-%i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>app</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>app</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><hr><h2 class=heading-element id=4-timer-units---thay-thế-cron><span>4. TIMER UNITS - THAY THẾ CRON</span>
<a href=#4-timer-units---thay-th%e1%ba%bf-cron class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=41-timer-vs-cron><span>4.1 Timer vs Cron</span>
<a href=#41-timer-vs-cron class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                        TIMER VS CRON                                       │
</span></span><span class=line><span class=cl>├─────────────────────────────┬──────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ Feature                     │ Cron             │ Systemd Timer             │
</span></span><span class=line><span class=cl>├─────────────────────────────┼──────────────────┼───────────────────────────┤
</span></span><span class=line><span class=cl>│ Logging                     │ Manual (stdout)  │ journald (tích hợp)       │
</span></span><span class=line><span class=cl>│ Dependencies                │ Không            │ Có (After=, Requires=)    │
</span></span><span class=line><span class=cl>│ Monotonic scheduling        │ Không            │ Có (OnBootSec, etc.)      │
</span></span><span class=line><span class=cl>│ Calendar scheduling         │ Có               │ Có (OnCalendar=)          │
</span></span><span class=line><span class=cl>│ Missed runs                 │ Skip             │ Persistent= option        │
</span></span><span class=line><span class=cl>│ Randomized delay            │ Không            │ RandomizedDelaySec=       │
</span></span><span class=line><span class=cl>│ Resource control            │ Không            │ cgroups integration       │
</span></span><span class=line><span class=cl>│ Security                    │ Basic            │ Sandboxing đầy đủ         │
</span></span><span class=line><span class=cl>│ Status monitoring           │ Không            │ systemctl status          │
</span></span><span class=line><span class=cl>└─────────────────────────────┴──────────────────┴───────────────────────────┘</span></span></code></pre></div><h3 class=heading-element id=42-timer-directives><span>4.2 Timer Directives</span>
<a href=#42-timer-directives class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Timer]</span>
</span></span><span class=line><span class=cl><span class=c1>#=== MONOTONIC TIMERS (relative to events) ===</span>
</span></span><span class=line><span class=cl><span class=na>OnActiveSec</span><span class=o>=</span><span class=s>5min          # Sau khi timer được activated</span>
</span></span><span class=line><span class=cl><span class=na>OnBootSec</span><span class=o>=</span><span class=s>15min           # Sau khi boot</span>
</span></span><span class=line><span class=cl><span class=na>OnStartupSec</span><span class=o>=</span><span class=s>10min        # Sau khi systemd start (user instance)</span>
</span></span><span class=line><span class=cl><span class=na>OnUnitActiveSec</span><span class=o>=</span><span class=s>1h        # Sau khi unit được activated lần cuối</span>
</span></span><span class=line><span class=cl><span class=na>OnUnitInactiveSec</span><span class=o>=</span><span class=s>30min   # Sau khi unit inactive lần cuối</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== CALENDAR TIMERS (absolute/real-time) ===</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>*-*-* 02:00:00          # Hàng ngày 2:00 AM</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>Mon *-*-* 09:00:00      # Thứ Hai 9:00 AM</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>weekly                   # Hàng tuần</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>monthly                  # Hàng tháng</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>*:0/15                   # Mỗi 15 phút</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>hourly                   # Hàng giờ</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>daily                    # Hàng ngày</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>*-*-01 00:00:00         # Ngày 1 mỗi tháng</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== OPTIONS ===</span>
</span></span><span class=line><span class=cl><span class=na>AccuracySec</span><span class=o>=</span><span class=s>1min          # Độ chính xác (default: 1min)</span>
</span></span><span class=line><span class=cl><span class=na>RandomizedDelaySec</span><span class=o>=</span><span class=s>5min   # Random delay (tránh thundering herd)</span>
</span></span><span class=line><span class=cl><span class=na>Persistent</span><span class=o>=</span><span class=s>true           # Chạy ngay nếu miss lần trước (do shutdown)</span>
</span></span><span class=line><span class=cl><span class=na>WakeSystem</span><span class=o>=</span><span class=s>false          # Wake system từ suspend</span>
</span></span><span class=line><span class=cl><span class=na>Unit</span><span class=o>=</span><span class=s>myapp.service        # Service để trigger (default: same name)</span></span></span></code></pre></div><h3 class=heading-element id=43-oncalendar-format><span>4.3 OnCalendar Format</span>
<a href=#43-oncalendar-format class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                      CALENDAR EVENT EXPRESSIONS                             │
</span></span><span class=line><span class=cl>├─────────────────────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ Format: DayOfWeek Year-Month-Day Hour:Minute:Second                         │
</span></span><span class=line><span class=cl>│ Mỗi phần có thể là *, số cụ thể, range, hoặc list                           │
</span></span><span class=line><span class=cl>├─────────────────────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│ Shortcuts:                                                                  │
</span></span><span class=line><span class=cl>│   minutely     = *-*-* *:*:00                                               │
</span></span><span class=line><span class=cl>│   hourly       = *-*-* *:00:00                                              │
</span></span><span class=line><span class=cl>│   daily        = *-*-* 00:00:00                                             │
</span></span><span class=line><span class=cl>│   weekly       = Mon *-*-* 00:00:00                                         │
</span></span><span class=line><span class=cl>│   monthly      = *-*-01 00:00:00                                            │
</span></span><span class=line><span class=cl>│   quarterly    = *-01,04,07,10-01 00:00:00                                  │
</span></span><span class=line><span class=cl>│   semiannually = *-01,07-01 00:00:00                                        │
</span></span><span class=line><span class=cl>│   yearly       = *-01-01 00:00:00                                           │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│ Examples:                                                                   │
</span></span><span class=line><span class=cl>│   *:0/15                    = Mỗi 15 phút                                   │
</span></span><span class=line><span class=cl>│   Mon,Wed,Fri *-*-* 10:00   = 10:00 thứ 2,4,6                               │
</span></span><span class=line><span class=cl>│   *-*-* 09:00:00            = 9:00 AM hàng ngày                             │
</span></span><span class=line><span class=cl>│   *-*-01 00:00:00           = Ngày 1 mỗi tháng                              │
</span></span><span class=line><span class=cl>│   Sat,Sun *-*-* 02:00:00    = 2:00 AM cuối tuần                             │
</span></span><span class=line><span class=cl>│   *-*-* *:00,30:00          = Mỗi 30 phút                                   │
</span></span><span class=line><span class=cl>│   Mon..Fri *-*-* 08:00      = 8:00 AM ngày trong tuần                       │
</span></span><span class=line><span class=cl>│   *-01,04,07,10-01 00:00    = Đầu mỗi quý                                   │
</span></span><span class=line><span class=cl>│   2024-*-* 00:00:00         = Hàng ngày trong 2024                          │
</span></span><span class=line><span class=cl>│   *-*-~01 00:00:00          = Ngày cuối mỗi tháng (~)                       │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│ Test với: systemd-analyze calendar &#34;OnCalendar expression&#34;                  │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><h3 class=heading-element id=44-timer-examples><span>4.4 Timer Examples</span>
<a href=#44-timer-examples class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 1: Backup hàng ngày</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/backup.timer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Daily Backup Timer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Timer]</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>*-*-* 02:00:00</span>
</span></span><span class=line><span class=cl><span class=na>RandomizedDelaySec</span><span class=o>=</span><span class=s>30min</span>
</span></span><span class=line><span class=cl><span class=na>Persistent</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>Unit</span><span class=o>=</span><span class=s>backup.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>timers.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/backup.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Backup Service</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>oneshot</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/local/bin/backup.sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>backup</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>backup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Nice</span><span class=o>=</span><span class=s>19</span>
</span></span><span class=line><span class=cl><span class=na>IOSchedulingClass</span><span class=o>=</span><span class=s>idle</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Không cần [Install] - được kích hoạt bởi timer</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 2: Cleanup mỗi giờ</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/cleanup.timer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Hourly Cleanup Timer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Timer]</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>hourly</span>
</span></span><span class=line><span class=cl><span class=na>AccuracySec</span><span class=o>=</span><span class=s>5min</span>
</span></span><span class=line><span class=cl><span class=na>Persistent</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>timers.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 3: Health check mỗi 5 phút</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/healthcheck.timer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Health Check Timer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Timer]</span>
</span></span><span class=line><span class=cl><span class=na>OnBootSec</span><span class=o>=</span><span class=s>1min</span>
</span></span><span class=line><span class=cl><span class=na>OnUnitActiveSec</span><span class=o>=</span><span class=s>5min</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>timers.target</span></span></span></code></pre></div><h3 class=heading-element id=45-cron-to-timer-cheatsheet><span>4.5 Cron to Timer Cheatsheet</span>
<a href=#45-cron-to-timer-cheatsheet class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><table><thead><tr><th>Cron Expression</th><th>OnCalendar Equivalent</th></tr></thead><tbody><tr><td>* * * * * (every minute)</td><td><em>:</em>:00 (minutely)</td></tr><tr><td>0 * * * * (every hour)</td><td>*:00:00 (hourly)</td></tr><tr><td>0 0 * * * (daily)</td><td><em>-</em>-* 00:00:00 (daily)</td></tr><tr><td>0 0 * * 0 (weekly, Sun)</td><td>Sun <em>-</em>-* 00:00:00 (weekly)</td></tr><tr><td>0 0 1 * * (monthly)</td><td><em>-</em>-01 00:00:00 (monthly)</td></tr><tr><td>_/15 _ * * * (every 15 min)</td><td>*:0/15:00</td></tr><tr><td>0 9-17 * * 1-5 (9-5 weekdays)</td><td>Mon..Fri <em>-</em>-* 09..17:00</td></tr><tr><td>30 4 * * * (4:30 daily)</td><td><em>-</em>-* 04:30:00</td></tr><tr><td>0 0 1,15 * * (1st & 15th)</td><td><em>-</em>-01,15 00:00:00</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Test calendar expressions:
</span></span><span class=line><span class=cl>systemd-analyze calendar &#34;Mon..Fri *-*-* 09:00&#34;
</span></span><span class=line><span class=cl>systemd-analyze calendar --iterations=5 &#34;daily&#34;</span></span></code></pre></div><hr><h2 class=heading-element id=5-target-units><span>5. TARGET UNITS</span>
<a href=#5-target-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=51-targets-vs-runlevels><span>5.1 Targets vs Runlevels</span>
<a href=#51-targets-vs-runlevels class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                    TARGETS VS RUNLEVELS                                     │
</span></span><span class=line><span class=cl>├─────────────────┬────────────────────┬──────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ SysVinit Level  │ Systemd Target     │ Mô tả                                │
</span></span><span class=line><span class=cl>├─────────────────┼────────────────────┼──────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ 0               │ poweroff.target    │ Shutdown                             │
</span></span><span class=line><span class=cl>│ 1, s, single    │ rescue.target      │ Single-user mode, root shell         │
</span></span><span class=line><span class=cl>│ 2, 3, 4         │ multi-user.target  │ Multi-user, no GUI                   │
</span></span><span class=line><span class=cl>│ 5               │ graphical.target   │ Multi-user với GUI                   │
</span></span><span class=line><span class=cl>│ 6               │ reboot.target      │ Reboot                               │
</span></span><span class=line><span class=cl>├─────────────────┼────────────────────┼──────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ N/A             │ emergency.target   │ Emergency shell (rất minimal)        │
</span></span><span class=line><span class=cl>│ N/A             │ halt.target        │ Halt (không power off)               │
</span></span><span class=line><span class=cl>│ N/A             │ hibernate.target   │ Hibernate to disk                    │
</span></span><span class=line><span class=cl>│ N/A             │ suspend.target     │ Suspend to RAM                       │
</span></span><span class=line><span class=cl>└─────────────────┴────────────────────┴──────────────────────────────────────┘</span></span></code></pre></div><h3 class=heading-element id=52-target-hierarchy><span>5.2 Target Hierarchy</span>
<a href=#52-target-hierarchy class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                      TARGET BOOT HIERARCHY                                  │
</span></span><span class=line><span class=cl>├─────────────────────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│  sysinit.target         ← Earliest boot (mount filesystems, etc.)           │
</span></span><span class=line><span class=cl>│         │                                                                   │
</span></span><span class=line><span class=cl>│         ▼                                                                   │
</span></span><span class=line><span class=cl>│  basic.target           ← Basic system initialized                          │
</span></span><span class=line><span class=cl>│         │                                                                   │
</span></span><span class=line><span class=cl>│         ├──────────────────┬──────────────────┐                             │
</span></span><span class=line><span class=cl>│         ▼                  ▼                  ▼                             │
</span></span><span class=line><span class=cl>│  network.target    sockets.target    timers.target                          │
</span></span><span class=line><span class=cl>│         │                                                                   │
</span></span><span class=line><span class=cl>│         ▼                                                                   │
</span></span><span class=line><span class=cl>│  network-online.target  ← Network fully operational                         │
</span></span><span class=line><span class=cl>│         │                                                                   │
</span></span><span class=line><span class=cl>│         ▼                                                                   │
</span></span><span class=line><span class=cl>│  multi-user.target      ← Non-GUI multi-user system                         │
</span></span><span class=line><span class=cl>│         │                                                                   │
</span></span><span class=line><span class=cl>│         ▼                                                                   │
</span></span><span class=line><span class=cl>│  graphical.target       ← GUI (X11/Wayland)                                 │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│  Other important targets:                                                   │
</span></span><span class=line><span class=cl>│  ─────────────────────────                                                  │
</span></span><span class=line><span class=cl>│  local-fs.target        ← Local filesystems mounted                         │
</span></span><span class=line><span class=cl>│  remote-fs.target       ← Remote filesystems mounted (NFS, etc.)            │
</span></span><span class=line><span class=cl>│  swap.target            ← Swap activated                                    │
</span></span><span class=line><span class=cl>│  sound.target           ← Sound system ready                                │
</span></span><span class=line><span class=cl>│  bluetooth.target       ← Bluetooth ready                                   │
</span></span><span class=line><span class=cl>│  printer.target         ← Printing system ready                             │
</span></span><span class=line><span class=cl>│  paths.target           ← Path units ready                                  │
</span></span><span class=line><span class=cl>│  slices.target          ← Slices ready                                      │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><h3 class=heading-element id=53-thao-tác-với-targets><span>5.3 Thao tác với Targets</span>
<a href=#53-thao-t%c3%a1c-v%e1%bb%9bi-targets class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Xem default target</span>
</span></span><span class=line><span class=cl>systemctl get-default
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set default target</span>
</span></span><span class=line><span class=cl>sudo systemctl set-default multi-user.target
</span></span><span class=line><span class=cl>sudo systemctl set-default graphical.target
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Chuyển target (như thay đổi runlevel)</span>
</span></span><span class=line><span class=cl>sudo systemctl isolate multi-user.target
</span></span><span class=line><span class=cl>sudo systemctl isolate rescue.target
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Boot vào target khác (từ GRUB)</span>
</span></span><span class=line><span class=cl><span class=c1># Thêm vào kernel command line:</span>
</span></span><span class=line><span class=cl><span class=c1># systemd.unit=rescue.target</span>
</span></span><span class=line><span class=cl><span class=c1># systemd.unit=emergency.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># List all targets</span>
</span></span><span class=line><span class=cl>systemctl list-units --type<span class=o>=</span>target
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem dependencies của target</span>
</span></span><span class=line><span class=cl>systemctl list-dependencies multi-user.target
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem reverse dependencies</span>
</span></span><span class=line><span class=cl>systemctl list-dependencies --reverse sshd.service</span></span></code></pre></div><h3 class=heading-element id=54-custom-target><span>5.4 Custom Target</span>
<a href=#54-custom-target class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/myapp.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>My Application Stack</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://example.com/docs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Dependencies</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Optional dependencies</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>myapp-web.service</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>myapp-worker.service</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>myapp-scheduler.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Conflict với graphical (nếu cần)</span>
</span></span><span class=line><span class=cl><span class=c1># Conflicts=graphical.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Sử dụng custom target</span>
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> myapp.target
</span></span><span class=line><span class=cl>sudo systemctl start myapp.target
</span></span><span class=line><span class=cl>sudo systemctl isolate myapp.target  <span class=c1># Chuyển sang target này</span></span></span></code></pre></div><hr><h2 class=heading-element id=6-socket-units><span>6. SOCKET UNITS</span>
<a href=#6-socket-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=61-socket-activation><span>6.1 Socket Activation</span>
<a href=#61-socket-activation class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                      SOCKET ACTIVATION FLOW                                 │
</span></span><span class=line><span class=cl>├─────────────────────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│  1. Boot: Socket unit starts, binds to port                                 │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│     ┌─────────────┐                                                         │
</span></span><span class=line><span class=cl>│     │ myapp.socket│ ──── Listens on port 8080                               │
</span></span><span class=line><span class=cl>│     └─────────────┘                                                         │
</span></span><span class=line><span class=cl>│           │                                                                 │
</span></span><span class=line><span class=cl>│  2. Client connects                                                         │
</span></span><span class=line><span class=cl>│           │                                                                 │
</span></span><span class=line><span class=cl>│           ▼                                                                 │
</span></span><span class=line><span class=cl>│     ┌─────────────┐      ┌──────────────┐                                   │
</span></span><span class=line><span class=cl>│     │ systemd     │ ──▶ │ myapp.service │  ← Service started on-demand     │
</span></span><span class=line><span class=cl>│     └─────────────┘      └──────────────┘                                   │
</span></span><span class=line><span class=cl>│           │                     │                                           │
</span></span><span class=line><span class=cl>│  3. Socket passed to service    │                                           │
</span></span><span class=line><span class=cl>│           └─────────────────────┘                                           │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│  Benefits:                                                                  │
</span></span><span class=line><span class=cl>│  - Faster boot (services not started until needed)                          │
</span></span><span class=line><span class=cl>│  - No connection lost during service restart                                │
</span></span><span class=line><span class=cl>│  - Dependency ordering tự động                                              │
</span></span><span class=line><span class=cl>│  - Resource efficient                                                       │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><h3 class=heading-element id=62-socket-directives><span>6.2 Socket Directives</span>
<a href=#62-socket-directives class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Socket]</span>
</span></span><span class=line><span class=cl><span class=c1>#=== LISTEN ADDRESSES ===</span>
</span></span><span class=line><span class=cl><span class=na>ListenStream</span><span class=o>=</span><span class=s>8080              # TCP port</span>
</span></span><span class=line><span class=cl><span class=na>ListenStream</span><span class=o>=</span><span class=s>192.168.1.1:8080  # Specific IP + port</span>
</span></span><span class=line><span class=cl><span class=na>ListenStream</span><span class=o>=</span><span class=s>/run/myapp.sock   # Unix socket (stream)</span>
</span></span><span class=line><span class=cl><span class=na>ListenDatagram</span><span class=o>=</span><span class=s>5353            # UDP port</span>
</span></span><span class=line><span class=cl><span class=na>ListenSequentialPacket</span><span class=o>=</span><span class=s>...     # Unix socket (sequential packet)</span>
</span></span><span class=line><span class=cl><span class=na>ListenFIFO</span><span class=o>=</span><span class=s>/run/myapp.fifo     # Named pipe</span>
</span></span><span class=line><span class=cl><span class=na>ListenSpecial</span><span class=o>=</span><span class=s>/dev/...         # Special file</span>
</span></span><span class=line><span class=cl><span class=na>ListenNetlink</span><span class=o>=</span><span class=s>...              # Netlink</span>
</span></span><span class=line><span class=cl><span class=na>ListenMessageQueue</span><span class=o>=</span><span class=s>...         # POSIX message queue</span>
</span></span><span class=line><span class=cl><span class=na>ListenUSBFunction</span><span class=o>=</span><span class=s>...          # USB function</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== SOCKET OPTIONS ===</span>
</span></span><span class=line><span class=cl><span class=na>SocketMode</span><span class=o>=</span><span class=s>0660                # Permissions cho Unix socket</span>
</span></span><span class=line><span class=cl><span class=na>SocketUser</span><span class=o>=</span><span class=s>myapp               # Owner của socket</span>
</span></span><span class=line><span class=cl><span class=na>SocketGroup</span><span class=o>=</span><span class=s>myapp              # Group của socket</span>
</span></span><span class=line><span class=cl><span class=na>DirectoryMode</span><span class=o>=</span><span class=s>0755             # Permissions cho socket directory</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== BEHAVIOR ===</span>
</span></span><span class=line><span class=cl><span class=na>Accept</span><span class=o>=</span><span class=s>no                      # no: pass socket to service
</span></span></span><span class=line><span class=cl><span class=s>                               # yes: spawn instance per connection</span>
</span></span><span class=line><span class=cl><span class=na>Backlog</span><span class=o>=</span><span class=s>128                    # Connection backlog</span>
</span></span><span class=line><span class=cl><span class=na>MaxConnections</span><span class=o>=</span><span class=s>64              # Max connections (khi Accept=yes)</span>
</span></span><span class=line><span class=cl><span class=na>MaxConnectionsPerSource</span><span class=o>=</span><span class=s>8      # Max per source IP</span>
</span></span><span class=line><span class=cl><span class=na>KeepAlive</span><span class=o>=</span><span class=s>yes                  # TCP keepalive</span>
</span></span><span class=line><span class=cl><span class=na>NoDelay</span><span class=o>=</span><span class=s>yes                    # TCP nodelay</span>
</span></span><span class=line><span class=cl><span class=na>Priority</span><span class=o>=</span><span class=s>...                   # Socket priority</span>
</span></span><span class=line><span class=cl><span class=na>ReceiveBuffer</span><span class=o>=</span><span class=s>...              # Buffer size</span>
</span></span><span class=line><span class=cl><span class=na>SendBuffer</span><span class=o>=</span><span class=s>...                 # Buffer size</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== SERVICE BINDING ===</span>
</span></span><span class=line><span class=cl><span class=na>Service</span><span class=o>=</span><span class=s>myapp.service          # Explicit service (default: same name)</span></span></span></code></pre></div><h3 class=heading-element id=63-socket-examples><span>6.3 Socket Examples</span>
<a href=#63-socket-examples class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 1: TCP Socket</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/myapp.socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>MyApp Socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Socket]</span>
</span></span><span class=line><span class=cl><span class=na>ListenStream</span><span class=o>=</span><span class=s>8080</span>
</span></span><span class=line><span class=cl><span class=na>Accept</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl><span class=na>BindIPv6Only</span><span class=o>=</span><span class=s>both</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>sockets.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 2: Unix Socket</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/myapp-unix.socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>MyApp Unix Socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Socket]</span>
</span></span><span class=line><span class=cl><span class=na>ListenStream</span><span class=o>=</span><span class=s>/run/myapp/myapp.sock</span>
</span></span><span class=line><span class=cl><span class=na>SocketMode</span><span class=o>=</span><span class=s>0660</span>
</span></span><span class=line><span class=cl><span class=na>SocketUser</span><span class=o>=</span><span class=s>myapp</span>
</span></span><span class=line><span class=cl><span class=na>SocketGroup</span><span class=o>=</span><span class=s>myapp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>sockets.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Ví dụ 3: Per-connection service (inetd style)</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/echo.socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Echo Server Socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Socket]</span>
</span></span><span class=line><span class=cl><span class=na>ListenStream</span><span class=o>=</span><span class=s>7</span>
</span></span><span class=line><span class=cl><span class=na>Accept</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>MaxConnectionsPerSource</span><span class=o>=</span><span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>sockets.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/echo@.service</span>
</span></span><span class=line><span class=cl><span class=c1># Template vì Accept=yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Echo Connection Handler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/bin/cat</span>
</span></span><span class=line><span class=cl><span class=na>StandardInput</span><span class=o>=</span><span class=s>socket</span>
</span></span><span class=line><span class=cl><span class=na>StandardOutput</span><span class=o>=</span><span class=s>socket</span></span></span></code></pre></div><hr><h2 class=heading-element id=7-path-units><span>7. PATH UNITS</span>
<a href=#7-path-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=71-path-unit-overview><span>7.1 Path Unit Overview</span>
<a href=#71-path-unit-overview class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Path unit watch file/directory changes và trigger service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Watch for config changes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Path]</span>
</span></span><span class=line><span class=cl><span class=c1>#=== WATCH TYPES ===</span>
</span></span><span class=line><span class=cl><span class=na>PathExists</span><span class=o>=</span><span class=s>/etc/myapp/trigger        # Trigger khi path exists</span>
</span></span><span class=line><span class=cl><span class=na>PathExistsGlob</span><span class=o>=</span><span class=s>/etc/myapp/*.conf     # Glob pattern</span>
</span></span><span class=line><span class=cl><span class=na>PathChanged</span><span class=o>=</span><span class=s>/etc/myapp/config.yml    # Trigger khi file modified</span>
</span></span><span class=line><span class=cl><span class=na>PathModified</span><span class=o>=</span><span class=s>/etc/myapp/config.yml   # Trigger khi file closed after write</span>
</span></span><span class=line><span class=cl><span class=na>DirectoryNotEmpty</span><span class=o>=</span><span class=s>/var/spool/myapp   # Trigger khi dir không rỗng</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== OPTIONS ===</span>
</span></span><span class=line><span class=cl><span class=na>Unit</span><span class=o>=</span><span class=s>myapp-reload.service            # Service to trigger</span>
</span></span><span class=line><span class=cl><span class=na>MakeDirectory</span><span class=o>=</span><span class=s>yes                    # Create directory if not exists</span>
</span></span><span class=line><span class=cl><span class=na>DirectoryMode</span><span class=o>=</span><span class=s>0755                   # Permissions</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><h3 class=heading-element id=72-path-example><span>7.2 Path Example</span>
<a href=#72-path-example class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/config-watcher.path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Watch Config Files</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Path]</span>
</span></span><span class=line><span class=cl><span class=na>PathModified</span><span class=o>=</span><span class=s>/etc/myapp/config.yml</span>
</span></span><span class=line><span class=cl><span class=na>PathModified</span><span class=o>=</span><span class=s>/etc/myapp/settings.json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/config-watcher.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Reload App on Config Change</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>oneshot</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/systemctl reload myapp.service</span></span></span></code></pre></div><hr><h2 class=heading-element id=8-mount--automount-units><span>8. MOUNT & AUTOMOUNT UNITS</span>
<a href=#8-mount--automount-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=81-mount-units><span>8.1 Mount Units</span>
<a href=#81-mount-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/mnt-data.mount</span>
</span></span><span class=line><span class=cl><span class=c1># Tên file PHẢI match mount point: mnt-data = /mnt/data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Data Mount</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Mount]</span>
</span></span><span class=line><span class=cl><span class=na>What</span><span class=o>=</span><span class=s>/dev/sdb1                # Device/Source</span>
</span></span><span class=line><span class=cl><span class=na>Where</span><span class=o>=</span><span class=s>/mnt/data               # Mount point</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>ext4                     # Filesystem type</span>
</span></span><span class=line><span class=cl><span class=na>Options</span><span class=o>=</span><span class=s>defaults,noatime      # Mount options</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># NFS example:</span>
</span></span><span class=line><span class=cl><span class=c1># What=server:/export/data</span>
</span></span><span class=line><span class=cl><span class=c1># Type=nfs</span>
</span></span><span class=line><span class=cl><span class=c1># Options=vers=4,soft,timeo=100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CIFS example:</span>
</span></span><span class=line><span class=cl><span class=c1># What=//server/share</span>
</span></span><span class=line><span class=cl><span class=c1># Type=cifs</span>
</span></span><span class=line><span class=cl><span class=c1># Options=credentials=/etc/samba/creds,uid=1000,gid=1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><h3 class=heading-element id=82-automount-units><span>8.2 Automount Units</span>
<a href=#82-automount-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/mnt-data.automount</span>
</span></span><span class=line><span class=cl><span class=c1># Mount on-demand khi accessed</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Data Automount</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Automount]</span>
</span></span><span class=line><span class=cl><span class=na>Where</span><span class=o>=</span><span class=s>/mnt/data</span>
</span></span><span class=line><span class=cl><span class=na>DirectoryMode</span><span class=o>=</span><span class=s>0755</span>
</span></span><span class=line><span class=cl><span class=na>TimeoutIdleSec</span><span class=o>=</span><span class=s>300            # Unmount sau 5 phút không dùng</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><h3 class=heading-element id=83-mount-unit-từ-fstab><span>8.3 Mount Unit từ fstab</span>
<a href=#83-mount-unit-t%e1%bb%ab-fstab class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Systemd tự tạo mount units từ /etc/fstab</span>
</span></span><span class=line><span class=cl><span class=c1># Xem generated units:</span>
</span></span><span class=line><span class=cl>systemctl list-units --type<span class=o>=</span>mount
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Convert fstab entry sang mount unit:</span>
</span></span><span class=line><span class=cl>systemd-mount /dev/sdb1 /mnt/data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Generator tạo mount units ở:</span>
</span></span><span class=line><span class=cl>/run/systemd/generator/</span></span></code></pre></div><hr><h2 class=heading-element id=9-systemctl---quản-lý-services><span>9. SYSTEMCTL - QUẢN LÝ SERVICES</span>
<a href=#9-systemctl---qu%e1%ba%a3n-l%c3%bd-services class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=91-basic-commands><span>9.1 Basic Commands</span>
<a href=#91-basic-commands class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== SERVICE LIFECYCLE ===</span>
</span></span><span class=line><span class=cl>systemctl start myapp.service      <span class=c1># Start service</span>
</span></span><span class=line><span class=cl>systemctl stop myapp.service       <span class=c1># Stop service</span>
</span></span><span class=line><span class=cl>systemctl restart myapp.service    <span class=c1># Restart</span>
</span></span><span class=line><span class=cl>systemctl reload myapp.service     <span class=c1># Reload config (nếu supported)</span>
</span></span><span class=line><span class=cl>systemctl reload-or-restart myapp  <span class=c1># Reload nếu có, không thì restart</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== ENABLE/DISABLE ===</span>
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> myapp.service     <span class=c1># Enable at boot</span>
</span></span><span class=line><span class=cl>systemctl disable myapp.service    <span class=c1># Disable at boot</span>
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> --now myapp       <span class=c1># Enable + Start</span>
</span></span><span class=line><span class=cl>systemctl disable --now myapp      <span class=c1># Disable + Stop</span>
</span></span><span class=line><span class=cl>systemctl reenable myapp           <span class=c1># Disable + Enable (reset symlinks)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== STATUS ===</span>
</span></span><span class=line><span class=cl>systemctl status myapp.service     <span class=c1># Status chi tiết</span>
</span></span><span class=line><span class=cl>systemctl is-active myapp          <span class=c1># Check if running</span>
</span></span><span class=line><span class=cl>systemctl is-enabled myapp         <span class=c1># Check if enabled</span>
</span></span><span class=line><span class=cl>systemctl is-failed myapp          <span class=c1># Check if failed</span>
</span></span><span class=line><span class=cl>systemctl show myapp               <span class=c1># Show all properties</span>
</span></span><span class=line><span class=cl>systemctl show -p MainPID myapp    <span class=c1># Show specific property</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== MASK/UNMASK ===</span>
</span></span><span class=line><span class=cl>systemctl mask myapp.service       <span class=c1># Prevent starting (link to /dev/null)</span>
</span></span><span class=line><span class=cl>systemctl unmask myapp.service     <span class=c1># Allow starting again</span></span></span></code></pre></div><h3 class=heading-element id=92-listing-units><span>9.2 Listing Units</span>
<a href=#92-listing-units class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== LIST UNITS ===</span>
</span></span><span class=line><span class=cl>systemctl list-units                        <span class=c1># All loaded units</span>
</span></span><span class=line><span class=cl>systemctl list-units --all                  <span class=c1># Include inactive</span>
</span></span><span class=line><span class=cl>systemctl list-units --type<span class=o>=</span>service         <span class=c1># Only services</span>
</span></span><span class=line><span class=cl>systemctl list-units --state<span class=o>=</span>failed         <span class=c1># Only failed</span>
</span></span><span class=line><span class=cl>systemctl list-units --state<span class=o>=</span>running        <span class=c1># Only running</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== LIST UNIT FILES ===</span>
</span></span><span class=line><span class=cl>systemctl list-unit-files                   <span class=c1># All unit files</span>
</span></span><span class=line><span class=cl>systemctl list-unit-files --type<span class=o>=</span>service    <span class=c1># Only services</span>
</span></span><span class=line><span class=cl>systemctl list-unit-files --state<span class=o>=</span>enabled   <span class=c1># Only enabled</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== LIST DEPENDENCIES ===</span>
</span></span><span class=line><span class=cl>systemctl list-dependencies myapp           <span class=c1># What myapp needs</span>
</span></span><span class=line><span class=cl>systemctl list-dependencies --reverse myapp <span class=c1># What needs myapp</span>
</span></span><span class=line><span class=cl>systemctl list-dependencies --all myapp     <span class=c1># Full tree</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== LIST TIMERS ===</span>
</span></span><span class=line><span class=cl>systemctl list-timers                       <span class=c1># All timers</span>
</span></span><span class=line><span class=cl>systemctl list-timers --all                 <span class=c1># Include inactive</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== LIST SOCKETS ===</span>
</span></span><span class=line><span class=cl>systemctl list-sockets                      <span class=c1># All sockets</span></span></span></code></pre></div><h3 class=heading-element id=93-unit-file-management><span>9.3 Unit File Management</span>
<a href=#93-unit-file-management class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== RELOAD DAEMON ===</span>
</span></span><span class=line><span class=cl>systemctl daemon-reload          <span class=c1># Sau khi edit unit files</span>
</span></span><span class=line><span class=cl>systemctl daemon-reexec          <span class=c1># Re-execute systemd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== EDIT UNITS ===</span>
</span></span><span class=line><span class=cl>systemctl edit myapp.service     <span class=c1># Create override (drop-in)</span>
</span></span><span class=line><span class=cl>systemctl edit --full myapp      <span class=c1># Edit full unit file</span>
</span></span><span class=line><span class=cl>systemctl revert myapp           <span class=c1># Remove overrides</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Override location: /etc/systemd/system/myapp.service.d/override.conf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== CAT UNIT ===</span>
</span></span><span class=line><span class=cl>systemctl cat myapp.service      <span class=c1># Show unit file content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== VERIFY ===</span>
</span></span><span class=line><span class=cl>systemd-analyze verify myapp.service  <span class=c1># Check syntax</span></span></span></code></pre></div><h3 class=heading-element id=94-system-control><span>9.4 System Control</span>
<a href=#94-system-control class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== POWER MANAGEMENT ===</span>
</span></span><span class=line><span class=cl>systemctl poweroff              <span class=c1># Shutdown</span>
</span></span><span class=line><span class=cl>systemctl reboot                <span class=c1># Reboot</span>
</span></span><span class=line><span class=cl>systemctl <span class=nb>suspend</span>               <span class=c1># Suspend to RAM</span>
</span></span><span class=line><span class=cl>systemctl hibernate             <span class=c1># Hibernate to disk</span>
</span></span><span class=line><span class=cl>systemctl hybrid-sleep          <span class=c1># Hybrid (suspend + hibernate)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== TARGETS ===</span>
</span></span><span class=line><span class=cl>systemctl get-default           <span class=c1># Current default target</span>
</span></span><span class=line><span class=cl>systemctl set-default multi-user.target
</span></span><span class=line><span class=cl>systemctl isolate rescue.target <span class=c1># Switch to rescue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== SYSTEM STATE ===</span>
</span></span><span class=line><span class=cl>systemctl is-system-running     <span class=c1># Check system state</span>
</span></span><span class=line><span class=cl><span class=c1># States: initializing, starting, running, degraded, maintenance, stopping, offline</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== RESCUE/EMERGENCY ===</span>
</span></span><span class=line><span class=cl>systemctl rescue                <span class=c1># Enter rescue mode</span>
</span></span><span class=line><span class=cl>systemctl emergency             <span class=c1># Enter emergency mode</span></span></span></code></pre></div><h3 class=heading-element id=95-user-services><span>9.5 User Services</span>
<a href=#95-user-services class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># User services chạy trong user session</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== USER COMMANDS ===</span>
</span></span><span class=line><span class=cl>systemctl --user start myapp.service
</span></span><span class=line><span class=cl>systemctl --user <span class=nb>enable</span> myapp.service
</span></span><span class=line><span class=cl>systemctl --user status myapp.service
</span></span><span class=line><span class=cl>systemctl --user daemon-reload
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># User unit locations:</span>
</span></span><span class=line><span class=cl><span class=c1># ~/.config/systemd/user/</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/user/</span>
</span></span><span class=line><span class=cl><span class=c1># /usr/lib/systemd/user/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Enable lingering (services chạy không cần login)</span>
</span></span><span class=line><span class=cl>loginctl enable-linger username
</span></span><span class=line><span class=cl>loginctl disable-linger username</span></span></code></pre></div><hr><h2 class=heading-element id=10-journald---logging><span>10. JOURNALD - LOGGING</span>
<a href=#10-journald---logging class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=101-journalctl-basics><span>10.1 journalctl Basics</span>
<a href=#101-journalctl-basics class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== BASIC VIEWING ===</span>
</span></span><span class=line><span class=cl>journalctl                      <span class=c1># All logs</span>
</span></span><span class=line><span class=cl>journalctl -f                   <span class=c1># Follow (tail -f)</span>
</span></span><span class=line><span class=cl>journalctl -n <span class=m>100</span>               <span class=c1># Last 100 entries</span>
</span></span><span class=line><span class=cl>journalctl -r                   <span class=c1># Reverse order (newest first)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== BY UNIT ===</span>
</span></span><span class=line><span class=cl>journalctl -u myapp.service     <span class=c1># Logs của service</span>
</span></span><span class=line><span class=cl>journalctl -u myapp -u nginx    <span class=c1># Multiple units</span>
</span></span><span class=line><span class=cl>journalctl -u <span class=s2>&#34;myapp*&#34;</span>          <span class=c1># Wildcard</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== BY TIME ===</span>
</span></span><span class=line><span class=cl>journalctl --since <span class=s2>&#34;2024-01-01&#34;</span>
</span></span><span class=line><span class=cl>journalctl --since <span class=s2>&#34;1 hour ago&#34;</span>
</span></span><span class=line><span class=cl>journalctl --since <span class=s2>&#34;09:00&#34;</span> --until <span class=s2>&#34;10:00&#34;</span>
</span></span><span class=line><span class=cl>journalctl --since yesterday
</span></span><span class=line><span class=cl>journalctl -b                   <span class=c1># Current boot</span>
</span></span><span class=line><span class=cl>journalctl -b -1                <span class=c1># Previous boot</span>
</span></span><span class=line><span class=cl>journalctl --list-boots         <span class=c1># List all boots</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== BY PRIORITY ===</span>
</span></span><span class=line><span class=cl>journalctl -p err               <span class=c1># Error and above</span>
</span></span><span class=line><span class=cl>journalctl -p warning           <span class=c1># Warning and above</span>
</span></span><span class=line><span class=cl><span class=c1># Priorities: emerg(0), alert(1), crit(2), err(3), warning(4), notice(5), info(6), debug(7)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== BY FIELD ===</span>
</span></span><span class=line><span class=cl>journalctl <span class=nv>_PID</span><span class=o>=</span><span class=m>1234</span>
</span></span><span class=line><span class=cl>journalctl <span class=nv>_UID</span><span class=o>=</span><span class=m>1000</span>
</span></span><span class=line><span class=cl>journalctl <span class=nv>_SYSTEMD_UNIT</span><span class=o>=</span>myapp.service
</span></span><span class=line><span class=cl>journalctl <span class=nv>_COMM</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>journalctl <span class=nv>_EXE</span><span class=o>=</span>/usr/bin/nginx
</span></span><span class=line><span class=cl>journalctl <span class=nv>_HOSTNAME</span><span class=o>=</span>webserver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== OUTPUT FORMAT ===</span>
</span></span><span class=line><span class=cl>journalctl -o short             <span class=c1># Default (syslog-like)</span>
</span></span><span class=line><span class=cl>journalctl -o short-precise     <span class=c1># With microseconds</span>
</span></span><span class=line><span class=cl>journalctl -o verbose           <span class=c1># All fields</span>
</span></span><span class=line><span class=cl>journalctl -o json              <span class=c1># JSON output</span>
</span></span><span class=line><span class=cl>journalctl -o json-pretty       <span class=c1># Pretty JSON</span>
</span></span><span class=line><span class=cl>journalctl -o cat               <span class=c1># Message only</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== KERNEL LOGS ===</span>
</span></span><span class=line><span class=cl>journalctl -k                   <span class=c1># Kernel messages only</span>
</span></span><span class=line><span class=cl>journalctl -k -b                <span class=c1># Kernel messages this boot</span></span></span></code></pre></div><h3 class=heading-element id=102-advanced-queries><span>10.2 Advanced Queries</span>
<a href=#102-advanced-queries class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Combine filters (AND logic)</span>
</span></span><span class=line><span class=cl>journalctl -u nginx -p err --since today
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Field matching</span>
</span></span><span class=line><span class=cl>journalctl <span class=nv>CONTAINER_NAME</span><span class=o>=</span>myapp
</span></span><span class=line><span class=cl>journalctl <span class=nv>_TRANSPORT</span><span class=o>=</span>kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Show available fields</span>
</span></span><span class=line><span class=cl>journalctl -F _SYSTEMD_UNIT     <span class=c1># All units that logged</span>
</span></span><span class=line><span class=cl>journalctl -N                   <span class=c1># All field names</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Disk usage</span>
</span></span><span class=line><span class=cl>journalctl --disk-usage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Vacuum old logs</span>
</span></span><span class=line><span class=cl>sudo journalctl --vacuum-time<span class=o>=</span>7d    <span class=c1># Keep 7 days</span>
</span></span><span class=line><span class=cl>sudo journalctl --vacuum-size<span class=o>=</span>500M  <span class=c1># Keep 500MB</span>
</span></span><span class=line><span class=cl>sudo journalctl --vacuum-files<span class=o>=</span><span class=m>5</span>    <span class=c1># Keep 5 files</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Verify integrity</span>
</span></span><span class=line><span class=cl>journalctl --verify
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Export logs</span>
</span></span><span class=line><span class=cl>journalctl -u myapp --since today &gt; myapp.log
</span></span><span class=line><span class=cl>journalctl -o <span class=nb>export</span> &gt; journal-export.bin</span></span></code></pre></div><h3 class=heading-element id=103-journald-configuration><span>10.3 journald Configuration</span>
<a href=#103-journald-configuration class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/journald.conf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Journal]</span>
</span></span><span class=line><span class=cl><span class=na>Storage</span><span class=o>=</span><span class=s>persistent          # auto|volatile|persistent|none</span>
</span></span><span class=line><span class=cl><span class=na>Compress</span><span class=o>=</span><span class=s>yes                # Compress logs</span>
</span></span><span class=line><span class=cl><span class=na>Seal</span><span class=o>=</span><span class=s>yes                    # FSS sealing</span>
</span></span><span class=line><span class=cl><span class=na>SplitMode</span><span class=o>=</span><span class=s>uid               # none|uid|login</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Size limits</span>
</span></span><span class=line><span class=cl><span class=na>SystemMaxUse</span><span class=o>=</span><span class=s>500M           # Max disk usage</span>
</span></span><span class=line><span class=cl><span class=na>SystemKeepFree</span><span class=o>=</span><span class=s>1G           # Keep this much free</span>
</span></span><span class=line><span class=cl><span class=na>SystemMaxFileSize</span><span class=o>=</span><span class=s>50M       # Max per file</span>
</span></span><span class=line><span class=cl><span class=na>SystemMaxFiles</span><span class=o>=</span><span class=s>100          # Max number of files</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>RuntimeMaxUse</span><span class=o>=</span><span class=s>100M          # Same for /run/log</span>
</span></span><span class=line><span class=cl><span class=na>RuntimeKeepFree</span><span class=o>=</span><span class=s>...</span>
</span></span><span class=line><span class=cl><span class=na>RuntimeMaxFileSize</span><span class=o>=</span><span class=s>...</span>
</span></span><span class=line><span class=cl><span class=na>RuntimeMaxFiles</span><span class=o>=</span><span class=s>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Rate limiting</span>
</span></span><span class=line><span class=cl><span class=na>RateLimitIntervalSec</span><span class=o>=</span><span class=s>30s</span>
</span></span><span class=line><span class=cl><span class=na>RateLimitBurst</span><span class=o>=</span><span class=s>10000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Forward to other systems</span>
</span></span><span class=line><span class=cl><span class=na>ForwardToSyslog</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl><span class=na>ForwardToKMsg</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl><span class=na>ForwardToConsole</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl><span class=na>ForwardToWall</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>MaxLevelStore</span><span class=o>=</span><span class=s>debug         # Max level to store</span>
</span></span><span class=line><span class=cl><span class=na>MaxLevelSyslog</span><span class=o>=</span><span class=s>debug        # Max level to syslog</span>
</span></span><span class=line><span class=cl><span class=na>MaxLevelKMsg</span><span class=o>=</span><span class=s>notice         # Max level to kernel</span>
</span></span><span class=line><span class=cl><span class=na>MaxLevelConsole</span><span class=o>=</span><span class=s>info        # Max level to console</span>
</span></span><span class=line><span class=cl><span class=na>MaxLevelWall</span><span class=o>=</span><span class=s>emerg          # Max level to wall</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>TTYPath</span><span class=o>=</span><span class=s>/dev/console</span>
</span></span><span class=line><span class=cl><span class=na>MaxFileSec</span><span class=o>=</span><span class=s>1month           # Rotate after this time</span>
</span></span><span class=line><span class=cl><span class=na>MaxRetentionSec</span><span class=o>=</span><span class=s>1year       # Delete after this time</span></span></span></code></pre></div><h3 class=heading-element id=104-structured-logging><span>10.4 Structured Logging</span>
<a href=#104-structured-logging class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Log từ script với systemd-cat</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Hello from script&#34;</span> <span class=p>|</span> systemd-cat -t myscript -p info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Với priority</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Error occurred&#34;</span> <span class=p>|</span> systemd-cat -t myscript -p err
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Log structured fields (trong code)</span>
</span></span><span class=line><span class=cl><span class=c1># Python: from systemd import journal</span>
</span></span><span class=line><span class=cl><span class=c1># journal.send(&#39;Hello&#39;, FIELD1=&#39;value1&#39;, FIELD2=&#39;value2&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Xem structured fields</span>
</span></span><span class=line><span class=cl>journalctl -u myapp -o verbose</span></span></code></pre></div><hr><h2 class=heading-element id=11-systemd-analyze---performance><span>11. SYSTEMD-ANALYZE - PERFORMANCE</span>
<a href=#11-systemd-analyze---performance class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=111-boot-analysis><span>11.1 Boot Analysis</span>
<a href=#111-boot-analysis class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== BOOT TIME ===</span>
</span></span><span class=line><span class=cl>systemd-analyze                     <span class=c1># Overall boot time</span>
</span></span><span class=line><span class=cl>systemd-analyze <span class=nb>time</span>                <span class=c1># Same as above</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Output:</span>
</span></span><span class=line><span class=cl><span class=c1># Startup finished in 3.123s (kernel) + 5.456s (userspace) = 8.579s</span>
</span></span><span class=line><span class=cl><span class=c1># graphical.target reached after 5.234s in userspace</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== BLAME (slowest units) ===</span>
</span></span><span class=line><span class=cl>systemd-analyze blame               <span class=c1># List by startup time</span>
</span></span><span class=line><span class=cl>systemd-analyze blame <span class=p>|</span> head -20    <span class=c1># Top 20 slowest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== CRITICAL CHAIN ===</span>
</span></span><span class=line><span class=cl>systemd-analyze critical-chain      <span class=c1># Critical path</span>
</span></span><span class=line><span class=cl>systemd-analyze critical-chain myapp.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== PLOT (graphical) ===</span>
</span></span><span class=line><span class=cl>systemd-analyze plot &gt; boot.svg     <span class=c1># SVG timeline</span>
</span></span><span class=line><span class=cl><span class=c1># Mở boot.svg trong browser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== DOT (dependency graph) ===</span>
</span></span><span class=line><span class=cl>systemd-analyze dot <span class=p>|</span> dot -Tsvg &gt; deps.svg
</span></span><span class=line><span class=cl>systemd-analyze dot myapp.service <span class=p>|</span> dot -Tsvg &gt; myapp-deps.svg</span></span></code></pre></div><h3 class=heading-element id=112-unit-analysis><span>11.2 Unit Analysis</span>
<a href=#112-unit-analysis class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== VERIFY UNIT ===</span>
</span></span><span class=line><span class=cl>systemd-analyze verify myapp.service
</span></span><span class=line><span class=cl>systemd-analyze verify /etc/systemd/system/*.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== SECURITY ANALYSIS ===</span>
</span></span><span class=line><span class=cl>systemd-analyze security            <span class=c1># All services</span>
</span></span><span class=line><span class=cl>systemd-analyze security myapp.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Output: Security score 0-10 (lower is better)</span>
</span></span><span class=line><span class=cl><span class=c1># Recommendations để harden service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== CALENDAR TESTING ===</span>
</span></span><span class=line><span class=cl>systemd-analyze calendar <span class=s2>&#34;Mon..Fri *-*-* 09:00&#34;</span>
</span></span><span class=line><span class=cl>systemd-analyze calendar --iterations<span class=o>=</span><span class=m>5</span> <span class=s2>&#34;daily&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== TIMESPAN PARSING ===</span>
</span></span><span class=line><span class=cl>systemd-analyze timespan <span class=s2>&#34;2h 30min&#34;</span>
</span></span><span class=line><span class=cl>systemd-analyze timespan <span class=s2>&#34;1d 12h&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== CAT-CONFIG ===</span>
</span></span><span class=line><span class=cl>systemd-analyze cat-config systemd/journald.conf
</span></span><span class=line><span class=cl><span class=c1># Show effective config with all overrides</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== UNIT PATHS ===</span>
</span></span><span class=line><span class=cl>systemd-analyze unit-paths          <span class=c1># All unit file locations</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== CONDITION ===</span>
</span></span><span class=line><span class=cl>systemd-analyze condition <span class=s1>&#39;ConditionPathExists=/etc/myapp.conf&#39;</span></span></span></code></pre></div><h3 class=heading-element id=113-system-analysis><span>11.3 System Analysis</span>
<a href=#113-system-analysis class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== DUMP STATE ===</span>
</span></span><span class=line><span class=cl>systemd-analyze dump                <span class=c1># Dump internal state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== EXIT STATUS ===</span>
</span></span><span class=line><span class=cl>systemd-analyze exit-status <span class=m>143</span>     <span class=c1># Explain exit code</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== CAPABILITY ===</span>
</span></span><span class=line><span class=cl>systemd-analyze capability CAP_NET_ADMIN
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== SYSCALL FILTER ===</span>
</span></span><span class=line><span class=cl>systemd-analyze syscall-filter @network-io
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== FILESYSTEMS ===</span>
</span></span><span class=line><span class=cl>systemd-analyze filesystems         <span class=c1># List filesystem types</span></span></span></code></pre></div><hr><h2 class=heading-element id=12-resource-control---cgroups><span>12. RESOURCE CONTROL - CGROUPS</span>
<a href=#12-resource-control---cgroups class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=121-resource-control-directives><span>12.1 Resource Control Directives</span>
<a href=#121-resource-control-directives class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=c1>#=== CPU ===</span>
</span></span><span class=line><span class=cl><span class=na>CPUWeight</span><span class=o>=</span><span class=s>100                  # Relative weight (1-10000, default 100)</span>
</span></span><span class=line><span class=cl><span class=na>CPUQuota</span><span class=o>=</span><span class=s>50%                   # Max CPU time (50% of one core)</span>
</span></span><span class=line><span class=cl><span class=na>CPUQuota</span><span class=o>=</span><span class=s>200%                  # Max 200% = 2 cores</span>
</span></span><span class=line><span class=cl><span class=na>AllowedCPUs</span><span class=o>=</span><span class=s>0-3                # Pin to specific CPUs</span>
</span></span><span class=line><span class=cl><span class=na>AllowedMemoryNodes</span><span class=o>=</span><span class=s>0           # NUMA nodes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== MEMORY ===</span>
</span></span><span class=line><span class=cl><span class=na>MemoryMin</span><span class=o>=</span><span class=s>500M                 # Guaranteed minimum</span>
</span></span><span class=line><span class=cl><span class=na>MemoryLow</span><span class=o>=</span><span class=s>1G                   # Soft limit (protected from OOM)</span>
</span></span><span class=line><span class=cl><span class=na>MemoryHigh</span><span class=o>=</span><span class=s>2G                  # Throttle limit</span>
</span></span><span class=line><span class=cl><span class=na>MemoryMax</span><span class=o>=</span><span class=s>4G                   # Hard limit (OOM killed)</span>
</span></span><span class=line><span class=cl><span class=na>MemorySwapMax</span><span class=o>=</span><span class=s>1G               # Swap limit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== I/O ===</span>
</span></span><span class=line><span class=cl><span class=na>IOWeight</span><span class=o>=</span><span class=s>100                   # Relative weight (1-10000)</span>
</span></span><span class=line><span class=cl><span class=na>IODeviceWeight</span><span class=o>=</span><span class=s>/dev/sda 200    # Per-device weight</span>
</span></span><span class=line><span class=cl><span class=na>IOReadBandwidthMax</span><span class=o>=</span><span class=s>/dev/sda 100M  # Read limit</span>
</span></span><span class=line><span class=cl><span class=na>IOWriteBandwidthMax</span><span class=o>=</span><span class=s>/dev/sda 50M  # Write limit</span>
</span></span><span class=line><span class=cl><span class=na>IOReadIOPSMax</span><span class=o>=</span><span class=s>/dev/sda 1000    # IOPS limit</span>
</span></span><span class=line><span class=cl><span class=na>IOWriteIOPSMax</span><span class=o>=</span><span class=s>/dev/sda 500</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== TASKS ===</span>
</span></span><span class=line><span class=cl><span class=na>TasksMax</span><span class=o>=</span><span class=s>512                   # Max number of tasks (processes/threads)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== NETWORK (experimental) ===</span>
</span></span><span class=line><span class=cl><span class=na>IPAddressAllow</span><span class=o>=</span><span class=s>192.168.1.0/24</span>
</span></span><span class=line><span class=cl><span class=na>IPAddressDeny</span><span class=o>=</span><span class=s>any</span></span></span></code></pre></div><h3 class=heading-element id=122-slices><span>12.2 Slices</span>
<a href=#122-slices class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│                        SLICE HIERARCHY                                      │
</span></span><span class=line><span class=cl>├─────────────────────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>│  -.slice (root)                                                             │
</span></span><span class=line><span class=cl>│     │                                                                       │
</span></span><span class=line><span class=cl>│     ├── system.slice          ← System services                             │
</span></span><span class=line><span class=cl>│     │      │                                                                │
</span></span><span class=line><span class=cl>│     │      ├── nginx.service                                                │
</span></span><span class=line><span class=cl>│     │      ├── postgresql.service                                           │
</span></span><span class=line><span class=cl>│     │      └── myapp.slice    ← Custom slice cho app                        │
</span></span><span class=line><span class=cl>│     │             ├── myapp-web.service                                     │
</span></span><span class=line><span class=cl>│     │             └── myapp-worker.service                                  │
</span></span><span class=line><span class=cl>│     │                                                                       │
</span></span><span class=line><span class=cl>│     ├── user.slice            ← User sessions                               │
</span></span><span class=line><span class=cl>│     │      │                                                                │
</span></span><span class=line><span class=cl>│     │      └── user-1000.slice                                              │
</span></span><span class=line><span class=cl>│     │             └── user@1000.service                                     │
</span></span><span class=line><span class=cl>│     │                                                                       │
</span></span><span class=line><span class=cl>│     └── machine.slice         ← VMs và containers                           │
</span></span><span class=line><span class=cl>│            └── container@mycontainer.service                                │
</span></span><span class=line><span class=cl>│                                                                             │
</span></span><span class=line><span class=cl>└─────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><h3 class=heading-element id=123-custom-slice><span>12.3 Custom Slice</span>
<a href=#123-custom-slice class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/myapp.slice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>MyApp Resource Slice</span>
</span></span><span class=line><span class=cl><span class=na>Before</span><span class=o>=</span><span class=s>slices.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Slice]</span>
</span></span><span class=line><span class=cl><span class=na>CPUWeight</span><span class=o>=</span><span class=s>200</span>
</span></span><span class=line><span class=cl><span class=na>MemoryMax</span><span class=o>=</span><span class=s>8G</span>
</span></span><span class=line><span class=cl><span class=na>TasksMax</span><span class=o>=</span><span class=s>1024</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Service sử dụng slice</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/systemd/system/myapp-web.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Slice</span><span class=o>=</span><span class=s>myapp.slice</span>
</span></span><span class=line><span class=cl><span class=c1># Resource limits trong slice apply cho tất cả services trong slice</span></span></span></code></pre></div><h3 class=heading-element id=124-systemd-cgtop><span>12.4 systemd-cgtop</span>
<a href=#124-systemd-cgtop class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Monitor cgroup resource usage</span>
</span></span><span class=line><span class=cl>systemd-cgtop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Columns:</span>
</span></span><span class=line><span class=cl><span class=c1># Control Group        Tasks   %CPU   Memory  Input/s Output/s</span>
</span></span><span class=line><span class=cl><span class=c1># /                    245     15.2   4.2G    0B      0B</span>
</span></span><span class=line><span class=cl><span class=c1># /system.slice        98      10.1   2.1G    0B      0B</span>
</span></span><span class=line><span class=cl><span class=c1># /user.slice          147     5.1    2.1G    0B      0B</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Options</span>
</span></span><span class=line><span class=cl>systemd-cgtop -m          <span class=c1># Sort by memory</span>
</span></span><span class=line><span class=cl>systemd-cgtop -c          <span class=c1># Sort by CPU</span>
</span></span><span class=line><span class=cl>systemd-cgtop -t          <span class=c1># Sort by tasks</span>
</span></span><span class=line><span class=cl>systemd-cgtop -n <span class=m>5</span>        <span class=c1># 5 iterations then exit</span>
</span></span><span class=line><span class=cl>systemd-cgtop -d <span class=m>2</span>        <span class=c1># Update every 2 seconds</span></span></span></code></pre></div><h3 class=heading-element id=125-runtime-resource-control><span>12.5 Runtime Resource Control</span>
<a href=#125-runtime-resource-control class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Change resource limits at runtime</span>
</span></span><span class=line><span class=cl>sudo systemctl set-property myapp.service <span class=nv>CPUQuota</span><span class=o>=</span>30%
</span></span><span class=line><span class=cl>sudo systemctl set-property myapp.service <span class=nv>MemoryMax</span><span class=o>=</span>2G
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Persistent (tạo drop-in file)</span>
</span></span><span class=line><span class=cl>sudo systemctl set-property myapp.service --runtime<span class=o>=</span><span class=nb>false</span> <span class=nv>CPUQuota</span><span class=o>=</span>30%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># View current limits</span>
</span></span><span class=line><span class=cl>systemctl show -p CPUQuota myapp.service
</span></span><span class=line><span class=cl>systemctl show -p MemoryMax myapp.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># View all cgroup info</span>
</span></span><span class=line><span class=cl>systemctl status myapp.service
</span></span><span class=line><span class=cl><span class=c1># Shows: CGroup: /system.slice/myapp.service</span>
</span></span><span class=line><span class=cl><span class=c1>#              └─12345 /usr/bin/myapp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Inspect cgroup directly</span>
</span></span><span class=line><span class=cl>cat /sys/fs/cgroup/system.slice/myapp.service/memory.current
</span></span><span class=line><span class=cl>cat /sys/fs/cgroup/system.slice/myapp.service/cpu.stat</span></span></code></pre></div><hr><h2 class=heading-element id=13-security-hardening><span>13. SECURITY HARDENING</span>
<a href=#13-security-hardening class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=131-security-directives><span>13.1 Security Directives</span>
<a href=#131-security-directives class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=c1>#=== FILESYSTEM ===</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict           # /usr, /boot readonly. /etc readonly nếu strict</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHome</span><span class=o>=</span><span class=s>yes                # /home, /root, /run/user inaccessible</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>yes                 # Private /tmp và /var/tmp</span>
</span></span><span class=line><span class=cl><span class=na>PrivateDevices</span><span class=o>=</span><span class=s>yes             # Private /dev</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelTunables</span><span class=o>=</span><span class=s>yes      # /proc/sys, /sys readonly</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelModules</span><span class=o>=</span><span class=s>yes       # Không load kernel modules</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelLogs</span><span class=o>=</span><span class=s>yes          # Không access kernel logs</span>
</span></span><span class=line><span class=cl><span class=na>ProtectControlGroups</span><span class=o>=</span><span class=s>yes       # /sys/fs/cgroup readonly</span>
</span></span><span class=line><span class=cl><span class=na>ProtectProc</span><span class=o>=</span><span class=s>invisible          # /proc access: default|invisible|noaccess</span>
</span></span><span class=line><span class=cl><span class=na>ProcSubset</span><span class=o>=</span><span class=s>pid                 # pid|all</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Mount options</span>
</span></span><span class=line><span class=cl><span class=na>ReadWritePaths</span><span class=o>=</span><span class=s>/var/lib/myapp  # Writable paths (khi ProtectSystem=strict)</span>
</span></span><span class=line><span class=cl><span class=na>ReadOnlyPaths</span><span class=o>=</span><span class=s>/data            # Readonly paths</span>
</span></span><span class=line><span class=cl><span class=na>InaccessiblePaths</span><span class=o>=</span><span class=s>/secret      # Inaccessible paths</span>
</span></span><span class=line><span class=cl><span class=na>TemporaryFileSystem</span><span class=o>=</span><span class=s>/var:ro    # Tmpfs overlay</span>
</span></span><span class=line><span class=cl><span class=na>BindPaths</span><span class=o>=</span><span class=s>/src:/dest           # Bind mounts</span>
</span></span><span class=line><span class=cl><span class=na>BindReadOnlyPaths</span><span class=o>=</span><span class=s>/src:/dest   # Readonly bind</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== CAPABILITIES ===</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes            # Không thể gain privileges</span>
</span></span><span class=line><span class=cl><span class=na>CapabilityBoundingSet</span><span class=o>=</span>         <span class=s># Drop all capabilities</span>
</span></span><span class=line><span class=cl><span class=na>CapabilityBoundingSet</span><span class=o>=</span><span class=s>CAP_NET_BIND_SERVICE  # Only allow binding &lt;1024</span>
</span></span><span class=line><span class=cl><span class=na>AmbientCapabilities</span><span class=o>=</span><span class=s>CAP_NET_BIND_SERVICE    # Ambient caps for non-root</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== NAMESPACES ===</span>
</span></span><span class=line><span class=cl><span class=na>PrivateNetwork</span><span class=o>=</span><span class=s>yes             # Private network namespace (no network)</span>
</span></span><span class=line><span class=cl><span class=na>PrivateUsers</span><span class=o>=</span><span class=s>yes               # Private user namespace</span>
</span></span><span class=line><span class=cl><span class=na>PrivateIPC</span><span class=o>=</span><span class=s>yes                 # Private IPC namespace</span>
</span></span><span class=line><span class=cl><span class=na>PrivateMounts</span><span class=o>=</span><span class=s>yes              # Private mount namespace</span>
</span></span><span class=line><span class=cl><span class=na>RestrictNamespaces</span><span class=o>=</span><span class=s>yes         # Cannot create namespaces</span>
</span></span><span class=line><span class=cl><span class=na>RestrictNamespaces</span><span class=o>=</span><span class=s>~user       # Deny specific namespace types</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== SYSCALL FILTERING ===</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallFilter</span><span class=o>=</span><span class=s>@system-service  # Allow only system-service calls</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallFilter</span><span class=o>=</span><span class=s>~@mount          # Deny mount calls</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallArchitectures</span><span class=o>=</span><span class=s>native    # Only native arch</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallErrorNumber</span><span class=o>=</span><span class=s>EPERM       # Return this on denied calls</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== MISC ===</span>
</span></span><span class=line><span class=cl><span class=na>RestrictAddressFamilies</span><span class=o>=</span><span class=s>AF_INET AF_INET6 AF_UNIX  # Allowed address families</span>
</span></span><span class=line><span class=cl><span class=na>RestrictRealtime</span><span class=o>=</span><span class=s>yes           # No realtime scheduling</span>
</span></span><span class=line><span class=cl><span class=na>RestrictSUIDSGID</span><span class=o>=</span><span class=s>yes           # No SUID/SGID</span>
</span></span><span class=line><span class=cl><span class=na>LockPersonality</span><span class=o>=</span><span class=s>yes            # Lock execution domain</span>
</span></span><span class=line><span class=cl><span class=na>MemoryDenyWriteExecute</span><span class=o>=</span><span class=s>yes     # W^X enforcement</span>
</span></span><span class=line><span class=cl><span class=na>UMask</span><span class=o>=</span><span class=s>0077                     # Restrictive umask</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== SECCOMP ===</span>
</span></span><span class=line><span class=cl><span class=na>SecureBits</span><span class=o>=</span><span class=s>keep-caps           # Secure bits</span></span></span></code></pre></div><h3 class=heading-element id=132-security-profiles><span>13.2 Security Profiles</span>
<a href=#132-security-profiles class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Minimal network service</span>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>DynamicUser</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHome</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateDevices</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelTunables</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelModules</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectControlGroups</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>RestrictRealtime</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>RestrictSUIDSGID</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallFilter</span><span class=o>=</span><span class=s>@system-service</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallArchitectures</span><span class=o>=</span><span class=s>native</span>
</span></span><span class=line><span class=cl><span class=na>MemoryDenyWriteExecute</span><span class=o>=</span><span class=s>yes</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># High security (paranoid)</span>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>nobody</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>nobody</span>
</span></span><span class=line><span class=cl><span class=na>DynamicUser</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHome</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateDevices</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateNetwork</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateUsers</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateIPC</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelTunables</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelModules</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelLogs</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectControlGroups</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHostname</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectClock</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>CapabilityBoundingSet</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=na>RestrictNamespaces</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>RestrictRealtime</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>RestrictSUIDSGID</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>LockPersonality</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>MemoryDenyWriteExecute</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallFilter</span><span class=o>=</span><span class=s>@system-service</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallFilter</span><span class=o>=</span><span class=s>~@privileged @resources</span>
</span></span><span class=line><span class=cl><span class=na>SystemCallArchitectures</span><span class=o>=</span><span class=s>native</span>
</span></span><span class=line><span class=cl><span class=na>RestrictAddressFamilies</span><span class=o>=</span><span class=s>AF_UNIX</span>
</span></span><span class=line><span class=cl><span class=na>UMask</span><span class=o>=</span><span class=s>0077</span></span></span></code></pre></div><h3 class=heading-element id=133-check-security-score><span>13.3 Check Security Score</span>
<a href=#133-check-security-score class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Analyze security của service</span>
</span></span><span class=line><span class=cl>systemd-analyze security myapp.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Output example:</span>
</span></span><span class=line><span class=cl><span class=c1>#  NAME                          DESCRIPTION                    EXPOSURE</span>
</span></span><span class=line><span class=cl><span class=c1># ✗ PrivateNetwork=              Service has access to host&#39;s   0.5</span>
</span></span><span class=line><span class=cl><span class=c1>#                                network</span>
</span></span><span class=line><span class=cl><span class=c1># ✓ PrivateTmp=                  Service has no access to       0.1</span>
</span></span><span class=line><span class=cl><span class=c1>#                                other software&#39;s temp files</span>
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl><span class=c1># → Overall exposure level: 4.5 MEDIUM</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Filter by score</span>
</span></span><span class=line><span class=cl>systemd-analyze security --threshold<span class=o>=</span><span class=m>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># JSON output</span>
</span></span><span class=line><span class=cl>systemd-analyze security myapp.service --json<span class=o>=</span>pretty</span></span></code></pre></div><hr><h2 class=heading-element id=14-debugging--troubleshooting><span>14. DEBUGGING & TROUBLESHOOTING</span>
<a href=#14-debugging--troubleshooting class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=141-debug-commands><span>14.1 Debug Commands</span>
<a href=#141-debug-commands class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#=== SERVICE STATUS ===</span>
</span></span><span class=line><span class=cl>systemctl status myapp.service -l   <span class=c1># Full output, no truncate</span>
</span></span><span class=line><span class=cl>systemctl status myapp --no-pager   <span class=c1># No pager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== LOGS ===</span>
</span></span><span class=line><span class=cl>journalctl -u myapp.service -f      <span class=c1># Follow logs</span>
</span></span><span class=line><span class=cl>journalctl -u myapp -n <span class=m>100</span> --no-pager
</span></span><span class=line><span class=cl>journalctl -u myapp -p err          <span class=c1># Only errors</span>
</span></span><span class=line><span class=cl>journalctl -u myapp -b              <span class=c1># This boot only</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== SHOW PROPERTIES ===</span>
</span></span><span class=line><span class=cl>systemctl show myapp.service        <span class=c1># All properties</span>
</span></span><span class=line><span class=cl>systemctl show -p ExecStart myapp   <span class=c1># Specific property</span>
</span></span><span class=line><span class=cl>systemctl show -p ActiveState,SubState myapp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== DEBUG MODE ===</span>
</span></span><span class=line><span class=cl><span class=c1># Tăng verbosity</span>
</span></span><span class=line><span class=cl><span class=nv>SYSTEMD_LOG_LEVEL</span><span class=o>=</span>debug systemctl restart myapp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Environment cho debug</span>
</span></span><span class=line><span class=cl>sudo <span class=nv>SYSTEMD_LOG_LEVEL</span><span class=o>=</span>debug /usr/lib/systemd/systemd --test
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#=== COREDUMP ===</span>
</span></span><span class=line><span class=cl>coredumpctl list                    <span class=c1># List coredumps</span>
</span></span><span class=line><span class=cl>coredumpctl info                    <span class=c1># Last coredump info</span>
</span></span><span class=line><span class=cl>coredumpctl gdb                     <span class=c1># Debug with gdb</span></span></span></code></pre></div><h3 class=heading-element id=142-common-issues><span>14.2 Common Issues</span>
<a href=#142-common-issues class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><table><thead><tr><th>Issue</th><th>Solution</th></tr></thead><tbody><tr><td>Service fails to start</td><td>journalctl -u service -n 50</td></tr><tr><td></td><td>Check ExecStart path & permissions</td></tr><tr><td>Unit file not found</td><td>systemctl daemon-reload</td></tr><tr><td></td><td>Check unit file location & name</td></tr><tr><td>Service starts but exits immediately</td><td>Check Type= (use notify if needed)</td></tr><tr><td></td><td>Add RemainAfterExit=yes for oneshot</td></tr><tr><td>Permission denied</td><td>Check User=, Group=, WorkingDirectory</td></tr><tr><td></td><td>Check ProtectSystem, ProtectHome</td></tr><tr><td>Cannot bind to port</td><td>Check if port in use: ss -tlnp</td></tr><tr><td></td><td>Add CAP_NET_BIND_SERVICE for &lt;1024</td></tr><tr><td>Environment variables not loaded</td><td>Check EnvironmentFile path</td></tr><tr><td></td><td>Use - prefix for optional files</td></tr><tr><td>Service masked</td><td>systemctl unmask service</td></tr><tr><td>Dependency issues</td><td>systemctl list-dependencies</td></tr><tr><td></td><td>Check After=, Requires=, Wants=</td></tr><tr><td>Timer not triggering</td><td>systemctl list-timers</td></tr><tr><td></td><td>Check OnCalendar syntax</td></tr><tr><td></td><td>systemd-analyze calendar &ldquo;expr&rdquo;</td></tr><tr><td>Socket activation not working</td><td>Check ListenStream format</td></tr><tr><td></td><td>Ensure socket enabled, not service</td></tr><tr><td>OOM killed</td><td>Check MemoryMax, increase limit</td></tr><tr><td></td><td>journalctl -k | grep -i oom</td></tr><tr><td>Slow boot</td><td>systemd-analyze blame</td></tr><tr><td></td><td>systemd-analyze critical-chain</td></tr></tbody></table><h3 class=heading-element id=143-debug-checklist><span>14.3 Debug Checklist</span>
<a href=#143-debug-checklist class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># Debug script cho systemd service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>SERVICE</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;=== Service Status ===&#34;</span>
</span></span><span class=line><span class=cl>systemctl status <span class=s2>&#34;</span><span class=nv>$SERVICE</span><span class=s2>&#34;</span> --no-pager -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n=== Is Enabled? ===&#34;</span>
</span></span><span class=line><span class=cl>systemctl is-enabled <span class=s2>&#34;</span><span class=nv>$SERVICE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n=== Unit File ===&#34;</span>
</span></span><span class=line><span class=cl>systemctl cat <span class=s2>&#34;</span><span class=nv>$SERVICE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n=== Dependencies ===&#34;</span>
</span></span><span class=line><span class=cl>systemctl list-dependencies <span class=s2>&#34;</span><span class=nv>$SERVICE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n=== Properties ===&#34;</span>
</span></span><span class=line><span class=cl>systemctl show <span class=s2>&#34;</span><span class=nv>$SERVICE</span><span class=s2>&#34;</span> <span class=p>|</span> grep -E <span class=s1>&#39;^(ExecStart|User|Group|WorkingDirectory|Environment)&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n=== Recent Logs ===&#34;</span>
</span></span><span class=line><span class=cl>journalctl -u <span class=s2>&#34;</span><span class=nv>$SERVICE</span><span class=s2>&#34;</span> -n <span class=m>20</span> --no-pager
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n=== Failed Units ===&#34;</span>
</span></span><span class=line><span class=cl>systemctl --failed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;\n=== Security Score ===&#34;</span>
</span></span><span class=line><span class=cl>systemd-analyze security <span class=s2>&#34;</span><span class=nv>$SERVICE</span><span class=s2>&#34;</span> 2&gt;/dev/null <span class=p>|</span> head -20</span></span></code></pre></div><hr><h2 class=heading-element id=15-production-templates><span>15. PRODUCTION TEMPLATES</span>
<a href=#15-production-templates class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=151-web-application><span>15.1 Web Application</span>
<a href=#151-web-application class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/webapp.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Web Application</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://example.com/docs</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network-online.target postgresql.service redis.service</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>postgresql.service</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>redis.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>notify</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>webapp</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>webapp</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/opt/webapp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Environment</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>NODE_ENV=production</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/opt/webapp/.env</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>-/opt/webapp/.env.local</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Execution</span>
</span></span><span class=line><span class=cl><span class=na>ExecStartPre</span><span class=o>=</span><span class=s>/opt/webapp/bin/pre-start.sh</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/node /opt/webapp/server.js</span>
</span></span><span class=line><span class=cl><span class=na>ExecReload</span><span class=o>=</span><span class=s>/bin/kill -HUP $MAINPID</span>
</span></span><span class=line><span class=cl><span class=na>ExecStop</span><span class=o>=</span><span class=s>/bin/kill -TERM $MAINPID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Process management</span>
</span></span><span class=line><span class=cl><span class=na>KillMode</span><span class=o>=</span><span class=s>mixed</span>
</span></span><span class=line><span class=cl><span class=na>KillSignal</span><span class=o>=</span><span class=s>SIGTERM</span>
</span></span><span class=line><span class=cl><span class=na>TimeoutStopSec</span><span class=o>=</span><span class=s>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Restart policy</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl><span class=na>StartLimitIntervalSec</span><span class=o>=</span><span class=s>300</span>
</span></span><span class=line><span class=cl><span class=na>StartLimitBurst</span><span class=o>=</span><span class=s>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Resource limits</span>
</span></span><span class=line><span class=cl><span class=na>LimitNOFILE</span><span class=o>=</span><span class=s>65536</span>
</span></span><span class=line><span class=cl><span class=na>MemoryMax</span><span class=o>=</span><span class=s>2G</span>
</span></span><span class=line><span class=cl><span class=na>CPUQuota</span><span class=o>=</span><span class=s>200%</span>
</span></span><span class=line><span class=cl><span class=na>TasksMax</span><span class=o>=</span><span class=s>512</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Security</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHome</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateDevices</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelTunables</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectKernelModules</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectControlGroups</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ReadWritePaths</span><span class=o>=</span><span class=s>/opt/webapp/data /opt/webapp/logs</span>
</span></span><span class=line><span class=cl><span class=na>RestrictRealtime</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>RestrictSUIDSGID</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Logging</span>
</span></span><span class=line><span class=cl><span class=na>StandardOutput</span><span class=o>=</span><span class=s>journal</span>
</span></span><span class=line><span class=cl><span class=na>StandardError</span><span class=o>=</span><span class=s>journal</span>
</span></span><span class=line><span class=cl><span class=na>SyslogIdentifier</span><span class=o>=</span><span class=s>webapp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><h3 class=heading-element id=152-background-worker><span>15.2 Background Worker</span>
<a href=#152-background-worker class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/worker@.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Background Worker %i</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network-online.target rabbitmq.service</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>rabbitmq.service</span>
</span></span><span class=line><span class=cl><span class=na>PartOf</span><span class=o>=</span><span class=s>workers.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>worker</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>worker</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/opt/app</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>WORKER_ID=%i</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/opt/app/.env</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/opt/app/bin/worker</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>always</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Nice priority for background work</span>
</span></span><span class=line><span class=cl><span class=na>Nice</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl><span class=na>IOSchedulingClass</span><span class=o>=</span><span class=s>best-effort</span>
</span></span><span class=line><span class=cl><span class=na>IOSchedulingPriority</span><span class=o>=</span><span class=s>7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Limits</span>
</span></span><span class=line><span class=cl><span class=na>MemoryMax</span><span class=o>=</span><span class=s>512M</span>
</span></span><span class=line><span class=cl><span class=na>TasksMax</span><span class=o>=</span><span class=s>64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Security</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHome</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>workers.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/workers.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>All Workers</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>worker@1.service worker@2.service worker@3.service worker@4.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><h3 class=heading-element id=153-scheduled-task-timer><span>15.3 Scheduled Task (Timer)</span>
<a href=#153-scheduled-task-timer class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/backup.timer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Daily Backup Timer</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://example.com/docs/backup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Timer]</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>*-*-* 02:00:00</span>
</span></span><span class=line><span class=cl><span class=na>RandomizedDelaySec</span><span class=o>=</span><span class=s>30min</span>
</span></span><span class=line><span class=cl><span class=na>Persistent</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>timers.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/backup.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Daily Backup</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://example.com/docs/backup</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=c1># Send notification on failure</span>
</span></span><span class=line><span class=cl><span class=na>OnFailure</span><span class=o>=</span><span class=s>notify-admin@%n.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>oneshot</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>backup</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>backup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/opt/backup/backup.sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Timeouts</span>
</span></span><span class=line><span class=cl><span class=na>TimeoutStartSec</span><span class=o>=</span><span class=s>3600</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Low priority</span>
</span></span><span class=line><span class=cl><span class=na>Nice</span><span class=o>=</span><span class=s>19</span>
</span></span><span class=line><span class=cl><span class=na>IOSchedulingClass</span><span class=o>=</span><span class=s>idle</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Security</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHome</span><span class=o>=</span><span class=s>read-only</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ReadWritePaths</span><span class=o>=</span><span class=s>/backup</span></span></span></code></pre></div><h3 class=heading-element id=154-socket-activated-service><span>15.4 Socket-Activated Service</span>
<a href=#154-socket-activated-service class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/api.socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>API Socket</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://example.com/docs/api</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Socket]</span>
</span></span><span class=line><span class=cl><span class=na>ListenStream</span><span class=o>=</span><span class=s>0.0.0.0:8080</span>
</span></span><span class=line><span class=cl><span class=na>Accept</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl><span class=na>NoDelay</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>ReusePort</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>sockets.target</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/api.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>API Service</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://example.com/docs/api</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>api.socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>notify</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>api</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>api</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/opt/api</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/opt/api/bin/api-server</span>
</span></span><span class=line><span class=cl><span class=na>ExecReload</span><span class=o>=</span><span class=s>/bin/kill -HUP $MAINPID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Socket activation - không cần bind, nhận FD từ systemd</span>
</span></span><span class=line><span class=cl><span class=na>NonBlocking</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Security</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict</span>
</span></span><span class=line><span class=cl><span class=na>ProtectHome</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Không có [Install] - activated bởi socket</span></span></span></code></pre></div><h3 class=heading-element id=155-hardened-container-runtime><span>15.5 Hardened Container Runtime</span>
<a href=#155-hardened-container-runtime class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># /etc/systemd/system/container-app.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Containerized Application</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>docker.service</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>docker.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>ExecStartPre</span><span class=o>=</span><span class=s>-/usr/bin/docker stop %n</span>
</span></span><span class=line><span class=cl><span class=na>ExecStartPre</span><span class=o>=</span><span class=s>-/usr/bin/docker rm %n</span>
</span></span><span class=line><span class=cl><span class=na>ExecStartPre</span><span class=o>=</span><span class=s>/usr/bin/docker pull myregistry/myapp:latest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/docker run \
</span></span></span><span class=line><span class=cl><span class=s>    --name %n \
</span></span></span><span class=line><span class=cl><span class=s>    --rm \
</span></span></span><span class=line><span class=cl><span class=s>    --network=host \
</span></span></span><span class=line><span class=cl><span class=s>    --read-only \
</span></span></span><span class=line><span class=cl><span class=s>    --tmpfs /tmp \
</span></span></span><span class=line><span class=cl><span class=s>    --security-opt=no-new-privileges:true \
</span></span></span><span class=line><span class=cl><span class=s>    --cap-drop=ALL \
</span></span></span><span class=line><span class=cl><span class=s>    --cap-add=NET_BIND_SERVICE \
</span></span></span><span class=line><span class=cl><span class=s>    --memory=2g \
</span></span></span><span class=line><span class=cl><span class=s>    --cpus=2 \
</span></span></span><span class=line><span class=cl><span class=s>    --pids-limit=100 \
</span></span></span><span class=line><span class=cl><span class=s>    --env-file=/opt/app/.env \
</span></span></span><span class=line><span class=cl><span class=s>    -v /opt/app/data:/data:rw \
</span></span></span><span class=line><span class=cl><span class=s>    myregistry/myapp:latest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ExecStop</span><span class=o>=</span><span class=s>/usr/bin/docker stop %n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>always</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><hr><h2 class=heading-element id=tóm-tắt-nhanh><span>TÓM TẮT NHANH</span>
<a href=#t%c3%b3m-t%e1%ba%aft-nhanh class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=essential-commands><span>Essential Commands</span>
<a href=#essential-commands class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Lifecycle</span>
</span></span><span class=line><span class=cl>systemctl start<span class=p>|</span>stop<span class=p>|</span>restart<span class=p>|</span>reload myapp
</span></span><span class=line><span class=cl>systemctl enable<span class=p>|</span>disable --now myapp
</span></span><span class=line><span class=cl>systemctl status myapp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Logs</span>
</span></span><span class=line><span class=cl>journalctl -u myapp -f
</span></span><span class=line><span class=cl>journalctl -u myapp -p err --since today
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Debug</span>
</span></span><span class=line><span class=cl>systemctl cat myapp
</span></span><span class=line><span class=cl>systemctl show myapp
</span></span><span class=line><span class=cl>systemd-analyze security myapp
</span></span><span class=line><span class=cl>systemd-analyze verify myapp.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># System</span>
</span></span><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl>systemctl list-units --failed
</span></span><span class=line><span class=cl>systemd-analyze blame</span></span></code></pre></div><h3 class=heading-element id=unit-file-essentials><span>Unit File Essentials</span>
<a href=#unit-file-essentials class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>My Service</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>dependency.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>myapp</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/myapp</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/etc/myapp/env</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Security basics</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>strict</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span></span></span></code></pre></div><h3 class=heading-element id=timer-essentials><span>Timer Essentials</span>
<a href=#timer-essentials class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Timer]</span>
</span></span><span class=line><span class=cl><span class=na>OnCalendar</span><span class=o>=</span><span class=s>daily           # hoặc *-*-* 02:00:00</span>
</span></span><span class=line><span class=cl><span class=na>Persistent</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>RandomizedDelaySec</span><span class=o>=</span><span class=s>10min</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>timers.target</span></span></span></code></pre></div><hr><h2 class=heading-element id=references><span>REFERENCES</span>
<a href=#references class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li><a href=https://www.freedesktop.org/software/systemd/man/ target=_blank rel="external nofollow noopener noreferrer">systemd Official Documentation</a></li><li><a href=https://wiki.archlinux.org/title/systemd target=_blank rel="external nofollow noopener noreferrer">Arch Wiki - systemd</a></li><li><a href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/managing-system-services-with-systemctl_configuring-basic-system-settings target=_blank rel="external nofollow noopener noreferrer">Red Hat - Managing Services with systemd</a></li><li><a href=https://www.digitalocean.com/community/tutorials/systemd-essentials-working-with-services-units-and-the-journal target=_blank rel="external nofollow noopener noreferrer">DigitalOcean - Systemd Essentials</a></li></ul></div><hr class=awesome-hr><h2 id=see-also>Nội dung liên quan</h2><ul><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/file-and-folder/ title="Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu">Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu</a></li><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/selinux/ title="Selinux & Apparmor - Kiểm Soát Truy Cập Bắt Buộc">Selinux & Apparmor - Kiểm Soát Truy Cập Bắt Buộc</a></li><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/encryption-and-security/ title="Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu">Linux Cryptography & Security Tools - Hướng Dẫn Chuyên Sâu</a></li><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/package-manager/ title="Linux Package Management - Hướng Dẫn Chuyên Sâu">Linux Package Management - Hướng Dẫn Chuyên Sâu</a></li><li><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/user-group/ title="Linux User & Group Management - Hướng Dẫn Chuyên Sâu">Linux User & Group Management - Hướng Dẫn Chuyên Sâu</a></li></ul><div class=collection-card><div class="collection-title text-secondary">Trong <a href=/collections/linux-cli/><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> <span>Bộ sưu tập・Linux Cli</span></span></a> 12</div><div class=collection-nav><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/file-and-folder/ class=collection-nav-item rel=prev title="Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i><span>Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu</span></a></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Cập nhật ngày 2025-12-19 20:48:32">Cập nhật ngày 2025-12-19&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Chia sẻ trên X" data-sharer=twitter data-url=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/systemd/ data-title="Systemd - Hướng Dẫn Toàn Diện Cho System Engineers" data-hashtags="ai generated post"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Chia sẻ trên Facebook" data-sharer=facebook data-url=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/systemd/ data-hashtag="ai generated post"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Chia sẻ trên 微博" data-sharer=weibo data-url=https://vanvuvuong.github.io/bai-viet/khoa-hoc-may-tinh/linux-cli/systemd/ data-title="Systemd - Hướng Dẫn Toàn Diện Cho System Engineers"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ai-generated-post/ class=post-tag title="Nhãn - Ai Generated Post">Ai Generated Post</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Quay lại</a></span>&nbsp;|&nbsp;<span><a href=/>Trang chủ</a></span></section></div><div class=post-nav><a href=/bai-viet/khoa-hoc-may-tinh/linux-cli/file-and-folder/ class=post-nav-item rel=prev title="Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Find, Ln, Lsof, Tar, Chmod - Hướng Dẫn Chuyên Sâu</a></div></div></article><aside class=toc id=toc-auto aria-label="Nội dung"><h2 class=toc-title>Nội dung&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><dialog id=toc-dialog aria-labelledby=toc-dialog-title role=dialog><div class=toc><h2 class=toc-title>Nội dung</h2><div class=toc-content id=toc-content-drawer><nav><ul><li><ul><li><a href=#1-kiến-trúc-systemd>1. KIẾN TRÚC SYSTEMD</a><ul><li><a href=#11-tổng-quan>1.1 Tổng quan</a></li><li><a href=#12-thành-phần-chính>1.2 Thành phần chính</a></li><li><a href=#13-unit-types>1.3 Unit Types</a></li><li><a href=#14-unit-file-locations>1.4 Unit File Locations</a></li></ul></li><li><a href=#2-unit-files---cấu-trúc-cơ-bản>2. UNIT FILES - CẤU TRÚC CƠ BẢN</a><ul><li><a href=#21-cấu-trúc-unit-file>2.1 Cấu trúc Unit File</a></li><li><a href=#22-dependency-directives>2.2 Dependency Directives</a></li><li><a href=#23-điều-kiện-và-assertions>2.3 Điều kiện và Assertions</a></li><li><a href=#24-specifiers-variables>2.4 Specifiers (Variables)</a></li></ul></li><li><a href=#3-service-units>3. SERVICE UNITS</a><ul><li><a href=#31-service-types>3.1 Service Types</a></li><li><a href=#32-service-directives>3.2 Service Directives</a></li><li><a href=#33-restart-behavior-matrix>3.3 Restart Behavior Matrix</a></li><li><a href=#34-execstart-prefixes>3.4 ExecStart Prefixes</a></li><li><a href=#35-ví-dụ-service-units>3.5 Ví dụ Service Units</a></li><li><a href=#36-template-units>3.6 Template Units</a></li></ul></li><li><a href=#4-timer-units---thay-thế-cron>4. TIMER UNITS - THAY THẾ CRON</a><ul><li><a href=#41-timer-vs-cron>4.1 Timer vs Cron</a></li><li><a href=#42-timer-directives>4.2 Timer Directives</a></li><li><a href=#43-oncalendar-format>4.3 OnCalendar Format</a></li><li><a href=#44-timer-examples>4.4 Timer Examples</a></li><li><a href=#45-cron-to-timer-cheatsheet>4.5 Cron to Timer Cheatsheet</a></li></ul></li><li><a href=#5-target-units>5. TARGET UNITS</a><ul><li><a href=#51-targets-vs-runlevels>5.1 Targets vs Runlevels</a></li><li><a href=#52-target-hierarchy>5.2 Target Hierarchy</a></li><li><a href=#53-thao-tác-với-targets>5.3 Thao tác với Targets</a></li><li><a href=#54-custom-target>5.4 Custom Target</a></li></ul></li><li><a href=#6-socket-units>6. SOCKET UNITS</a><ul><li><a href=#61-socket-activation>6.1 Socket Activation</a></li><li><a href=#62-socket-directives>6.2 Socket Directives</a></li><li><a href=#63-socket-examples>6.3 Socket Examples</a></li></ul></li><li><a href=#7-path-units>7. PATH UNITS</a><ul><li><a href=#71-path-unit-overview>7.1 Path Unit Overview</a></li><li><a href=#72-path-example>7.2 Path Example</a></li></ul></li><li><a href=#8-mount--automount-units>8. MOUNT & AUTOMOUNT UNITS</a><ul><li><a href=#81-mount-units>8.1 Mount Units</a></li><li><a href=#82-automount-units>8.2 Automount Units</a></li><li><a href=#83-mount-unit-từ-fstab>8.3 Mount Unit từ fstab</a></li></ul></li><li><a href=#9-systemctl---quản-lý-services>9. SYSTEMCTL - QUẢN LÝ SERVICES</a><ul><li><a href=#91-basic-commands>9.1 Basic Commands</a></li><li><a href=#92-listing-units>9.2 Listing Units</a></li><li><a href=#93-unit-file-management>9.3 Unit File Management</a></li><li><a href=#94-system-control>9.4 System Control</a></li><li><a href=#95-user-services>9.5 User Services</a></li></ul></li><li><a href=#10-journald---logging>10. JOURNALD - LOGGING</a><ul><li><a href=#101-journalctl-basics>10.1 journalctl Basics</a></li><li><a href=#102-advanced-queries>10.2 Advanced Queries</a></li><li><a href=#103-journald-configuration>10.3 journald Configuration</a></li><li><a href=#104-structured-logging>10.4 Structured Logging</a></li></ul></li><li><a href=#11-systemd-analyze---performance>11. SYSTEMD-ANALYZE - PERFORMANCE</a><ul><li><a href=#111-boot-analysis>11.1 Boot Analysis</a></li><li><a href=#112-unit-analysis>11.2 Unit Analysis</a></li><li><a href=#113-system-analysis>11.3 System Analysis</a></li></ul></li><li><a href=#12-resource-control---cgroups>12. RESOURCE CONTROL - CGROUPS</a><ul><li><a href=#121-resource-control-directives>12.1 Resource Control Directives</a></li><li><a href=#122-slices>12.2 Slices</a></li><li><a href=#123-custom-slice>12.3 Custom Slice</a></li><li><a href=#124-systemd-cgtop>12.4 systemd-cgtop</a></li><li><a href=#125-runtime-resource-control>12.5 Runtime Resource Control</a></li></ul></li><li><a href=#13-security-hardening>13. SECURITY HARDENING</a><ul><li><a href=#131-security-directives>13.1 Security Directives</a></li><li><a href=#132-security-profiles>13.2 Security Profiles</a></li><li><a href=#133-check-security-score>13.3 Check Security Score</a></li></ul></li><li><a href=#14-debugging--troubleshooting>14. DEBUGGING & TROUBLESHOOTING</a><ul><li><a href=#141-debug-commands>14.1 Debug Commands</a></li><li><a href=#142-common-issues>14.2 Common Issues</a></li><li><a href=#143-debug-checklist>14.3 Debug Checklist</a></li></ul></li><li><a href=#15-production-templates>15. PRODUCTION TEMPLATES</a><ul><li><a href=#151-web-application>15.1 Web Application</a></li><li><a href=#152-background-worker>15.2 Background Worker</a></li><li><a href=#153-scheduled-task-timer>15.3 Scheduled Task (Timer)</a></li><li><a href=#154-socket-activated-service>15.4 Socket-Activated Service</a></li><li><a href=#155-hardened-container-runtime>15.5 Hardened Container Runtime</a></li></ul></li><li><a href=#tóm-tắt-nhanh>TÓM TẮT NHANH</a><ul><li><a href=#essential-commands>Essential Commands</a></li><li><a href=#unit-file-essentials>Unit File Essentials</a></li><li><a href=#timer-essentials>Timer Essentials</a></li></ul></li><li><a href=#references>REFERENCES</a></li></ul></li></ul></nav></div></div></dialog></main><footer class=footer><div class=footer-container><div class="footer-line powered">Cung cấp bởi <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.152.0"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> | Chủ đề - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.4.0-alpha.2"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2025</span></div></div></footer></div><div class=widgets><div class=fixed-buttons><div class="fixed-button back-to-top animate__faster" role=button aria-label="Lên trên"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><svg viewBox="0 0 100 100"><circle class="bg" cx="50" cy="50" r="50"/><circle class="progress" cx="50" cy="50" r="50"/></svg></div><div id=toc-drawer-button class="fixed-button toc-drawer-button" role=button aria-label="Nội dung"><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></div></div><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#000;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>Trang web này hoạt động tốt nhất khi JavaScript được kích hoạt.</div></noscript></div><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script src=/bai-viet/khoa-hoc-may-tinh/linux-cli/systemd/config/page.js defer></script><script src=/js/theme.min.js defer></script></body></html>